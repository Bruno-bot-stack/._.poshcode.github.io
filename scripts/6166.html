<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sign up for PowerShell.Slack.com">
    <meta name="author" content="Atamido">
    <title>Parse-GPO-Settings - PoshCode</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>

    <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
    <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/b167be35-3674-4571-8142-df1f7dcfc268">
<!--
    <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud" />
    <link rel="openid2.local_id" href="https://profiles.google.com/+JoelBennett" />
-->
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/Scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<h1>Parse-GPO-Settings</h1>
<h3><a href="//scripts/6166.ps1">download</a></h3>
<p>Read all group policies from the domain, read out individual settings, and make them filterable and sortable</p>
<pre><code class="language-posh">#  Reads all of the GPOs out of the domain, parses them, and then sends the output of settings to a GridView

#  Reduces the total lines in a string to 9, because out-gridview doesn't like more than 9 lines in an entry
Function Replace-ExtraLines
{
    Param($Entries)

    ForEach ($Entry in $Entries)
    {
        $Additional = $Entry.Additional
        [String[]]$Lines = @()

        If ((Measure-Object -Line -InputObject $Additional).Lines -gt 9)
        {
            $Count = (Measure-Object -Line -InputObject $Additional).Lines

            $Lines = $Additional.Split(&quot;`n&quot;)

            [String]$Additional = ''
            $LineNum = 1
            $LineNumRemoved = 0

            ForEach ($Line in $Lines)
            {
                If ($LineNum / ($count / ($count - 9)) - $LineNumRemoved -ge 1.0)
                {
                    If ($Additional -ne '')
                    {
                        $Additional += '; '
                    }
                    $Additional += $Line

                    $LineNumRemoved++
                }
                Else
                {
                    If ($Additional -ne '')
                    {
                        $Additional += &quot;`n&quot;
                    }
                    $Additional += $Line
                }

                $LineNum++
            }
            $Entry.Additional = $Additional
        }
    }
    Return $Entries
}

#  Performs some basic parsing of the ADMX settings that are registry settings
Function Get-XMLTreeSimpleValues 
{
    Param($XmlElement)

    [String]$Additional = ''
    [Bool]$HasChildren = $false
    
    ForEach ($property in $XmlElement.ChildNodes)
    {
        [String]$Desc = ''
        If ($property.GetType().Name -eq 'XmlElement')
        {
            $Desc = Get-XMLTreeSimpleValues $property
            $HasChildren = $true
        }
        ElseIf ($property.GetType().Name -eq 'String')
        {
            $Desc = $property.LocalName + ': ' + $property
        }
        ElseIf ($property.GetType().Name -eq 'XmlText')
        {
            $Desc = $property.value
        }
        Else
        {
            Write-Warning &quot;$($property.LocalName) isn't what was expected $($property.GetType())&quot;
        }
        $Desc = $Desc.Trim()
        If ($Desc -ne '')
        {
            If ($Additional -eq '')
            {
                $Additional = $Desc
            }
            ElseIf ($Additional -match ':$')
            {
                $Additional += &quot; &quot; + $Desc
            }
            ElseIf ($Desc -eq 'Enabled' -or $Desc -eq 'Disabled')
            {
                $Additional += &quot;: &quot; + $Desc
            }
            Else
            {
                $Additional += &quot;`n&quot; + $Desc
            }
        }
    }
    #$Additional = Replace-ExtraLines $Additional
    Return $Additional
}

#  Performs some slightly more complex parsing of the ADMX settings that are registry settings
Function Get-RegistryValues
{
    Param($XmlElement)

    &lt;#  
    Valid values and sub-values appear to be:
        Name
        State
        Explain
        Supported
        Category
        Text
        Comment
        CheckBox
            Name
            State
        DropDownList
            Name
            State
            Value
        EditText
            Name
            State
            Value
        ListBox
            Name
            State
            Value
            Additive
            ExplicitValue
            ValuePrefix
        Numeric
            Name
            State
            Value
    #&gt;

    [String]$Additional = ''
    #  Elements to skip in the &quot;Registry&quot; section
    [String[]]$ignoreList = @('Name', 'State', 'Explain', 'Supported', 'Category', 'Text', 'Comment')
    
    [String[]]$DescList = @()
    ForEach ($property in $XmlElement.ChildNodes)
    {
        [String]$Desc = ''
        [String]$LocalName = $property.LocalName
        If (!$ignoreList.Contains($LocalName))
        {
            If ($property.Name.Trim().Length -eq '0')
            {
                [String]$PropertyName = $LocalName + ': '
            }
            ElseIf ($property.Name.Trim() -match ':$')
            {
                [String]$PropertyName = $property.Name.Trim() + ' '
            }
            ElseIf ($property.Name.Trim() -match '\.$')
            {
                [String]$PropertyName = $property.Name.Trim().Substring(0,$property.Name.Trim().Length - 1) + ': '
            }
            Else
            {
                [String]$PropertyName = $property.Name.Trim() + ': '
            }

            If ($LocalName -eq 'CheckBox')
            {
                $Desc = $PropertyName + $property.State
            }
            ElseIf ($LocalName -eq 'DropDownList')
            {
                $Desc = $PropertyName + $property.Value.Name
            }
            ElseIf ($LocalName -eq 'EditText')
            {
                $Desc = $PropertyName + $property.Value
            }
            ElseIf ($LocalName -eq 'ListBox')
            {
                If ($property.ValuePrefix)
                {
                    [String]$ValuePrefix = '(ValuePrefix: ' + $property.ValuePrefix + ') '
                }
                Else
                {
                    [String]$ValuePrefix = ''
                }

                [String[]]$ValueData = @()
                ForEach ($ValueElement in $property.Value.Element)
                {
                    $ValueData += [String[]]($ValueElement.childnodes.'#text') -join ', '
                }
                #$Desc = $LocalName + ': ' + $PropertyName + 'Expli-' + $property.ExplicitValue + ': ' + 'Addi-' + $property.Additive + ': ' + $ValuePrefix + &quot;`n&quot; + ($ValueData -join &quot;`n&quot;)
                $Desc = $PropertyName + $ValuePrefix + &quot;`n&quot; + ($ValueData -join &quot;`n&quot;)
            }
            ElseIf ($LocalName -eq 'Numeric')
            {
                $Desc = $PropertyName + $property.Value
            }
            Else
            {
                Write-Warning &quot;$($LocalName): $($property.Name) isn't what was expected $($property.GetType())&quot;
            }
            $DescList += $Desc.Trim()
        }
    }
    #Return (Replace-ExtraLines ($DescList -join &quot;`n&quot;))
    Return ($DescList -join &quot;`n&quot;)
}

#  Parses direct registry settings in GPOs
Function Get-XMLTreeRegistryValues
{
    Param($XmlElement)
    
    $updateType = @{'C' = 'Create'; 'R' = 'Replace'; 'U' = 'Update'; 'D' = 'Delete'}
    $hive = @{'HKEY_LOCAL_MACHINE' = 'HKLM'; 'HKEY_CLASSES_ROOT' = 'HKCR'; 'HKEY_CURRENT_USER' = 'HKCU'; 'HKEY_USERS' = 'HKU'; 'HKEY_CURRENT_CONFIG' = 'HKCC'}
    $returnArray = @()
    
    ForEach ($property in $XmlElement.ChildNodes)
    {
        [String]$Desc = ''
        [String]$State = 'Enabled'
        $tempArray = @()
        If ($property.LocalName -eq 'GPOSettingOrder' -or $property.LocalName -eq 'Filters' -or $property.LocalName -eq '#text')
        {
            $tempArray = Get-XMLTreeRegistryValues $property
        }
        ElseIf ($property.LocalName -eq 'Collection')
        {
            $tempArray = Get-XMLTreeRegistryValues $property
        }
        ElseIf ($property.LocalName -eq 'Registry')
        {
            If ($property.disabled -eq '1')
            {
                $State = 'Disabled'
            }
            If ($property.status)
            {
                $name = $property.status
            }
            Else
            {
                $name = $property.name
            }
            $Desc  = $updateType[&quot;$($property.Properties.action)&quot;] + ' &quot;'
            $Desc += $name + '&quot; to &quot;'
            $Desc += $property.Properties.value + '&quot;' + &quot;`n&quot;
            $Desc += $hive[&quot;$($property.Properties.hive)&quot;] + '\'
            $Desc += $property.Properties.key

            $tempArray += New-Object PSObject -Property @{
                                        State = $state
                                        Additional = $Desc
                                    }
        }
        Else
        {
            Write-Warning &quot;$($property.LocalName) isn't what was expected $($property.GetType()) $($property.value) $($property.Name)&quot;
        }
        If ($tempArray.Count -gt 0)
        {
            $returnArray += $tempArray
        }
    }
    Return $returnArray
}

#  Performs some complex parsing of the ADMX settings that are non-registry settings
Function Get-XMLTreeComplexValues
{
    Param(
        $XmlElement,
        [String]$Parent,
        [String]$Name
    )
    
    [PSObject[]]$returnArray = @()
    $Additional = ''
    
    ForEach ($property in $XmlElement.ChildNodes)
    {
        [String]$Desc = ''
        [PSObject[]]$tempArray = @()
        #  For this to work right, this makes the really bad assumption that the &quot;name&quot; element is first
        If ($property.LocalName -eq 'name' -or $property.LocalName -eq 'SystemAccessPolicyName')
        {
            $Name = $property.'#text'
            #  Not sure if it's meaningful to have an entry every time the name is set
            #$Desc = $Parent + '\' +  $property.LocalName + '\' +  $property.'#text'
        }
        ElseIf ($property.LocalName -eq 'Type')
        {
        }
        ElseIf ($property.GetType().Name -eq 'XmlElement')
        {
            $tempArray = Get-XMLTreeComplexValues $property ($Parent + '\'+ $property.LocalName) $Name
        }
        ElseIf ($property.GetType().Name -eq 'String')
        {
            $Desc = $Parent + '\' +  $property.LocalName + ': ' + $property
        }
        ElseIf ($property.GetType().Name -eq 'XmlText')
        {
            $Desc = $Parent + '\' +  $property.value
        }
        Else
        {
            Write-Warning &quot;$($property.LocalName) isn't what was expected $($property.GetType())&quot;
        }
        $Desc = $Desc.Trim()
        If($Desc -ne '')
        {
            $tempArray += New-Object PSObject -Property @{
                                PolicyName = $Name
                                Additional = $Desc
                            }
        }
        If ($tempArray.Count -gt 0)
        {
            $returnArray += $tempArray
        }
    }
    Return $returnArray
}

#  Parse firewall specific settings
Function Get-XMLFirewallSettings
{
    Param(
        $ChildNodes,
	    [String]$identifier,
	    [String]$GPOName,
        [String]$PolicyType,
        [int32]$LinkCount,
        [Int32]$PermissionCount
    )

    [PSObject[]]$returnArray = @()
    
    [PSObject[]]$registrySettings = @()
    [String]$policyName = 'Windows Firewall'
    ForEach ($policy in $ChildNodes)
    {
        [String]$Additional = ''
        If($policy.LocalName -ne 'InboundFirewallRules' -and $policy.LocalName -ne 'OutboundFirewallRules')
        {
            ForEach ($extValue in $policy.ChildNodes)
            {
                If($extValue -ne '' -and $extValue.LocalName -ne 'PolicyVersion')
                {
                    If($Additional.Length -ne 0)
                    {
                        $Additional += &quot;`n&quot;
                    }
                    $Additional += &quot;$($extValue.LocalName): $($extValue.Value)&quot;
                }
            }
        }
        Else
        {
            ForEach ($extValue in $policy.ChildNodes)
            {
                If($extValue -ne '' -and $extValue.ChildNodes.Count -gt 0 -and $extValue.ChildNodes[0].Value -ne '')
                {
                    If (!$ignoreListFirewall.Contains($extValue.ChildNodes[0].ParentNode.ToString()) -and $extValue.ChildNodes[0].Value -notlike '*@FirewallAPI.dll,-*')
                    {
                        If($Additional.Length -ne 0)
                        {
                            $Additional += &quot;`n&quot;
                        }
                        $Additional += &quot;$($extValue.ChildNodes[0].ParentNode.ToString()): $($extValue.ChildNodes[0].Value)&quot;
                    }
                }
            }
        }

        #$Additional = Replace-ExtraLines $Additional

        If ($Additional -ne '')
        {
            $returnArray += New-Object PSObject -Property @{
	                            Identifier = $identifier
	                            GPOName = $GPOName
                                T = $PolicyType
                                L = $LinkCount
                                PolicyName = &quot;$($policyName): $($policy.LocalName)&quot;
                                State = ''
                                Additional = $Additional
                                P = $PermissionCount
                            }
        }
    }

    Return $returnArray
}

#  Parse Advanced Audit settings
Function Get-XMLAdvancedAuditSettings
{
    Param(
        $ChildNodes,
	    [String]$identifier,
	    [String]$GPOName,
        [String]$PolicyType,
        [int32]$LinkCount,
        [Int32]$PermissionCount
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'Advanced Audit Configuration'
    [String]$Additional = ''
    [String]$TempAdditional = ''
    [String[]]$AuditEvents = @('None', 'Success', 'Failure', 'Success and Failure')

    ForEach ($policy in $ChildNodes)
    {
        $Additional = ''
        $TempAdditional = ''

        If ($policy.LocalName -eq 'AuditSetting')
        {
            $Additional = &quot;$($policy.SubcategoryName): $($AuditEvents[$policy.SettingValue])&quot;
        }
        ElseIf ($policy.LocalName -eq 'GlobalSaclSetting')
        {
            ForEach ($setting in $policy.ChildNodes)
            {
                If ($setting.LocalName -eq 'GlobalSaclType')
                {
                    $Additional += &quot;$($setting.LocalName): $($setting.'#text')&quot;
                }
                ElseIf ($setting.LocalName -eq 'SecurityDescriptor')
                {
                    ForEach ($SecurityDescriptor in $setting.ChildNodes)
                    {
                        If($SecurityDescriptor.LocalName -eq 'Auditing')
                        {
                            ForEach ($Audit in $SecurityDescriptor.ChildNodes)
                            {
                                $Additional += &quot;`n$($Audit.LocalName): $($Audit.'#text')&quot;
                            }
                        }
                        Else
                        {
                            $Additional += &quot;`n$($SecurityDescriptor.LocalName): $($SecurityDescriptor.'#text')&quot;
                        }
                    }
                }
                Else
                {
                    $Additional += &quot;`n$($setting.LocalName): $($setting.'#text')&quot;
                }
            }
        }
        Else
        {
            Write-Warning &quot;Unknown audit setting type '$($policy.LocalName)' in $($GPOName)&quot;
        }

        #$Additional = Replace-ExtraLines $Additional
        If ($Additional -ne '')
        {
            $returnArray += New-Object PSObject -Property @{
	                            Identifier = $identifier
	                            GPOName = $GPOName
                                T = $PolicyType
                                L = $LinkCount
                                PolicyName = &quot;$($policyName)&quot;
                                State = ''
                                Additional = $Additional
                                P = $PermissionCount
                            }
        }
    }

    Return $returnArray
}

#  Parse Security User Rights Assignment settings
Function Get-XMLUserRightsAssignment
{
    Param(
        $UserRightsAssignments
    )

    [PSObject[]]$returnArray = @()

    ForEach ($policy in $UserRightsAssignments)
    {
        [String]$policyName = $policy.Name
        [String]$state = $policy.State

        [String[]]$DescList = @()
        [String]$Desc = ''
        If ($policy.Member -ne $null)
        {
            If ($policy.Member.GetType().Name -eq 'XmlElement')
            {
                If ($policy.Member.SID -ne $null)
                {
                    $Desc = $policy.Member.SID.'#text'
                    If ($policy.Member.Name.'#text' -ne $null)
                    {
                        $Desc += &quot; ($($policy.Member.Name.'#text'))&quot;
                    }
                }
                Else
                {
                    $Desc = $policy.Member.Name.'#text'
                }
                $DescList += $Desc
            }
            Else
            {
                ForEach ($Mem in $policy.Member)
                {
                    If ($Mem.SID -ne $null)
                    {
                        $Desc = $Mem.SID.'#text'
                        If ($Mem.Name.'#text' -ne $null)
                        {
                            $Desc += &quot; ($($Mem.Name.'#text'))&quot;
                        }
                    }
                    Else
                    {
                        $Desc = $Mem.Name.'#text'
                    }
                    $DescList += $Desc
                }
            }
            $Desc = $DescList -join &quot;`n&quot;
        }

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policy.Name
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLSecurityOptions
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = ''
    [String[]]$DescList = @()
    [String]$Desc = ''
    
    $StringValues = @('DisplayNumber', 'DisplayBoolean', 'DisplayString')
    ForEach ($policy in $Policies)
    {
        $DescList = @()

        If ($policy.Display.Name -ne $null)
        {
            $policyName = $policy.Display.Name
            ForEach ($attr in $policy.ChildNodes)
            {
                If ($attr.LocalName -eq 'KeyName' -or $attr.LocalName -eq 'SettingStrings' -or $attr.LocalName -eq 'SettingNumber' -or $attr.LocalName -eq 'SettingString')
                {
                    # Do nothing
                }
                ElseIf ($attr.LocalName -eq 'Display')
                {
                    ForEach ($child in $attr.ChildNodes)
                    {
                        If ($StringValues.Contains($child.LocalName))
                        {
                            If ($child.'#text' -ne '')
                            {
                                If ($Policy.Display.Units -ne '')
                                {
                                    $DescList += &quot;$($Policy.Display.Units): $($child.'#text')&quot;
                                }
                                Else
                                {
                                    $DescList += $child.'#text'
                                }
                            }
                        }
                        ElseIf ($child.LocalName -eq 'DisplayStrings')
                        {
                            #$DescList += 'Strings:'
                            ForEach ($str in $child)
                            {
                                $DescList += $str.Value
                            }
                        }
                        ElseIf ($child.LocalName -eq 'DisplayFields')
                        {
                            ForEach ($Field in $child.Field)
                            {
                                $DescList += &quot;$($Field.Name): $($Field.Value)&quot;
                            }
                        }
                        ElseIf ($child.LocalName -ne 'Name' -and $child.LocalName -ne 'Units')
                        {
                            Write-Warning &quot;Unknown SecurityOption Display type $GPONum $($child.LocalName): $($child.'#text')&quot;
                            $DescList += &quot;$($child.LocalName): $($child.'#text')&quot;
                        }
                    }
                }
                Else
                {
                    Write-Warning &quot;Unknown SecurityOption type $GPONum $($attr.LocalName): $($attr)&quot;
                    $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
                }
            }
        }
        ElseIf ($policy.SystemAccessPolicyName -ne $null)
        {
            [String]$policyName = $policy.SystemAccessPolicyName
                            
            ForEach ($child in $Policy.ChildNodes)
            {
                If ($child.LocalName -ne 'SystemAccessPolicyName')
                {
                    $DescList += $child.'#text'
                }
            }
        }
        Else
        {
            [String]$policyName = 'Security Option'
                            
            ForEach ($child in $Policy.ChildNodes)
            {
                $DescList += $child.'#text'
            }
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLSecurityRegistry
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'SecurityRegistry'
    [String[]]$DescList = @()
    
    ForEach ($policy in $Policies)
    {
        $DescList = @()

        ForEach ($attr in $policy.ChildNodes)
        {
            If ($attr.LocalName -eq 'Path')
            {
                $DescList += $attr.'#text'
            }
            ElseIf ($attr.LocalName -eq 'SecurityDescriptor')
            {
                ForEach ($subAttr in $attr.ChildNodes)
                {
                    If ($subAttr.LocalName -eq 'SDDL')
                    {
                        #  No one wants to see this, right?
                    }
                    ElseIf ($subAttr.LocalName -eq 'Permissions')
                    {
                        $DescList += &quot;InheritsFromParent: $($subAttr.InheritsFromParent)&quot;
                        If ($subAttr.InheritsFromParent -eq 'true')
                        {
                            $DescList += &quot;Explicit Permissions: $(($subAttr.TrusteePermissions | Where-Object {$_.Inherited -eq 'false'} | Measure-Object).Count)&quot;
                        }
                    }
                    Else
                    {
                        $DescList += &quot;$($subAttr.LocalName): $($subAttr.'#text')&quot;
                    }
                }
            }
            Else
            {
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLSecurityFile
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'SecurityFile'
    [String[]]$DescList = @()
    
    ForEach ($policy in $Policies)
    {
        $DescList = @()

        ForEach ($attr in $policy.ChildNodes)
        {
            If ($attr.LocalName -eq 'Path')
            {
                $DescList += $attr.'#text'
            }
            ElseIf ($attr.LocalName -eq 'SecurityDescriptor')
            {
                ForEach ($subAttr in $attr.ChildNodes)
                {
                    If ($subAttr.LocalName -eq 'SDDL')
                    {
                        #  No one wants to see this, right?
                    }
                    ElseIf ($subAttr.LocalName -eq 'Permissions')
                    {
                        $DescList += &quot;InheritsFromParent: $($subAttr.InheritsFromParent)&quot;
                        If ($subAttr.InheritsFromParent -eq 'true')
                        {
                            $DescList += &quot;Explicit Permissions: $(($subAttr.TrusteePermissions | Where-Object {$_.Inherited -eq 'false'} | Measure-Object).Count)&quot;
                        }
                    }
                    Else
                    {
                        $DescList += &quot;$($subAttr.LocalName): $($subAttr.'#text')&quot;
                    }
                }
            }
            Else
            {
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLSecuritySystemServices
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'SecuritySystemServices'
    [String[]]$DescList = @()
    
    ForEach ($policy in $Policies)
    {
        $DescList = @()

        ForEach ($attr in $policy.ChildNodes)
        {
            If ($attr.LocalName -eq 'Name')
            {
                $DescList += $attr.'#text'
            }
            ElseIf ($attr.LocalName -eq 'SecurityDescriptor')
            {
                ForEach ($subAttr in $attr.ChildNodes)
                {
                    If ($subAttr.LocalName -eq 'SDDL' -or $subAttr.LocalName -eq 'Auditing')
                    {
                        #  No one wants to see this, right?
                    }
                    ElseIf ($subAttr.LocalName -eq 'Permissions')
                    {
                        $DescList += &quot;InheritsFromParent: $($subAttr.InheritsFromParent)&quot;
                        If ($subAttr.InheritsFromParent -eq 'true')
                        {
                            $DescList += &quot;Explicit Permissions: $(($subAttr.TrusteePermissions | Where-Object {$_.Inherited -eq 'false'} | Measure-Object).Count)&quot;
                        }
                    }
                    Else
                    {
                        $DescList += &quot;$($subAttr.LocalName): $($subAttr.'#text')&quot;
                    }
                }
            }
            Else
            {
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLSecurityRestrictedGroups
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'SecurityRestrictedGroups'
    [String[]]$DescList = @()
    [String]$Desc = ''
    [String]$Switch = ''
    
    ForEach ($policy in $Policies)
    {
        $DescList = @()
        $Desc = ''

        ForEach ($attr in $policy.ChildNodes)
        {
            If ($attr.LocalName -eq 'GroupName')
            {
                If ($attr.SID -ne $null)
                {
                    $Desc = $attr.SID.'#text'
                    If ($attr.Name.'#text' -ne $null)
                    {
                        $Desc += &quot; ($($attr.Name.'#text'))&quot;
                    }
                }
                Else
                {
                    $Desc = $attr.Name.'#text'
                }
                $DescList += $Desc
            }
            ElseIf ($attr.LocalName -eq 'Member' -or $attr.LocalName -eq 'Memberof')
            {
                If ($Switch -ne $attr.LocalName)
                {
                    $Switch = $attr.LocalName
                    $DescList += &quot;$($attr.LocalName):&quot;
                }
                If ($attr.SID -ne $null)
                {
                    $Desc = $attr.SID.'#text'
                    If ($attr.Name.'#text' -ne $null)
                    {
                        $Desc += &quot; ($($attr.Name.'#text'))&quot;
                    }
                }
                Else
                {
                    $Desc = $attr.Name.'#text'
                }
                $DescList += $Desc
            }
            Else
            {
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLSecurityEventLog
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'SecurityEventLog'
    [String[]]$DescList = @()
    [String]$Desc = ''
    [String]$Switch = ''
    [String[]]$RetentionPeriod = @('Overwrite events as needed', 'Overwrite events by days', 'Do not overwrite events')
    
    ForEach ($policy in $Policies)
    {
        
        If ($Switch -ne $policy.Log)
        {
            If ($DescList.Count -ne 0)
            {
                $Desc = $DescList -join &quot;`n&quot;
                $returnArray += New-Object PSObject -Property @{
                                    PolicyName = $policyName
                                    Additional = $Desc
                                }
                $DescList = @()
            }
            $Switch = $policy.Log
            $DescList += &quot;$($policy.Log) Log&quot;
        }
        
        If ($policy.Name -eq 'RestrictGuestAccess')
        {
            $DescList += &quot;$($policy.Name): $($policy.SettingBoolean)&quot;
        }
        ElseIf ($policy.Name -eq 'AuditLogRetentionPeriod')
        {
            $DescList += &quot;$($policy.Name): $($RetentionPeriod[$policy.SettingNumber])&quot;
        }
        Else
        {
            $DescList += &quot;$($policy.Name): $($policy.SettingNumber)&quot;
        }
    }

    If ($DescList.Count -ne 0)
    {
        $Desc = $DescList -join &quot;`n&quot;
        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
        $DescList = @()
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLWLanSvcNetworks
{
    Param(
        $Policies
    )
    [PSObject[]]$returnArray = @()
    [String]$policyName = 'WLanSvcNetworks'
    [String[]]$DescList = @()
    [String]$Desc = ''
    [String]$Switch = ''
    
    ForEach ($policy in $Policies)
    {
        $DescList = @()
        $Desc = ''

        ForEach ($attr in $policy.ChildNodes)
        {
            If ($attr.LocalName -eq 'networkFilter' -or $attr.LocalName -eq 'profileList')
            {
                #$DescList += &quot;$($attr.LocalName)&quot;
                ForEach ($attr2 in $attr.ChildNodes)
                {
                    If ($attr2.LocalName -eq 'allowList' -or $attr2.LocalName -eq 'blockList')
                    {
                        ForEach ($attr3 in $attr2.ChildNodes)
                        {
                            $DescList += &quot;$($attr2.LocalName)-networkName: $($attr3.networkName); networkType: $($attr3.networkType)&quot;
                        }
                    }
                    ElseIf ($attr2.LocalName -eq 'WLANProfile')
                    {
                        $DescList += &quot;WLANProfile: $($attr2.name); Type: $($attr2.connectionType)&quot;
                        $DescList += &quot;SSID: $($attr2.SSIDConfig.SSID.name); Broadcast: $([Bool]($attr2.SSIDConfig.nonBroadcast) -eq $false)&quot;
                        $DescList += &quot;authentication: $($attr2.MSM.security.authEncryption.Authentication); encryption: $($attr2.MSM.security.authEncryption.encryption); 802.1x: $($attr2.MSM.security.authEncryption.useOneX)&quot;
                        If ($attr2.MSM.security.authEncryption.useOneX -eq 'true')
                        {
                            If ($attr2.MSM.security.OneX.EAPConfig.EapHostConfig.Config.Eap.EapType.Eap.EapType.UseWinLogonCredentials)
                            {
                                $DescList += &quot;authMode: $($attr2.MSM.security.OneX.authMode); UseWinLogonCredentials: $($attr2.MSM.security.OneX.EAPConfig.EapHostConfig.Config.Eap.EapType.Eap.EapType.UseWinLogonCredentials)&quot;
                            }
                            Else
                            {
                                $DescList += &quot;authMode: $($attr2.MSM.security.OneX.authMode)&quot;
                            }
                        }

                        #  I want to skip enough information in these settings that it's easier to just cherry pick
                        &lt;#
                        ForEach ($attr2b in $attr2.ChildNodes)
                        {
                            If ($attr2b.LocalName -eq 'MSM')
                            {
                                ForEach ($attr3 in $attr2b.security.ChildNodes)
                                {
                                    If ($attr3.LocalName -eq 'authEncryption')
                                    {
                                        $DescList += &quot;authentication: $($attr3.Authentication)&quot;
                                        $DescList += &quot;encryption: $($attr3.encryption)&quot;
                                        $DescList += &quot;802.1x: $($attr3.useOneX)&quot;
                                    }
                                    If ($attr3.LocalName -eq 'OneX')
                                    {
                                        $DescList += &quot;authMode: $($attr3.authMode)&quot;
                                        $DescList += &quot;UseWinLogonCredentials: $($attr3.EAPConfig.EapHostConfig.Config.Eap.EapType.Eap.EapType.UseWinLogonCredentials)&quot;
                                        #  Most of the settings under here are best looked at directly in the GPO

                                    }
                                    Else
                                    {
                                        #  I think it's a little excessive to include this information
                                        #$DescList += &quot; $($attr3.LocalName): $($attr3.'#text')&quot;
                                    }
                                }
                            }
                            ElseIf ($attr2b.LocalName -eq 'SSIDConfig')
                            {
                                $DescList += &quot;SSID: $($attr2b.SSID.name)&quot;
                                #$DescList += &quot;Broadcast: $([Bool]($attr2b.nonBroadcast) -eq $false)&quot;
                            }
                            ElseIf ($attr2b.LocalName -eq 'name')
                            {
                                $DescList += &quot;WLANProfile: $($attr2b.'#text')&quot;
                            }
                            ElseIf ($attr2b.LocalName -eq 'connectionType')
                            {
                                $DescList += &quot;connectionType: $($attr2b.'#text')&quot;
                            }
                        }
                        #&gt;
                    }
                    Else
                    {
                        #$DescList += &quot; $($attr2.LocalName): $($attr2.'#text')&quot;
                    }
                }
            }
            ElseIf ($attr.LocalName -eq 'name')
            {
                $DescList += $attr.'#text'
            }
            ElseIf ($attr.LocalName -eq 'globalFlags')
            {
                #  These are more clutter than useful.  Best to look directly at the policies
                #$DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
            Else
            {
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLLanSvcNetworks
{
    Param(
        $Policies
    )
    [PSObject[]]$returnArray = @()
    [String]$policyName = 'LanSvcNetworks'
    [String[]]$DescList = @()
    [String]$Desc = ''
    [String]$Switch = ''
    
    ForEach ($policy in $Policies)
    {
        $DescList = @()
        $Desc = ''
        
        $DescList += &quot;$($policy.name)&quot;
        If ($policy.description)
        {
            $DescList += &quot;$($policy.description)&quot;
        }
        $DescList += &quot;enableAutoConfig: $($policy.globalFlags.enableAutoConfig); enableExplicitCreds: $($policy.globalFlags.enableExplicitCreds.'#text')&quot;
        $DescList += &quot;OneXEnabled: $($policy.profileList.LANProfile.MSM.security.OneXEnabled); OneXEnforced: $($policy.profileList.LANProfile.MSM.security.OneXEnforced)&quot;
        $DescList += &quot;authMode: $($policy.profileList.LANProfile.MSM.security.OneX.authMode); maxAuthFailures: $($policy.profileList.LANProfile.MSM.security.OneX.maxAuthFailures)&quot;


        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = $policyName
                            Additional = $Desc
                        }
    }

    Return $returnArray
}

#  Parse Security Options settings
Function Get-XMLPublicKey
{
    Param(
        $Policies
    )
    [PSObject[]]$returnArray = @()
    [String]$policyName = 'PublicKey'
    [String[]]$DescList = @()
    [String]$Desc = ''
    [String]$Switch = ''
    
    ForEach ($policy in $Policies)
    {
        $DescList = @()
        $Desc = ''
        
        If ($policy.LocalName -eq 'AutoEnrollmentSettings')
        {
            $DescList += &quot;EnrollCertificatesAutomatically: $($policy.EnrollCertificatesAutomatically)&quot;
            $DescList += &quot;ExpiryNotification: $($policy.ExpiryNotification)&quot;
            $DescList += &quot;NotifyPercent: $($policy.NotifyPercent.Value)&quot;
            $DescList += &quot;RenewUpdateRevoke: $($policy.Options.RenewUpdateRevoke)&quot;
            $DescList += &quot;UpdateTemplates: $($policy.Options.UpdateTemplates)&quot;
        }
        ElseIf ($policy.LocalName -eq 'RootCertificateSettings' -or $policy.LocalName -eq 'EFSSettings')
        {
            #  Everything in here appears to be set automatically as a consequence of importing a trusted root CA certificate
            #  I need to check on the possibility that this could be set somewhere else
        }
        ElseIf ($policy.LocalName -eq 'RootCertificate' -or $policy.LocalName -eq 'TrustedPublishersCertificate' -or $policy.LocalName -eq 'EnterpriseTrustCertificate' -or
                $policy.LocalName -eq 'IntermediateCertificationAuthorityCertificate' -or $policy.LocalName -eq 'EFSRecoveryAgent')
        {
            $DescList += &quot;IssuedTo: $($policy.IssuedTo)&quot;
            $DescList += &quot;IssuedBy: $($policy.IssuedBy)&quot;
            $DescList += &quot;ExpirationDate: $($policy.ExpirationDate)&quot;
            ForEach ($byte in (New-Object System.Security.Cryptography.SHA256Managed).ComputeHash([System.Text.Encoding]::UTF8.GetBytes($policy.Data)))
            {
                $Desc += $byte.ToString('x2')
            }
            $DescList += &quot;CertFileSha256: $($Desc)&quot;
            If ($policy.CertificatePurpose)
            {
                $DescList += &quot;CertificatePurpose: $($policy.CertificatePurpose.Purpose.ToString())&quot;
            }
        }
        Else
        {
            ForEach ($attr in $policy.ChildNodes)
            {
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
        }

        $Desc = $DescList -join &quot;`n&quot;
        If ($Desc -ne '')
        {
            $returnArray += New-Object PSObject -Property @{
                                PolicyName = &quot;$($policyName)-$($policy.LocalName)&quot;
                                Additional = $Desc
                            }
        }
    }

    Return $returnArray
}

#  Parse Internet Explorer Maintenance settings
Function Get-XMLInternetExplorerMaintenance
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'InternetExplorerMaint'
    [String]$subName = ''
    [String[]]$DescList = @()
    
    ForEach ($policy in $Policies.ChildNodes)
    {
        $DescList = @()
        $Desc = ''
        $subName = ''
        
        If ($policy.LocalName -eq 'EscOffLocalSites' -or $policy.LocalName -eq 'EscOffTrustedSites' -or $policy.LocalName -eq 'EscOffRestrictedSites' -or $policy.LocalName -eq 'EscOffSecurityZoneAndPrivacy')
        {
            #  Process later
        }
        Else
        {
            If ($policy.ChildNodes.Count -gt 1)
            {
                $subName = &quot;-$($policy.LocalName)&quot;
                ForEach ($attr in $policy.ChildNodes)
                {
                    If ($attr.ChildNodes.Count -gt 1)
                    {
                        ForEach ($subattr in $attr.ChildNodes)
                        {
                            $DescList += &quot;$($attr.LocalName) $($subattr.LocalName): $($subattr.'#text')$($subattr.Value)&quot;
                        }
                    }
                    Else
                    {
                        $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
                    }
                }
            }
            Else
            {
                $DescList += &quot;$($policy.LocalName): $($policy.'#text')$($policy.Value)&quot;
            }
        }

        If ($DescList.Count -gt 0)
        {
            $Desc = $DescList -join &quot;`n&quot;

            $returnArray += New-Object PSObject -Property @{
                                PolicyName = &quot;$($policyName)$($subName)&quot;
                                Additional = $Desc
                            }
        }
    }

    
    If ($Policies.EscOffSecurityZoneAndPrivacy)
    {
        ForEach ($attr in $Policies.EscOffSecurityZoneAndPrivacy.ChildNodes)
        {
            $subName = ''
            $DescList = @()
            $Desc = ''

            If ($attr.LocalName -eq 'Privacy')
            {
                $DescList += &quot;PrivacyLevel: $($attr.PrivacyLevel)&quot;
            }
            ElseIf ($attr.LocalName -eq 'ZoneSettings')
            {
                $subName = &quot;Zone$($attr.Name)&quot;
                $DescList += &quot;SecurityLevel: $($attr.SecurityLevel)&quot;
                $DescList += &quot;RequireVerification: $($attr.RequireVerification)&quot;
                If ($attr.SecurityLevel -eq 'Custom')
                {
                    ForEach ($subAttr in $attr.CustomSetting)
                    {
                        $DescList += &quot;$($subAttr.Name): $($subAttr.Value)&quot;
                    }
                }
            }
            ElseIf ($attr.LocalName -eq 'LocalZoneSettings')
            {
                $subName = &quot;$($attr.LocalName)&quot;
                ForEach ($subAttr in $attr.ChildNodes)
                {
                    $DescList += &quot;$($subAttr.LocalName): $($subAttr.'#text')&quot;
                }
            }
            Else
            {
                Write-Warning &quot;Unknown value in EscOffSecurityZoneAndPrivacy $($attr.LocalName): $($attr.'#text')$($attr.Value)&quot;
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }

            $Desc = $DescList -join &quot;`n&quot;

            $returnArray += New-Object PSObject -Property @{
                                PolicyName = &quot;$($policyName)$($subName)&quot;
                                Additional = $Desc
                            }
        }
    }
    
    If ($Policies.EscOffLocalSites)
    {
        $returnArray += New-Object PSObject -Property @{
                            PolicyName = &quot;$($policyName)-IntranetSites&quot;
                            Additional = ($Policies.EscOffTrustedSites).Value -join &quot;`n&quot;
                        }
    }
    If ($Policies.EscOffTrustedSites)
    {
        $returnArray += New-Object PSObject -Property @{
                            PolicyName = &quot;$($policyName)-TrustedSites&quot;
                            Additional = ($Policies.EscOffTrustedSites).Value -join &quot;`n&quot;
                        }
    }
    If ($Policies.EscOffRestrictedSites)
    {
        $returnArray += New-Object PSObject -Property @{
                            PolicyName = &quot;$($policyName)-RestrictedSites&quot;
                            Additional = ($Policies.EscOffTrustedSites).Value -join &quot;`n&quot;
                        }
    }

    Return $returnArray
}

#  Parse Scripts settings
Function Get-XMLScripts
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'Scripts'
    [String]$subName = ''
    [String[]]$DescList = @()
    
    If (($Policies.GetType()).Name -eq 'XmlElement')
    {
        $DescList += $Policies.Command
        If ($Policies.Parameters)
        {
            $DescList += &quot;Parameters: $($Policies.Parameters)&quot;
        }
        If ($Policies.Order -ne '0')
        {
            $DescList += &quot;Order: $($Policies.Order)&quot;
        }
        If ($Policies.RunOrder -ne 'PSNotConfigured')
        {
            $DescList += &quot;RunOrder: $($Policies.RunOrder)&quot;
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = &quot;$($policyName)-$($Policies.Type)&quot;
                            Additional = $Desc
                        }
    }
    Else
    {
        ForEach ($Policy in $Policies)
        {
            $DescList = @()
            $DescList += $Policy.Command
            If ($Policy.Parameters)
            {
                $DescList += &quot;Parameters: $($Policy.Parameters)&quot;
            }
            If ($Policy.Order -ne '0')
            {
                $DescList += &quot;Order: $($Policy.Order)&quot;
            }
            If ($Policy.RunOrder -ne 'PSNotConfigured')
            {
                $DescList += &quot;RunOrder: $($Policy.RunOrder)&quot;
            }

            $Desc = $DescList -join &quot;`n&quot;

            $returnArray += New-Object PSObject -Property @{
                                PolicyName = &quot;$($policyName)-$($Policy.Type)&quot;
                                Additional = $Desc
                            }
        }
    }

    Return $returnArray
}

#  Parse Services settings
Function Get-XMLServices
{
    Param(
        $Policies
    )

    [PSObject[]]$returnArray = @()
    [String]$policyName = 'NTServices'
    [String]$subName = ''
    [String[]]$DescList = @()

    ForEach ($Policy in $Policies)
    {
        $DescList = @()
        $DescList += $Policy.Properties.serviceName
        ForEach ($attr in $Policy.ChildNodes)
        {
            If ($attr.LocalName -eq 'GPOSettingOrder')
            {
                #  Skip
            }
            ElseIf ($attr.LocalName -eq 'Properties')
            {
                ForEach ($subattr in $attr.Attributes)
                {
                    If ($subattr.LocalName -eq 'serviceName' -or ($subattr.LocalName -eq 'startupType' -and $subattr.'#text' -eq 'NOCHANGE'))
                    {
                        #  skip
                    }
                    Else
                    {
                        $DescList += &quot;$($subattr.LocalName): $($subattr.'#text')&quot;
                    }
                }
            }
            ElseIf ($attr.LocalName -eq 'Filters')
            {
                If ($attr.IsEmpty -eq $false)
                {
                    #  This is hopefully good enough for doing a targetting filter
                    If ($attr.InnerXml -match '(^.+?\s)(.+?)(\sxmlns.*$)')
                    {
                        $DescList += &quot;$($attr.LocalName): $($Matches[2])&quot;
                    }
                }
            }
            Else
            {
                $DescList += &quot;$($attr.LocalName): $($attr.'#text')&quot;
            }
        }

        $Desc = $DescList -join &quot;`n&quot;

        $returnArray += New-Object PSObject -Property @{
                            PolicyName = &quot;$($policyName)&quot;
                            Additional = $Desc
                        }
    }

    Return $returnArray
}


Function Parse-XMLGPOSettings
{
    Param(
        $Reports
    )

    #  XML Elements to skip in the &quot;Windows Firewall&quot; section
    [String[]]$ignoreListFirewall = @('Dir')
    #  Used to reduce the size of the computer/user type of GPO field in the Out-GridView view
    $PolicyTypes = @(@('Computer', 'C'), @('User', 'U'))
    #  Final list of policies.  Will be an array of custom objects
    [PSObject[]]$PolicyList = @()
    [Int32]$GPONum = 0

    #  Iterate through each of the GPOs
    ForEach ($gpo in $Reports.GPOS.GPO)
    {
        #  Remove the curly braces off the GPO's GUID
        [String]$identifier = $gpo.Identifier.Identifier.'#text'.Replace('{','').Replace('}','')
        [String]$GPOName = $gpo.Name
        [Int32]$LinkCount = ($gpo.LinksTo | Where-Object {$_.Enabled -eq 'true'} | Measure-Object).Count
        [Int32]$PermissionCount = 0
        
        If ($gpo.Computer.VersionDirectory -ne $gpo.Computer.VersionSysvol)
        {
            Write-Warning &quot;$($GPONum) '$($GPOName)' version mismatch on Computer side. $($gpo.Computer.VersionDirectory) (AD), $($gpo.Computer.VersionSysvol) (SYSVOL)&quot;
        }

        If ($gpo.User.VersionDirectory -ne $gpo.User.VersionSysvol)
        {
            Write-Warning &quot;$($GPONum) '$($GPOName)' version mismatch on User side. $($gpo.User.VersionDirectory) (AD), $($gpo.User.VersionSysvol) (SYSVOL)&quot;
        }
        
        ForEach ($Permission in $gpo.SecurityDescriptor.Permissions.ChildNodes)
        {
            If ($Permission.LocalName -eq 'TrusteePermissions' -and $Permission.Type.InnerText -eq 'Allow' -and $Permission.Standard.InnerText -like &quot;*Apply Group Policy*&quot;)
            {
                $PermissionCount++
            }
        }

        #  Process Computer then User side settings
        ForEach ($PolicyType in $PolicyTypes)
        {
            #  Each individual setting appears to be in its own ExtensionData element
            ForEach ($extension in $gpo.($Policytype[0]).ExtensionData)
            {
                #  GPO settings seem to fall into three categories
                #  1. A registry setting set via some known ADMX template (Registry)
                #  2. A custom registry setting not using an ADMX template (Windows Registry)
                #  3. Non-registry settings parsed by some internal Windows mechanism
                If ([String]($extension.Name) -eq 'Registry')
                {
                    ForEach ($policy in $extension.Extension.Policy)
                    {
                        [String]$policyName = $policy.Name
                        [String]$state = $policy.State
                        [String]$Additional = ''
                        
                        $Additional = Get-RegistryValues $Policy

                        $PolicyList += New-Object PSObject -Property @{
	                                        Identifier = $identifier
	                                        GPOName = $GPOName
                                            T = $PolicyType[1]
                                            L = $LinkCount
                                            PolicyName = $policyName
                                            State = $state
                                            Additional = $Additional
                                            P = $PermissionCount
                                        }
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Windows Registry')
                {
                    [PSObject[]]$registrySettings = @()
                    [String]$policyName = 'RegistrySettings'
                    $registrySettings = Get-XMLTreeRegistryValues $extension.Extension.RegistrySettings
                    ForEach ($registrySetting in $registrySettings)
                    {
                        Add-Member -InputObject $registrySetting -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $registrySetting -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $registrySetting -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $registrySetting -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $registrySetting -MemberType NoteProperty -Name 'PolicyName' -Value $policyName
                        Add-Member -InputObject $registrySetting -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($registrySettings.Count -ne 0)
                    {
                        $PolicyList += $registrySettings
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Windows Firewall')
                {
                    ForEach ($tempEntry in (Get-XMLFirewallSettings $extension.Extension.ChildNodes $identifier $GPOName $PolicyType[1] $LinkCount $PermissionCount))
                    {
                        $PolicyList += $tempEntry
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Advanced Audit Configuration')
                {
                    ForEach ($tempEntry in (Get-XMLAdvancedAuditSettings $extension.Extension.ChildNodes $identifier $GPOName $PolicyType[1] $LinkCount $PermissionCount))
                    {
                        $PolicyList += $tempEntry
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'WLanSvc Networks')
                {
                    $tempEntries = @()
                    $tempEntries += Get-XMLWLanSvcNetworks $extension.Extension.WLanSvcSetting.ChildNodes
                    ForEach ($tempEntry in $tempEntries)
                    {
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($tempEntries.Count -ne 0)
                    {
                        $PolicyList += $tempEntries
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'LanSvc Networks')
                {
                    $tempEntries = @()
                    $tempEntries += Get-XMLLanSvcNetworks $extension.Extension.Dot3SvcSetting.ChildNodes
                    ForEach ($tempEntry in $tempEntries)
                    {
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($tempEntries.Count -ne 0)
                    {
                        $PolicyList += $tempEntries
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Public Key')
                {
                    $tempEntries = @()
                    $tempEntries += Get-XMLPublicKey $extension.Extension.ChildNodes
                    ForEach ($tempEntry in $tempEntries)
                    {
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($tempEntries.Count -ne 0)
                    {
                        $PolicyList += $tempEntries
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Internet Explorer Maintenance')
                {
                    $tempEntries = @()
                    $tempEntries += Get-XMLInternetExplorerMaintenance $extension.Extension
                    ForEach ($tempEntry in $tempEntries)
                    {
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($tempEntries.Count -ne 0)
                    {
                        $PolicyList += $tempEntries
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Scripts')
                {
                    $tempEntries = @()
                    $tempEntries += Get-XMLScripts $extension.Extension.Script
                    ForEach ($tempEntry in $tempEntries)
                    {
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($tempEntries.Count -ne 0)
                    {
                        $PolicyList += $tempEntries
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Services')
                {
                    $tempEntries = @()
                    If (($extension.Extension.NTServices.NTService.GetType()).Name -eq 'Object[]')
                    {
                        $tempEntries += Get-XMLServices $extension.Extension.NTServices.NTService
                    }
                    Else
                    {
                        $tempEntries += Get-XMLServices @($extension.Extension.NTServices.NTService)
                    }
                    
                    ForEach ($tempEntry in $tempEntries)
                    {
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($tempEntries.Count -ne 0)
                    {
                        $PolicyList += $tempEntries
                    }
                }
                ElseIf ([String]($extension.Name) -eq 'Security')
                {
                    $tempEntries = @()
                    $SecurityChildren = @()
                    $SecurityChildren = ($extension.ChildNodes).ChildNodes | Where-Object {$_.LocalName -ne '#text'} | Group-Object LocalName
                    ForEach ($SecurityChild in $SecurityChildren)
                    {
                        $tempEntriesInner = @()
                        If ($SecurityChild.Name -eq 'UserRightsAssignment')
                        {
                            $tempEntries += Get-XMLUserRightsAssignment $SecurityChild.Group
                        }
                        ElseIf ($SecurityChild.Name -eq 'SecurityOptions')
                        {
                            $tempEntries += Get-XMLSecurityOptions $SecurityChild.Group
                        }
                        ElseIf ($SecurityChild.Name -eq 'Audit')
                        {
                            $tempEntries += Get-XMLTreeComplexValues $SecurityChild.Group '' 'Security Audit'
                        }
                        ElseIf ($SecurityChild.Name -eq 'SystemServices')
                        {
                            $tempEntries += Get-XMLSecuritySystemServices $SecurityChild.Group
                        }
                        ElseIf ($SecurityChild.Name -eq 'Account')
                        {
                            $tempEntries += Get-XMLTreeComplexValues $SecurityChild.Group '' 'Security Account'
                        }
                        ElseIf ($SecurityChild.Name -eq 'RestrictedGroups')
                        {
                            $tempEntries += Get-XMLSecurityRestrictedGroups $SecurityChild.Group
                        }
                        ElseIf ($SecurityChild.Name -eq 'Registry')
                        {
                            $tempEntries += Get-XMLSecurityRegistry $SecurityChild.Group
                        }
                        ElseIf ($SecurityChild.Name -eq 'EventLog')
                        {
                            $tempEntries += Get-XMLSecurityEventLog $SecurityChild.Group
                        }
                        ElseIf ($SecurityChild.Name -eq 'File')
                        {
                            $tempEntries += Get-XMLSecurityFile $SecurityChild.Group
                        }
                        Else
                        {
                            Write-Warning &quot;Unknown Security setting type '$($SecurityChild.Name)' in $($GPONum) $($GPOName) in $($Policytype[0]) side&quot;
                            $tempEntries += Get-XMLTreeComplexValues $SecurityChild.Group '' 'Security'
                        }
                    }
                    ForEach ($tempEntry in $tempEntries)
                    {
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'Identifier' -Value $identifier
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'GPOName' -Value $GPOName
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'T' -Value $PolicyType[1]
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'L' -Value $LinkCount
                        Add-Member -InputObject $tempEntry -MemberType NoteProperty -Name 'P' -Value $PermissionCount
                    }
                    If ($tempEntries.Count -ne 0)
            
</code></pre>

    <footer class="blog-footer">
        <p>© Joel "Jaykul" Bennett 2018.</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>