
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="PoshCode - Community resources for PowerShell coders">
    <meta name="author" content="OldDog">
    <title>The Old Dogs ExcelCookBo - PoshCode</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<div class="blog-post">
    <h2 class="blog-post-title">The Old Dogs ExcelCookBo</h2>
    <p class="blog-post-meta">
        <span class="blog-post-time">2010-07-15</span> by <a class="blog-post-author">OldDog</a>
    </p>

    <h1>The Old Dogs ExcelCookBo</h1>
<h3><a href="//scripts/1973.ps1">download</a></h3>
<p>This file was uploaded by a PowerGUI Script Editor Add-on.</p>
<pre><code class="language-posh">#
# DATE  : 6/21/2010
# COMMENT: This is an updated Version of my Cook Book from Augest of 2008
#
# 
#===============================================================
# All errors and mistakes are my own. Thanks to all who have helped
# along the way.
#
# One thing I would add is that if you are using  anything but a US locale version of Excel some of
# these scripts won't work, especially adding and saving workbooks.
#
# Here is a function that helps with this problem:
#
# From: http://blogs.msdn.com/powershell/archive/2006/04/25/583235.aspx
#
# ======================================================

Function Using-Culture (
[System.Globalization.CultureInfo]$culture,
[ScriptBlock]$script)
{
    $OldCulture = [System.Threading.Thread]::CurrentThread.CurrentCulture
    trap
    {
    [System.Threading.Thread]::CurrentThread.CurrentCulture = $OldCulture
    }
    [System.Threading.Thread]::CurrentThread.CurrentCulture = $culture
    $ExecutionContext.InvokeCommand.InvokeScript($script)
    [System.Threading.Thread]::CurrentThread.CurrentCulture = $OldCulture
} # End Function

Using-Culture en-us {
$xl= New-Object -COM Excel.Application
$xl.Visible = $true
$xl.DisplayAlerts = $False
$xl.Workbooks.Open(&quot;C:\Scripts\PowerShell\test.xls&quot;)
#$xl.Quit()
#[System.Runtime.InteropServices.Marshal]::ReleaseComObject($xl)
}
# ======================================================
#_______________________________________________________________________
# How do I create an Excel object? 
 
$xl = new-object -comobject excel.application 

# ________________________________________________________________________ 
#How do I make Excel visible?

$xl.Visible = $true

# ________________________________________________________________________
#
# How do I add a workbook? 
 
$wb = $xl.Workbooks.Add()
 
# By default this adds three empty worksheets
# ________________________________________________________________________
#
#
# How do I open an existing Workbook ?
#
$xl = New-Object -comobject Excel.Application
$xl.Visible = $true
$xl.DisplayAlerts = $False
$wb = $xl.Workbooks.Open(&quot;C:\Scripts\powershell\test.xls&quot;)

# ________________________________________________________________________
#
# 
#How do I add a worksheet to an existing workbook? 
 
$xl = new-object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False
$wb = $xl.Workbooks.Open(&quot;C:\Scripts\test.xls&quot;)
$ws = $xl.Sheets.Add()

#
# ________________________________________________________________________
#
# How do I activate a a worksheet?
# Create Excel.Application object
$xl = New-Object -comobject Excel.Application
# Show Excel
$xl.visible = $true
$xl.DisplayAlerts = $False
# Open a workbook
$wb = $xl.workbooks.open(&quot;C:\Scripts\PowerShell\test.xls&quot;)
# Get sheets
$ws1 = $wb.worksheets | where {$_.name -eq &quot;sheet1&quot;} #&lt;------- Selects sheet 1
$ws2 = $wb.worksheets | where {$_.name -eq &quot;sheet2&quot;} #&lt;------- Selects sheet 2
$ws3 = $wb.worksheets | where {$_.name -eq &quot;sheet3&quot;} #&lt;------- Selects sheet 3
# Activate sheet 1
$ws1.activate()
Start-Sleep 1 
# Activate sheet 2
$ws2.activate()
Start-Sleep 1 
# Activate sheet 3
$ws3.activate()
# _________________________________________________________________
# How do I change the value of a cell? 
 
$ws1.cells.Item(1,1).Value() = &quot;x&quot; 

# ________________________________________________________________________
#
# How do I Find a specified cell? 
#

$xlCellTypeLastCell = 11

$used = $ws.usedRange 
$lastCell = $used.SpecialCells($xlCellTypeLastCell) 
$row = $lastCell.row 

for ($i = 1; $i -le $row; $i++) {
If ($ws1.cells.Item(1,2).Value() = &quot;y&quot;) {
# &quot;do something&quot;
          }

}

# And another way:
#
$mainRng.Select()
$objSearch = $mainRng.Find(&quot;Grand Total&quot;)
$objSearch.Select()

# ________________________________________________________________________
#
# How do I find and delete empty rows in Excel?
#

Function DeleteEmptyRows {
$used = $ws.usedRange 
$lastCell = $used.SpecialCells($xlCellTypeLastCell) 
$row = $lastCell.row 

for ($i = 1; $i -le $row; $i++) {
    If ($ws.Cells.Item($i, 1).Value() -eq $Null) {
        $Range = $ws.Cells.Item($i, 1).EntireRow
        $Range.Delete()
        }
    }
} 

$xlCellTypeLastCell = 11 

$xl = New-Object -comobject excel.application 
$xl.Visible = $true 
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Open(&quot;C:\Scripts\Test.xls&quot;) # &lt;-- Change as required!
$ws = $wb.worksheets | where {$_.name -eq &quot;Servers&quot; } # &lt;-- Or Sheet1 or Whatever 

DeleteEmptyRows   # &lt;â€”Call Function 

 
# ________________________________________________________________________

#
#
# How do I set a range with variables? 
 
$ws1.range(&quot;a${Sumrow}:b$Sumrow&quot;).font.bold = &quot;true&quot; 

# separate the : from the $ with {} on the left hand side
# ________________________________________________________________________
#
# How do I Set range to a value?
 
$range4=$ws.range(&quot;3:3&quot;)
$range4.cells=&quot;Row 3&quot;

# ________________________________________________________________________
#
# How do I list the workbook's name? 
 
$wb.Name

# ______________________________________________________________
#
# How do I find the last used row number?

$xlCellTypeLastCell = 11
$used = $ws.usedRange
$lastCell = $used.SpecialCells($xlCellTypeLastCell)
$lastrow = $lastCell.row 

# Or

$mainRng = $ws1.UsedRange.Cells 
$RowCount = $mainRng.Rows.Count  
$R = $RowCount 

# ________________________________________________________________________
#
# How do I find the last used column number? 
#This works for columns and rows 
 
$mainRng = $ws1.UsedRange.Cells 
$ColCount = $mainRng.Columns.Count 
$RowCount = $mainRng.Rows.Count  
$xRow = $RowCount
$xCol = $ColCount 

# ________________________________________________________________________
#
# How do I loop through a range of cells by row number? 
 
$xl = New-Object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
for ($row = 1; $row -lt 11; $row++)
{
    $ws.Cells.Item($row,1) = $row
}
# ________________________________________________________________________
#
# How do I get today's date and format it as a string? 
 
$m = (get-date).month
$d = (get-date).day
$y = [string] (get-date).year
$y = $y.substring($y.length - 2, 2)
$f = &quot;C:\Scripts\&quot; + $m + &quot;-&quot; + $d + &quot;-&quot; + $y + &quot;.xlsx&quot;
$wb.SaveAs($F) # C:\Scripts\6-18-10.xlsx 

#
# ________________________________________________________________________
#
# How do I write a list of files to Excel? 
 
$xl = new-object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$row = 1
$s = dir Z:\MBSA_Report\ScanData\*.mbsa
$s | foreach -process {
    $ws.Cells.Item($row,1) = $_;
    $row++
}

#
# this takes a long file name with spaces and splits it up,
# It then picks out the 3rd element and writes it out.
# The 3rd element is [2] because the first one is [0].
# sample file name: AD-Dom - 3IDCT001 (5-21-2010 4-28 PM).mbsa 
 
$xl = new-object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$row = 1
dir Z:\MBSA_Report\ScanData\*.mbsa |
ForEach-Object {
$FileName = $_.name
$N = $FileName.tostring()
$E = $N.split()
$F = $E[2]
$ws.Cells.Item($row,1) = $F;
    $row++
}
#Or for the whole file name
$ws.Cells.Item($row,1) = $_;

# ________________________________________________________________________
#
# How do I write a list of processes to Excel? 
 
function Release-Ref ($ref) {
#[System.Runtime.Interopservices.Marshal]::ReleaseComObject($xl)
[System.Runtime.InteropServices.Marshal]::ReleaseComObject($ref)
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()
}
# -----------------------------------------------------
$xl = New-Object -comobject Excel.Application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$range = $ws.Cells.Item(1,1)
$row = 1
$s = Get-Process | Select-Object name
$s | foreach -process {
    $range = $ws.Cells.Item($row,1);
    $range.Value = $_.Name;
    $row++ } 
$wb.SaveAs(&quot;C:\Scripts\Get_Process.xls&quot;)
Release-Ref $range
Release-Ref $ws
Release-Ref $wb
$xl.Quit()
Release-Ref $xl
#***For a remote machine try
$strComputer = (remote machine name)
$P = gwmi win32_process -comp $strComputer

# ________________________________________________________________________
#
# How do I write the command history to Excel? 
 
function Release-Ref ($ref) {
#[System.Runtime.Interopservices.Marshal]::ReleaseComObject($xl)
[System.Runtime.InteropServices.Marshal]::ReleaseComObject($ref)
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()
}

$xl = New-Object -comobject Excel.Application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $excel.Workbooks.Add()
$ws = $workbook.Worksheets.Item(1)
$range = $worksheet.Cells.Item(1,1)
$row = 1
$s = Get-History | Select-Object CommandLine $s | foreach -process { `
$range = $worksheet.Cells.Item($row,1); `
$range.Value = $_.CommandLine; `
$row++ }
$xl.DisplayAlerts = $False
$wb.SaveAs(&quot;C:\Scripts\Get_CommandLine.xls&quot;)
Release-Ref $range
Release-Ref $ws
Release-Ref $wb
$xl.Quit()
Release-Ref $xl

# ________________________________________________________________________
#
# How Can I Convert a Tilde-Delimited File to Microsoft Excel Format?
# Script name: ConvertTilde.ps1
# Created on: 2007-01-06
# Author: Kent Finkle
# Purpose: How Can I Convert a Tilde-Delimited File to Microsoft Excel Format? 
 
$s = gc C:\Scripts\Test.txt
$s = $s -replace(&quot;~&quot;,&quot;`t&quot;)
$s | sc C:\Scripts\Test.txt
$xl = new-object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False
$wb = $xl.Workbooks.Open(&quot;C:\Scripts\Test.txt&quot;)

# ________________________________________________________________________
#
# How can I add Validation to an Excel Worksheet?
#
# $comments = @'
# Script name: Add-Validation.ps1
# Created on: Wednesday, September 19, 2007
# Author: Kent Finkle
# Purpose: How can I use Windows Powershell to Add Validation to an
# Excel Worksheet?
# '@
#-----------------------------------------------------

function Release-Ref ($ref) {
([System.Runtime.InteropServices.Marshal]::ReleaseComObject(
[System.__ComObject]$ref) -gt 0)
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()
} # End Function 
$xlValidateWholeNumber = 1
$xlValidAlertStop = 1
$xlBetween = 1
$xl = new-object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$r = $ws.Range(&quot;e5&quot;)
$r.Validation.Add($xlValidateWholeNumber,$xlValidAlertStop, $xlBetween, &quot;5&quot;, &quot;10&quot;)
$r.Validation.InputTitle = &quot;Integers&quot;
$r.Validation.ErrorTitle = &quot;Integers&quot;
$r.Validation.InputMessage = &quot;Enter an integer from five to ten&quot;
$r.Validation.ErrorMessage = &quot;You must enter a number from five to ten&quot; 
$a = Release-Ref $r
$a = Release-Ref $ws
$a = Release-Ref $wb
$a = Release-Ref $xl

# ________________________________________________________________________
#
# How do I add a Chart to an Excel Worksheet? 
 
$xrow = 1
$yrow = 8
$xl = New-Object -c excel.application
$xl.visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.workbooks.add()
$ws = $wb.sheets.item(1)
1..8 | % { $ws.Cells.Item(1,$_) = $_ }
1..8 | % { $ws.Cells.Item(2,$_) = 9-$_ }
$range = $ws.range(&quot;a${xrow}:h$yrow&quot;)
$range.activate
# create and assign the chart to a variable
$ch = $xl.charts.add()   # This will open a new sheet
$ch = $ws.shapes.addChart().chart # This will put the Chart in the selected WorkSheet
$ch.chartType = 58
$ch.setSourceData($range)
$ch.export(&quot;C:\test.jpg&quot;)
$xl.quit() 
# excel has 48 chart styles, you can cycle through all
1..48 | % {$ch.chartStyle = $_; $xl.speech.speak(&quot;Style $_&quot;); sleep 1}
$ch.chartStyle = 27      # &lt;-- use the one you like 

# And another Chart sample:

Function XLcharts {
$xlColumnClustered = 51
$xlColumns = 2
$xlLocationAsObject = 2
$xlCategory = 1
$xlPrimary = 1
$xlValue = 2
$xlRows = 1
$xlLocationAsNewSheet = 1
$xlRight = -4152
$xlBuiltIn =21
$xlCategory = 1 
$xl = New-Object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$ws = $wb.Sheets.Add()
$ws.Cells.Item(1, 2) =  &quot;Jan&quot;
$ws.Cells.Item(1, 3) =  &quot;Feb&quot;
$ws.Cells.Item(1, 4) =  &quot;Mar&quot;
$ws.Cells.Item(2, 1) =  &quot;John&quot;
$ws.Cells.Item(3, 1) =  &quot;Mae&quot;
$ws.Cells.Item(4, 1) =  &quot;Al&quot;
$ws.Cells.Item(2, 2) =  100
$ws.Cells.Item(2, 3) =  200
$ws.Cells.Item(2, 4) =  300
$ws.Cells.Item(3, 2) =  400
$ws.Cells.Item(3, 3) =  500
$ws.Cells.Item(3, 4) =  600
$ws.Cells.Item(4, 2) =  900
$ws.Cells.Item(4, 3) =  800
$ws.Cells.Item(4, 4) =  700 
$Range = $ws.range(&quot;A1:D4&quot;)
$ch = $xl.charts.add()
$ch.chartType = 58
$ch.name =&quot;Bar Chart&quot;
$ch.Tab.ColorIndex = 3
$ch.setSourceData($Range)
[void]$ch.Location, $xlLocationAsObject, &quot;Bar Chart&quot;
$ch.HasTitle = $False
$ch.Axes($xlCategory, $xlPrimary).HasTitle = $False
$ch.Axes($xlValue, $xlPrimary).HasTitle = $False 
$ch2 = $xl.Charts.Add() | Out-Null
$ch2.HasTitle = $true
$ch2.ChartTitle.Text = &quot;Sales&quot;
$ch2.Axes($xlCategory).HasTitle = $true
$ch2.Axes($xlCategory).AxisTitle.Text = &quot;1st Quarter&quot;
$ch2.Axes($xlValue).HasTitle = $True
$ch2.Axes($xlValue).AxisTitle.Text = &quot;Dollars&quot;
[void]$ch2.Axes($xlValue).Select
$ch2.name =&quot;Columns with Depth&quot;
$ch2.Tab.ColorIndex = 5
[void]$ws.cells.entireColumn.Autofit()
} # End Function
# ________________________________________________________________________
#
# How do I Move and resize a chart in an Excel Worksheet? 

$xl = New-Object -comobject Excel.Application	# Opens Excel and 3 empty Worksheets
# Show Excel
$xl.visible = $true
$xl.DisplayAlerts = $False
# Open a workbook
$wb = $xl.workbooks.add() 
#Create Worksheets
$ws = $wb.Worksheets.Item(1)
1..8 | % { $ws.Cells.Item(1,$_) = $_ }			# adds some data
1..8 | % { $ws.Cells.Item(2,$_) = 9-$_ }		# adds some data
# &lt; ----- This is the good part -------------------------------------------------------&gt;
$range = $ws.range(&quot;a${xrow}:h$yrow&quot;)			# sets the Data range we want to chart
# create and assign the chart to a variable
#$ch = $xl.charts.add()							# This will open a new sheet
$ch = $ws.shapes.addChart().chart				# This will put the Chart in the selected WorkSheet
$ch.chartType = 58								# Select Chart Type
$ch.setSourceData($range)						# Create the Chart
$RngToCover = $ws.Range(&quot;D5:J19&quot;)				# This is where we want the chart
$ChtOb = $ch.Parent								# This selects the curent Chart
$ChtOb.Top = $RngToCover.Top					# This moves it up to row 5
$ChtOb.Left = $RngToCover.Left					# and to column D 
$ChtOb.Height = $RngToCover.Height				# resize This sets the height of your chart to Rows 5 - 19
$ChtOb.Width = $RngToCover.Width				# resize This sets the width to Columns D - J
# ________________________________________________________________________
#
# How do I sort a column in an Excel Worksheet? 
 
$xlSummaryAbove = 0
$xlSortValues = $xlPinYin = 1
$xlAscending = 1
$xlDescending = 2
$xlYes = 1 
$xl = New-Object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1) 
# one-column sort
$r = $ws.UsedRange
$r2 = $ws.Range(&quot;B2&quot;) # Sorts on Column B and leaves Header alone 
$a = $r.sort($r2, $xlAscending) 
# two-column sort
$r = $ws.UsedRange
$r2 = $ws.Range(&quot;B2&quot;)
$r3 = $ws.Range(&quot;E2&quot;)
$a = $r.sort($r2, $xlAscending, $r3,$null, $xlAscending) 
# three-column sort
$r = $ws1.UsedRange
$r2 = $ws1.Range(&quot;B2&quot;)
$r3 = $ws1.Range(&quot;E2&quot;)
$r4 = $ws1.Range(&quot;C2&quot;) 
$a = $r.Sort($r2,$xlDescending,$r3,$null,$xlAscending, `
$r4,$xlAscending,$xlYes)

#-----------------------------------------------------
# How do I use xlConstants? 
 
$xlAutomatic=-4105
$xlBottom = -4107
$xlCenter = -4108
$xlContext = -5002
$xlContinuous=1
$xlDiagonalDown=5
$xlDiagonalUp=6
$xlEdgeBottom=9
$xlEdgeLeft=7
$xlEdgeRight=10
$xlEdgeTop=8
$xlInsideHorizontal=12
$xlInsideVertical=11
$xlNone=-4142
$xlThin=2 
$xl = new-object -com excel.application
$xl.visible=$true
$wb = $xl.workbooks.open(&quot;d:\book1.xls&quot;)
$ws = $wb.worksheets | where {$_.name -eq &quot;sheet1&quot;}
$selection = $ws.range(&quot;A1:D1&quot;)
$selection.select() 
$selection.HorizontalAlignment = $xlCenter
$selection.VerticalAlignment = $xlBottom
$selection.WrapText = $false
$selection.Orientation = 0
$selection.AddIndent = $false
$selection.IndentLevel = 0
$selection.ShrinkToFit = $false
$selection.ReadingOrder = $xlContext
$selection.MergeCells = $false
$selection.Borders.Item($xlInsideHorizontal).Weight = $xlThin 
 
## You can also try this to center a column: 
 
[reflection.assembly]::loadWithPartialname(&quot;Microsoft.Office.Interop.Excel&quot;) |
Out-Null
$xlConstants = &quot;microsoft.office.interop.excel.Constants&quot; -as [type] 
 
$ws.columns.item(&quot;F&quot;).HorizontalAlignment = $xlConstants::xlCenter
$ws.columns.item(&quot;K&quot;).HorizontalAlignment = $xlConstants::xlCenter

 
# The next four lines of code create four enumeration types.
# Enumeration types are used to tell Excel which values are allowed
# for specific types of options. As an example, xlLineStyle enumeration
# is used to determine the kind of line to draw: double, dashed, and so on.
# These enumeration values are documented on MSDN.
# To make the code easier to read, we create shortcut aliases for each
# of the four enumeration types we will be using.
# Essentially, we're casting a string that represents the name of the
# enumeration to a [type]. This technique is actually a pretty cool trick:
# http://technet.microsoft.com/en-us/magazine/2009.01.heyscriptingguy.aspx 
 
$lineStyle = &quot;microsoft.office.interop.excel.xlLineStyle&quot; -as [type]
$colorIndex = &quot;microsoft.office.interop.excel.xlColorIndex&quot; -as [type]
$borderWeight = &quot;microsoft.office.interop.excel.xlBorderWeight&quot; -as [type]
$chartType = &quot;microsoft.office.interop.excel.xlChartType&quot; -as [type] 

For($b = 1 ; $b -le 2 ; $b++)
{
$ws.cells.item(1,$b).font.bold = $true
$ws.cells.item(1,$b).borders.LineStyle = $lineStyle::xlDashDot
$ws.cells.item(1,$b).borders.ColorIndex = $colorIndex::xlColorIndexAutomatic
$ws.cells.item(1,$b).borders.weight = $borderWeight::xlMedium
}
$workbook.ActiveChart.chartType = $chartType::xl3DPieExploded
$workbook.ActiveChart.SetSourceData($range) 

# ________________________________________________________________________
#
# How do I use autofill in excel?
 
$xlFillWeekdays = 6 
$xl = New-Object -com excel.application
$xl.visible=$true
$wb = $xl.workbooks.add()
$ws = $wb.worksheets | where {$_.name -eq &quot;sheet1&quot;}
$range1= $ws.range(&quot;A1&quot;)
$range1.value() = (get-date).toString(&quot;d&quot;)
$range2 = $ws.range(&quot;A1:A25&quot;)
$range1.AutoFill($range2,$xlFillWeekdays)
$range1.entireColumn.Autofit() 
# Another example:
$xlCellTypeLastCell = 11
$xl = new-object -com excel.application
$xl.visible=$true
$wb = $xl.workbooks.add()
$ws = $wb.worksheets | where {$_.name -eq &quot;sheet1&quot;} 
$used = $ws.usedRange
$lastCell = $used.SpecialCells($xlCellTypeLastCell)
$lastrow = $lastCell.row 
$ws.Cells.Item(2,1).FormulaR1C1 = &quot;=CONCATENATE(C[+1],C[+2],C[+3])&quot;
$range1= $ws.range(&quot;A2&quot;)
$r = $ws.Range(&quot;A2:A$lastrow&quot;)
$range1.AutoFill($r) | Out-Null
[void]$range1.entireColumn.Autofit() 
$wb.close()
$xl.quit()

# ________________________________________________________________________
#
# How to get a range and format it in excel?
 
# get-excelrange.ps1
# opens an existing workbook in Excel 2007, using PowerShell
# and turns a range bold # Thomas Lee - t...@psp.co.uk
# Create base object
$xl = new-object -comobject Excel.Application 
# make Excel visible
$xl.visible = $true
$xl.DisplayAlerts = $False 
# open a workbook
$wb = $xl.workbooks.open(&quot;C:\Scripts\powershell\test.xls&quot;) 
 
# Get sheet1
$ws = $wb.worksheets | where {$_.name -eq &quot;sheet1&quot;} 
 
# Make A1-B1 bold
$range = $ws.range(&quot;A1:B1&quot;)
$range.font.bold = &quot;true&quot; 
 
# Make A2-B2 italic
$range2 = $ws.range(&quot;A2:B2&quot;)
$range2.font.italic = &quot;true&quot; 
 
# Set range to a value
$range4=$ws.range(&quot;3:3&quot;)
$range4.cells=&quot;Row 3&quot;

# Set range to a Font size
$range3=$ws.range(&quot;A2:B2&quot;)
$Range3.font.size=24 

# now format an entire row

$range4=$ws.range(&quot;3:3&quot;)

$range4.font.italic=&quot;$true&quot;
$range4.font.bold=$true
$range4.font.size=10
$range4.font.name=&quot;Comic Sans MS&quot; 
# now format a Range of cells
$ws.Range(&quot;D1:F5&quot;).NumberFormat = &quot;#,##0.00&quot;

# ______________________________________________________________________
#
# How do I add a comment to a cell in Excel? 
 
$xl = New-Object -com Excel.Application
$xl.visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$ws.Cells.Item(1,1) = â€œA value in cell A1.â€
[void]$ws.Range(&quot;A1&quot;).AddComment()
[void]$ws.Range(&quot;A1&quot;).comment.Visible = $False
[void]$ws.Range(&quot;A1&quot;).Comment.text(&quot;OldDog: `r this is a comment&quot;)
[void]$ws.Range(&quot;A2&quot;).Select 

# The 'r adds a line feed after the comment's author. This is required!
# ________________________________________________________________________
#
# How do I copy and Paste in Excel (special)?

$xl = New-Object -comobject Excel.Application
# Show Excel
$xl.visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1) 
$xlPasteValues = -4163          # Values only, not formulas
$xlCellTypeLastCell = 11        # to find last used cell
$used = $ws.usedRange
$lastCell = $used.SpecialCells($xlCellTypeLastCell)
$row = $lastCell.row
$range = $ws.UsedRange
[void]$ws.Range(&quot;A8:F$row&quot;).Copy()
[void]$ws.Range(&quot;A8&quot;).PasteSpecial(-4163) 

# __________________________________________________________________________
#
# How do I Add Worksheets, name them and save as today's date? 
#****************************************** 
# get today's date and format it as a string. 
 
$m = (get-date).month
$d = (get-date).day
$y = [string] (get-date).year
$y = $y.substring($y.length - 2, 2)
$f = &quot;C:\Scripts\&quot; + $m + &quot;-&quot; + $d + &quot;-&quot; + $y + &quot;.xlsx&quot; 
# Create Excel.Application object
$xl = New-Object -comobject Excel.Application
# Show Excel
$xl.visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1) 
# this will add 9 sheets to the default 3 for a total of 12 sheets 
for ($i = 0; $i -le 8; $i++) {
$ws = $wb.Sheets.Add() } 
# Now we name our new sheets 
$xl.Worksheets.item(1).name = &quot;Jan&quot;
$xl.Worksheets.item(2).name = &quot;Feb&quot;
$xl.Worksheets.item(3).name = &quot;Mar&quot;
$xl.Worksheets.item(4).name = &quot;Apr&quot;
$xl.Worksheets.item(5).name = &quot;May&quot;
$xl.Worksheets.item(6).name = &quot;June&quot;
$xl.Worksheets.item(7).name = &quot;July&quot;
$xl.Worksheets.item(8).name = &quot;Aug&quot;
$xl.Worksheets.item(9).name = &quot;Sept&quot;
$xl.Worksheets.item(10).name = &quot;Oct&quot;
$xl.Worksheets.item(11).name = &quot;Nov&quot;
$xl.Worksheets.item(12).name = &quot;Dec&quot; 
# and here we save it 
$wb.SaveAs($F) 

#*******************************************
# How do I find duplicate entries in Excel?
# This Function creates a spreadsheet with some
# duplicate names and then highlights the Dups in Blue
 
Function XLFindDups {
$xlExpression = 2
$xlPasteFormats = -4122
$xlNone = -4142
$xlToRight = -4161
$xlToLeft = -4159
$xlDown = -4121
$xlShiftToRight = -4161
$xlFillDefault = 0
$xlSummaryAbove = 0
$xlSortValues = $xlPinYin = 1
$xlAscending = 1
$xlDescending = 2
$xlYes = 1
$xlTopToBottom = 1
$xlPasteValues = -4163          # Values only, not formulas
$xlCellTypeLastCell = 11        # to find last used cell 
$xl = new-object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$ws.name = &quot;Concatenate&quot; 
$ws.Tab.ColorIndex = 4 
$ws.Cells.Item(1,1) = &quot;FirstName&quot;
$ws.Cells.Item(1,2) = &quot;MI&quot;
$ws.Cells.Item(1,3) = &quot;LastName&quot;
$ws.Cells.Item(2,1) = &quot;Jesse&quot;
$ws.Cells.Item(2,2) = &quot;L&quot;
$ws.Cells.Item(2,3) = &quot;Roberts&quot;
$ws.Cells.Item(3,1) = &quot;Mary&quot;
$ws.Cells.Item(3,2) = &quot;S&quot;
$ws.Cells.Item(3,3) = &quot;Talbert&quot;
$ws.Cells.Item(4,1) = &quot;Ben&quot;
$ws.Cells.Item(4,2) = &quot;N&quot;
$ws.Cells.Item(4,3) = &quot;Smith&quot;
$ws.Cells.Item(5,1) = &quot;Ed&quot;
$ws.Cells.Item(5,2) = &quot;S&quot;
$ws.Cells.Item(5,3) = &quot;Turner&quot;
$ws.Cells.Item(6,1) = &quot;Mary&quot;
$ws.Cells.Item(6,2) = &quot;S&quot;
$ws.Cells.Item(6,3) = &quot;Talbert&quot;
$ws.Cells.Item(7,1) = &quot;Jesse&quot;
$ws.Cells.Item(7,2) = &quot;L&quot;
$ws.Cells.Item(7,3) = &quot;Roberts&quot;
$ws.Cells.Item(8,1) = &quot;Joe&quot;
$ws.Cells.Item(8,2) = &quot;L&quot;
$ws.Cells.Item(8,3) = &quot;Smith&quot;
$ws.Cells.Item(9,1) = &quot;Ben&quot;
$ws.Cells.Item(9,2) = &quot;A&quot;
$ws.Cells.Item(9,3) = &quot;Smith&quot; 
$used = $ws.usedRange
$lastCell = $used.SpecialCells($xlCellTypeLastCell)
$lastrow = $lastCell.row 
$range4=$ws.range(&quot;2:2&quot;)
$range4.Select() | Out-Null
$xl.ActiveWindow.FreezePanes = $true
$ws.cells.EntireColumn.AutoFit() | Out-Null
$range1 = $ws.Range(&quot;A1&quot;).EntireColumn
$range1.Insert($xlShiftToRight) | Out-Null
$range1.Select() | Out-Null
$ws.Cells.Item(1, 1) = &quot;Concat&quot;
$r2 = $ws.Range(&quot;A2&quot;)
$r2.Select() | Out-Null
$ws.Cells.Item(2,1).FormulaR1C1 = &quot;=CONCATENATE(C[+1],C[+2],C[+3])&quot;
$range1= $ws.range(&quot;A2&quot;)
$r = $ws.Range(&quot;A2:A$lastrow&quot;)
$range1.AutoFill($r) | Out-Null
$range.EntireColumn.AutoFit() | Out-Null
$select = $range1.SpecialCells(11).Select()  | Out-Null
$ws.Range(&quot;A2:A$lastrow&quot;).Copy()| Out-Null
$ws1 = $wb.Sheets.Add()
$ws1.name = &quot;FindDups&quot;
$ws1 = $wb.worksheets | where {$_.name -eq &quot;FindDups&quot;}
$ws1.Tab.ColorIndex = 5
$ws1.Select() | Out-Null
[void]$ws1.Range(&quot;A2&quot;).PasteSpecial(-4163)
$ws1.Range(&quot;A1&quot;).Select() | Out-Null 
$objRange = $xl.Range(&quot;B1&quot;).EntireColumn
[void] $objRange.Insert($xlShiftToRight) 
$ws1.Cells.Item(1, 2) = &quot;Dups&quot;
$range = $ws.range(&quot;B1:D$lastrow&quot;)
$range.copy() | Out-Null
[void]$ws1.Range(&quot;C1&quot;).PasteSpecial(-4163) 
$ws1.Cells.Item(2,2).FormulaR1C1 = &quot;=COUNTIF(C[-1],RC[-1])&gt;1&quot;
$range1= $ws1.range(&quot;B2&quot;)
$range2 = $ws1.range(&quot;B2:B$lastrow&quot;)
[void]$range1.AutoFill($range2,$xlFillDefault) 
# Thnaks to Wolfgang Kais for the following:
$xl.Range(&quot;B2&quot;).Select() | Out-Null
$xl.Selection.FormatConditions.Delete()
$xl.Selection.FormatConditions.Add(2, 0, &quot;=COUNTIF(A:A,A2)&gt;1&quot;) | Out-Null
$xl.Selection.FormatConditions.Item(1).Interior.ColorIndex = 8
$xl.Selection.Copy() | Out-Null
$xl.Columns.Item(&quot;B:B&quot;).Select() | Out-Null
$xl.Range(&quot;B2&quot;).Activate() | Out-Null
$xl.Selection.PasteSpecial(-4122, -4142, $false, $false) | Out-Null 
$r = $ws1.UsedRange
$r2 = $ws1.Range(&quot;B2&quot;)
$r3 = $ws1.Range(&quot;E2&quot;)
$r4 = $ws1.Range(&quot;C2&quot;) 
$a = $r.Sort($r2,$xlDescending,$r3,$null,$xlAscending, `
$r4,$xlAscending,$xlYes) 
$ws1.Application.ActiveWindow.FreezePanes=$true
[void]$ws1.cells.entireColumn.Autofit()
$s = $xl.Range(&quot;A1&quot;).EntireColumn
$s.Hidden = $true
$ws1.Range(&quot;B2&quot;).Select() | Out-Null
}

# ==============================================================================================
# How do I show all 57 Colors in Excel?

$xl = new-object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$row = 1
$i = 1
For($i = 1; $i -lt 57; $i++){
$ws.Cells.Item($row, 1) = &quot;'$'ws.Cells.Item($row, 2).Font.ColorIndex = &quot; + $row
$ws.Cells.Item($row, 2).Font.ColorIndex = $row
$ws.Cells.Item($row, 2) = &quot;test &quot; + $row
$row++
}
[void]$ws.cells.entireColumn.Autofit() 
 
# ==============================================================================================
# How do I insert a Hyperlink into an Excel Spreadsheet? 
 
function Release-Ref ($info) {
    foreach ( $p in $args ) {
        ([System.Runtime.InteropServices.Marshal]::ReleaseComObject(
        [System.__ComObject]$p) -gt 0)
        [System.GC]::Collect()
        [System.GC]::WaitForPendingFinalizers()
    }
} # End Function

Function XLHyperlinks {
$link = &quot;http://www.microsoft.com/technet/scriptcenter&quot; 
$xl = new-object -comobject excel.application
$xl.Visible = $true
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1) 
$ws.Cells.Item(1, 1).Value() = &quot;Script Center&quot;
$r = $ws.Range(&quot;A1&quot;)
$objLink = $ws.Hyperlinks.Add($r, $link)
$a = Release-Ref $r $ws $wb $xl
} # End Function

# ________________________________________________________________________ 
#
# How do I sum a column in Excel?
#

Function xlSum {
$range = $ws1.usedRange
$row = $range.rows.count # Takes you to the last used row
$Sumrow = $row + 1
$r = $ws1.Range(&quot;A2:A$row&quot;) # select the column to Add up
$functions = $xl.WorkSheetfunction
$ws.cells.item($Sumrow,1) = $functions.sum($r) # this uses the Excel sum function
$rangeString = $r.address().tostring() -replace &quot;\$&quot;,'' # convert formula to Text
$ws.cells.item($Sumrow,2) = &quot;Sum $rangeString&quot; # Print formula in Cell B &amp; last row + 1
$ws1.cells.item($Sumrow,1).Select()
$ws1.range(&quot;a${Sumrow}:b$Sumrow&quot;).font.bold = &quot;true&quot; # seperate the : from the $ with {}
$ws1.range(&quot;a${Sumrow}:b$Sumrow&quot;).font.size=12 # Changes the font size to 12 points
[void]$range.entireColumn.Autofit()
} # End Function

# ________________________________________________________________________
#
# How do I SubTotal a column in an Excel Worksheet?
#
#
#  Sample Spreadsheet
#          mon    tue    wed
# eggs        1     1      1
# ham         5     5      5
# spam       1     4      7
# spam        2     5      8
# spam        3     6      9
#
# Code to sub total
$xlSum = -4157
$range = $xl.range(&quot;A1:D6&quot;)
$range.Subtotal(1,-4157,(2,3,4),$true,$False,$true) 

#     Selection.Subtotal GroupBy:=1, Function:=xlSum, TotalList:=Array(4), _
#     Replace:=True, PageBreaks:=False, SummaryBelowData:=True
# ________________________________________________________________________
#
# In this example Subtotals are sums grouped by each change in field 1 &quot;Salesperson&quot;
# with Subtotals of field 2 &quot;Amount&quot;.
# Details of Subtotal function
# SubTotal GroupBy =2, Function =XLSum, TotalList =Array(1),
# Replace =False, PageBreaks =False, SummaryBelowData =$True 

Function XLSubtotals {
$xlExpression = 2
$xlPasteFormats = -4122
$xlNone = -4142
$xlToRight = -4161
$xlToLeft = -4159
$xlDown = -4121
$xlShiftToRight = -4161
$xlFillDefault = 0
$xlSummaryAbove = 0
$xlSortValues = $xlPinYin = 1
$xlAscending = 1
$xlDescending = 2
$xlYes = 1
$xlTopToBottom = 1
$xlPasteValues = -4163          # Values only, not formulas
$xlCellTypeLastCell = 11        # to find last used cell
$xlSum = -4157 
$xl = New-Object -comobject Excel.Application
$xl.Visible = $true
$xl.DisplayAlerts = $False
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$ws = $wb.Sheets.Add()
$xl.Worksheets.item(1).name = &quot;Detail&quot;
$xl.Worksheets.item(2).name = &quot;ShowLevels1&quot;
$xl.Worksheets.item(3).name = &quot;ShowLevels2&quot;
$xl.Worksheets.item(4).name = &quot;ShowLevels3&quot; 
$ws1 = $wb.worksheets | where {$_.name -eq &quot;Detail&quot;}
$ws2 = $wb.worksheets | where {$_.name -eq &quot;ShowLevels1&quot;} #&lt;------- Selects sheet 6
$ws3 = $wb.worksheets | where {$_.name -eq &quot;ShowLevels2&quot;} #&lt;------- Selects sheet 5
$ws4 = $wb.worksheets | where {$_.name -eq &quot;ShowLevels3&quot;} #&lt;------- Selects sheet 4 
$ws1.Tab.ColorIndex = 8
$ws1.Tab.ColorIndex = 5
$ws2.Tab.ColorIndex = 6
$ws3.Tab.ColorIndex = 7 
$ws1.Cells.Item(1,2) = &quot;Amount&quot;
$ws1.Cells.Item(1,1) = &quot;SalesPerson&quot;
$ws1.Cells.Item(2,2) = 7324
$ws1.Cells.Item(2,1) = &quot;Jack&quot;
$ws1.Cells.Item(3,2) = 294
$ws1.Cells.Item(3,1) = &quot;Elizabeth&quot;
$ws1.Cells.Item(4,2) = 41472
$ws1.Cells.Item(4,1) = &quot;Renee&quot;
$ws1.Cells.Item(5,2) = 25406
$ws1.Cells.Item(5,1) = &quot;Elizabeth&quot;
$ws1.Cells.Item(6,2) = 20480
$ws1.Cells.Item(6,1) = &quot;Jack&quot;
$ws1.Cells.Item(7,2) = 11294
$ws1.Cells.Item(7,1)= &quot;Renee&quot;
$ws1.Cells.Item(8,2) = 982040
$ws1.Cells.Item(8,1) = &quot;Elizabeth&quot;
$ws1.Cells.Item(9,2) = 2622368
$ws1.Cells.Item(9,1) = &quot;Jack&quot;
$ws1.Cells.Item(10,2) = 884144
$ws1.Cells.Item(10,1) = &quot;Renee&quot; 
$ws1.Range(&quot;B2&quot;).Select() | Out-Null
$ws1.Application.ActiveWindow.FreezePanes=$true
[void]$ws1.cells.entireColumn.Autofit() 
$ws1.Range(&quot;A1&quot;).Select() | Out-Null
$r = $ws.Range(&quot;A2:A10&quot;)
$r2 = $ws.Range(&quot;A2&quot;) # Sorts on Column B and leaves Header alone
$a = $r.sort($r2, $xlAscending) 
$range1 = $ws1.Range(&quot;A1:B1&quot;).EntireColumn
$Range1.Select() | Out-Null
#$ws.Range.SpecialCells(11)).Select()
$Range1.Copy()
$ws1.Range(&quot;A1&quot;).Select() | Out-Null 
$ws2.Select() | Out-Null
[void]$ws2.Range(&quot;A1&quot;).PasteSpecial(-4163)
$ws3.Select() | Out-Null
[void]$ws3.Range(&quot;A1&quot;).PasteSpecial(-4163)
$ws4.Select() | Out-Null
[void]$ws4.Range(&quot;A1&quot;).PasteSpecial(-4163) 
$ws2.Select() | Out-Null
$range = $xl.range(&quot;A1:B10&quot;)
$range.Subtotal(1,-4157,(2),$true,$False,$true)
$ws2.Outline.ShowLevels(1)
[void]$ws1.cells.entireColumn.Autofit()
$ws2.Range(&quot;A1&quot;).Select() | Out-Null 
$ws3.Select() | Out-Null
$range = $xl.range(&quot;A1:B10&quot;)
$range.Subtotal(1,-4157,(2),$true,$False,$true)
$ws3.Outline.ShowLevels(2)
[void]$ws1.cells.entireColumn.Autofit()
$ws3.Range(&quot;A1&quot;).Select() | Out-Null 
$ws4.Select() | Out-Null
$range = $xl.range(&quot;A1:B10&quot;)
$range.Subtotal(1,-4157,(2),$true,$False,$true)
$ws4.Outline.ShowLevels(3) 
$ws1.Select() | Out-Null
[void]$ws1.cells.entireColumn.Autofit()
$ws1.Range(&quot;A1&quot;).Select() | Out-Null
} # End Function

#---------------------------------------------------
#
#How do I set up Auto Filters in Excel?
#This function sets up a spreadsheet and then sets Auto filters 
 
Function XLAutoFilter {
$xlTop10Items = 3
$xlTop10Percent = 5
$xlBottom10Percent = 6
$xlBottom10Items = 4
$xlAnd = 1
$xlOr = 2
$xlNormal = -4143
$xlPasteValues = -4163          # Values only, not formulas
$xlCellTypeLastCell = 11        # to find last used cell 
$xl = New-Object -comobject Excel.Application
$xl.Visible = $true
$xl.DisplayAlerts = $False
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1)
$ws = $wb.Sheets.Add()
$ws = $wb.Sheets.Add() 
$ws1 = $wb.worksheets | where {$_.name -eq &quot;Sheet1&quot;}        #&lt;------- Selects sheet 1
$ws2 = $wb.worksheets | where {$_.name -eq &quot;Sheet2&quot;}         #&lt;------- Selects sheet 2
$ws3 = $wb.worksheets | where {$_.name -eq &quot;Sheet3&quot;}         #&lt;------- Selects sheet 3
$ws4 = $wb.worksheets | where {$_.name -eq &quot;Sheet4&quot;}         #&lt;------- Selects sheet 4
$ws5 = $wb.worksheets | where {$_.name -eq &quot;Sheet5&quot;}        #&lt;------- Selects sheet 5 
$ws1.Tab.ColorIndex = 8
$ws2.Tab.ColorIndex = 7
$ws3.Tab.ColorIndex = 6
$ws4.Tab.ColorIndex = 5
$ws5.Tab.ColorIndex = 4 
$ws1.name = &quot;Detail&quot;
$ws2.name = &quot;JackOnly&quot;
$ws3.name = &quot;Top2&quot;
$ws4.name = &quot;LowestHighest&quot;
$ws5.name = &quot;Top25Percent&quot; 
$ws1.cells.Item(1,1) =  &quot;Amount&quot;
$ws1.cells.Item(1,2) =  &quot;SalesPerson&quot;
$ws1.cells.Item(2,1) = 1
$ws1.cells.Item(2,2) = &quot;Jack&quot;
$ws1.cells.Item(3,1) = 2
$ws1.cells.Item(3,2) = &quot;Elizabeth&quot;
$ws1.cells.Item(4,1) = 3
$ws1.cells.Item(4,2) = &quot;Renee&quot;
$ws1.cells.Item(5,1) = 4
$ws1.cells.Item(5,2) = &quot;Elizabeth&quot;
$ws1.cells.Item(6,1) = 5
$ws1.cells.Item(6,2) = &quot;Jack&quot;
$ws1.cells.Item(7,1) = 6
$ws1.cells.Item(7,2) = &quot;Renee&quot;
$ws1.cells.Item(8,1) = 7
$ws1.cells.Item(8,2) = &quot;Elizabeth&quot;
$ws1.cells.Item(9,1) = 8
$ws1.cells.Item(9,2) = &quot;Jack&quot;
$ws1.cells.Item(10,1) = 9
$ws1.cells.Item(10,2) = &quot;Renee&quot;
$ws1.cells.Item(11,1) = 10
$ws1.cells.Item(11,2) = &quot;Jack&quot;
$ws1.cells.Item(12,1) = 11
$ws1.cells.Item(12,2) = &quot;Jack&quot;
$ws1.cells.Item(13,1) = 12
$ws1.cells.Item(13,2) = &quot;Elizabeth&quot;
$ws1.cells.Item(14,1) = 13
$ws1.cells.Item(14,2) = &quot;Renee&quot;
$ws1.cells.Item(15,1) = 14
$ws1.cells.Item(15,2) = &quot;Elizabeth&quot;
$ws1.cells.Item(16,1) = 15
$ws1.cells.Item(16,2) = &quot;Jack&quot;
$ws1.cells.Item(17,1) = 16
$ws1.cells.Item(17,2) = &quot;Renee&quot;
$ws1.cells.Item(18,1) = 17
$ws1.cells.Item(18,2) = &quot;Elizabeth&quot;
$ws1.cells.Item(19,1) = 18
$ws1.cells.Item(19,2) = &quot;Jack&quot;
$ws1.cells.Item(20,1) = 19
$ws1.cells.Item(20,2) = &quot;Renee&quot;
$ws1.cells.Item(21,1) = 20
$ws1.cells.Item(21,2) = &quot;Renee&quot; 
$used = $ws1.usedRange
$lastCell = $used.SpecialCells($xlCellTypeLastCell)
$lastrow = $lastCell.row 
$r = $ws1.Range(&quot;A1:B$lastrow&quot;)
$ws1.Range(&quot;A1:B$lastrow&quot;).Copy() 
$ws2.Select() | Out-Null
[void]$ws2.Range(&quot;A1&quot;).PasteSpecial(-4163)
$ws3.Select() | Out-Null
[void]$ws3.Range(&quot;A1&quot;).PasteSpecial(-4163)
$ws4.Select() | Out-Null
[void]$ws4.Range(&quot;A1&quot;).PasteSpecial(-4163)
$ws5.Select() | Out-Null
[void]$ws5.Range(&quot;A1&quot;).PasteSpecial(-4163)
#
$ws5.Range(&quot;A1&quot;).Select()
# AutoFilter structure - Field, Criteria, Operator
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Items        #top 10
$xl.Range(&quot;A1&quot;).Select() | Out-Null
$xl.Selection.AutoFilter(1, &quot;2&quot;, $xlTop10Items)            #top 2
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Percent        #top 10 percent
#$xl.Selection.AutoFilter 1, &quot;25&quot;, $$xlTop10Percent        #top 25 percent
#$xl.Selection.AutoFilter 1, &quot;5&quot;, $xlBottom10Items        #Lowest 5 Items
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $$xlBottom10Percent    #Bottom 10 percent
#$xl.Selection.AutoFilter 1, &quot;&gt;15&quot;                        #size greater 15
#$xl.Selection.AutoFilter 1, &quot;&gt;19&quot;,XLOr , &quot;&lt;2&quot;            #Lowest and Highest
#$xl.Selection.AutoFilter 2, &quot;Jack&quot;                        #Jack items only
$ws5.cells.Item.EntireColumn.AutoFit 
$ws2.Select()
$ws2.Range(&quot;A1&quot;).Select()
# AutoFilter structure - Field, Criteria, Operator
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Items        #top 10
#$xl.Selection.AutoFilter 1, &quot;2&quot;, $xlTop10Items            #top 2
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Percent        #top 10 percent
#$xl.Selection.AutoFilter 1, &quot;25&quot;, $xlTop10Percent        #top 25 percent
#$xl.Selection.AutoFilter 1, &quot;5&quot;, $xlBottom10Items        #Lowest 5 Items
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlBottom10Percent    #Bottom 10 percent
#$xl.Selection.AutoFilter 1, &quot;&gt;15&quot;                        #size greater 15
#$xl.Selection.AutoFilter 1, &quot;&gt;19&quot;,XLOr , &quot;&lt;2&quot;            #Lowest and Highest
$xl.Selection.AutoFilter(2, &quot;Jack&quot;)                        #Jack items only
$ws2.cells.Item.EntireColumn.AutoFit 
$ws4.Select()
$ws4.Range(&quot;A1&quot;).Select()
# AutoFilter structure - Field, Criteria, Operator
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Items        #top 10
#$xl.Selection.AutoFilter 1, &quot;2&quot;, $xlTop10Items            #top 2
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Percent        #top 10 percent
#$xl.Selection.AutoFilter 1, &quot;25&quot;, $xlTop10Percent        #top 25 percent
#$xl.Selection.AutoFilter 1, &quot;5&quot;, $xlBottom10Items        #Lowest 5 Items
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlBottom10Percent    #Bottom 10 percent
#$xl.Selection.AutoFilter 1, &quot;&gt;15&quot;                        #size greater 15
$xl.Selection.AutoFilter(1, &quot;&gt;19&quot;,$xlOr , &quot;&lt;2&quot;)            #Lowest and Highest
#$xl.Selection.AutoFilter 2, &quot;Jack&quot;                        #Jack items only
$ws4.cells.Item.EntireColumn.AutoFit
# &quot;Top25Percent&quot;
$ws5.Select()
$ws5.Range(&quot;A1&quot;).Select()
# AutoFilter structure - Field, Criteria, Operator
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Items        #top 10
#$xl.Selection.AutoFilter 1, &quot;2&quot;, $xlTop10Items            #top 2
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlTop10Percent        #top 10 percent
$xl.Range(&quot;A1&quot;).Select() | Out-Null
$xl.Selection.AutoFilter(1,&quot;25&quot;,$xlTop10Percent)        #top 25 percent
#$xl.Selection.AutoFilter 1, &quot;5&quot;, $xlBottom10Items        #Lowest 5 Items
#$xl.Selection.AutoFilter 1, &quot;10&quot;, $xlBottom10Percent    #Bottom 10 percent
#$xl.Selection.AutoFilter 1, &quot;&gt;15&quot;                        #size greater 15
#$xl.Selection.AutoFilter 1, &quot;&gt;19&quot;,XLOr , &quot;&lt;2&quot;            #Lowest and Highest
#$xl.Selection.AutoFilter 2, &quot;Jack&quot;                        #Jack items only
$ws5.cells.Item.EntireColumn.AutoFit 
} # End Function

#---------------------------------------------------
#

#
# How do I set up a complex Formula in Excel?
# Here is one that creates a Complex Formula and executes it 
 
Function XLFormula1 {
$xl = New-Object -comobject excel.application
$xl.Visible = $true
$xl.DisplayAlerts = $False 
$wb = $xl.Workbooks.Add()
$ws = $wb.Worksheets.Item(1) 
$ws.name = &quot;ComplexFormula&quot;
$ws.Tab.ColorIndex = 9
$row = 2
$lastrow = $row
$Col = 3
$Off = $Col - 1
$ws.Cells.Item(1, 1) = &quot;FileName&quot;
$ws.Cells.Item(1, 2) = &quot;Folder&quot;
$ws.Cells.Item(1, 3) = &quot;FullPath&quot;
$ws.Cells.Item(2, 3) = &quot;c:\Folder1\FunctionFolder1\FunctionFolder2\File1.txt&quot;
$ws.Cells.Item(3, 3) = &quot;c:\Folder1\FunctionFolder1\FunctionFolder2\FunctionFolder3\File2.txt&quot;
$ws.Cells.Item(4, 3) = &quot;c:\Folder1\FunctionFolder1\FunctionFolder2\FunctionFolder3\FunctionFolder4\File3.txt&quot;
$lastrow = 4 
#Filename
$Range1 = $ws.Range(&quot;A2&quot;)
$ws.Cells.Item(2,1).FormulaR1C1 = &quot;=MID(C[2],FIND(CHAR(127),Substitute(C[2],&quot;&quot;\&quot;&quot;,CHAR(127),LEN(C[2])-LEN(Substitute(C[2],&quot;&quot;\&quot;&quot;,&quot;&quot;&quot;&quot;))))+1,254)&quot;
# Note I used 254 as a hardcoded length.  No filename should ever reach this length.  Howeverâ€¦.
# You could get the length programatically with the following
# &quot;=MID(C[2],FIND(CHAR(127),FunctionSubsTITUTE(C[2],&quot;&quot;\&quot;&quot;,CHAR(127),LEN(C[2])-LEN(Substitute(C[2],&quot;&quot;\&quot;&quot;,&quot;&quot;&quot;&quot;))))+1,LEN(C[2])-(FIND(CHAR(127),Substitute(C[2],&quot;&quot;\&quot;&quot;,CHAR(127),LEN(C[2])-LEN(Substitute(C[2],&quot;&quot;\&quot;&quot;,&quot;&quot;&quot;&quot;))))))&quot; 
$range2 = $ws.Range(&quot;A2:A$lastrow&quot;)
[void]$range1.AutoFill($range2,$xlFillDefault) 
#Folder
$lastrow = 4
$ws.Range(&quot;B2&quot;).Select() | Out-Null
$ws.Cells.Item(2,2).FormulaR1C1 = &quot;=LEFT(C[1],FIND(CHAR(127),Substitute(C[1],&quot;&quot;\&quot;&quot;,CHAR(127),LEN(C[1])-LEN(Substitute(C[1],&quot;&quot;\&quot;&quot;,&quot;&quot;&quot;&quot;))))-1)&quot;
$R1 = $ws.Range(&quot;B2&quot;)
$r2 = $ws.Range(&quot;B2:B$lastrow&quot;)
[void]$R1.AutoFill($R2,$xlFillDefault)
$ws.Cells.Item.EntireColumn.AutoFit
$ws.Range(&quot;A2&quot;).Select() | Out-Null
} # End Function

#---------------------------------------------------
#

# How do I set up a Pivot Table in Excel?
# I was working with MBSA reports here.
#
Function Pivot {
$xlPivotTableVersion12     = 3
$xlPivotTableVersion10     = 1
$xlCount                 = -4112
$xlDescending             = 2
$xlDatabase                = 1
$xlHidden                  = 0
$xlRowField                = 1
$xlColumnField             = 2
$xlPageField               = 3
$xlDataField               = 4    
# R1C1 means Row 1 Column 1 or &quot;A1&quot;
# R65536C5 means Row 65536 Column E or &quot;E65536&quot;
$PivotTable = $wb.PivotCaches().Create($xlDatabase,&quot;Report!R1C1:R65536C5&quot;,$xlPivotTableVersion10)
$PivotTable.CreatePivotTable(&quot;Pivot!R1C1&quot;) | Out-Null 
[void]$ws3.Select()
$ws3.Cells.Item(1,1).Select()
$wb.ShowPivotTableFieldList = $true 
$PivotFields = $ws3.PivotTables(&quot;PivotTable1&quot;).PivotFields(&quot;Server&quot;) # Worksheet Name is Server
$PivotFields.Orientation = $xlRowField
$PivotFields.Position = 1 
$PivotFields = $ws3.PivotTables(&quot;PivotTable1&quot;).PivotFields(&quot;KBID&quot;) # Column Header is KBID
$PivotFields.Orientation = $xlColumnField
$PivotFields.Position = 1 
$PivotFields = $ws3.PivotTables(&quot;PivotTable1&quot;).PivotFields(&quot;KBID&quot;) # The data is in this column
$PivotFields.Orientation=$xlDataField 
$mainRng = $ws3.UsedRange.Cells 
$RowCount = $mainRng.Rows.Count  
$R = $RowCount
$R = $R - 1    
$mainRng.Select()
$objSearch = $mainRng.Find(&quot;Grand Total&quot;)
$objSearch.Select()
$C = $objSearch.Column
Write-Host $C $R # this is just so I can see what's happining 
$xlSummaryAbove = 0 
$xlSortValues = $xlPinYin = 1
$xlAscending = 1 
$xlDescending = 2 
$range1 = $ws3.UsedRange 
$range2 = $ws3.Cells.Item(3, $C) 
# one-column sort --&gt; works 
[void]$range2.sort($range2, $xlDescending) # puts the highest numbers at the top
} # End Function
 

</code></pre>

</div>

    <footer class="blog-footer">
        <p>&copy; Joel &quot;Jaykul&quot; Bennett 2018</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="/js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>