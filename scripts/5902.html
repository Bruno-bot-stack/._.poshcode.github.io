
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sign up for PowerShell.Slack.com">
    <meta name="author" content="David">
    <title>Check for Service Outage - PoshCode</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<div class="blog-post">
    <h2 class="blog-post-title">Check for Service Outage</h2>
    <p class="blog-post-meta">
        <span class="blog-post-time">2015-06-19</span> by <a class="blog-post-author">David</a>
    </p>

    <h1>Check for Service Outage</h1>
<h3><a href="//scripts/5902.ps1">download</a></h3>
<p>This script checks for any service that is not running that needs to be running. This script creates a temp file with a list of the services that are not running and when this is detected as having values the script imports the entries from the .csv and emails them to the appropriate individuals. This script was designed to be ran repeatedly as a scheduled task.</p>
<pre><code class="language-posh">function RunSendEmail
{
	$date = Get-Date -Format F
    Send-MailMessage -To &quot;HelpDesk &lt;helpdesk@company.com&gt;&quot; -cc &quot;IT Tech #1 &lt;ittech@company.com&gt;&quot; -From &quot;Server Service Monitor &lt;no-reply-services@company.com&gt;&quot; -Subject &quot;[SERVER.company.com] Service Failure(s)&quot; -Body &quot;Report generated on: $date
    
    $NewBody&quot; -SmtpServer EMAILSERVER
}

#Filters the types of services you want to check.
Get-WmiObject Win32_Service | Where-Object {$_.Name -like '*Backup*' -and $_.StartMode -eq 'Auto' -and $_.State -eq 'Stopped'} | Select-Object Name | export-csv C:\temp\services.csv -NoTypeInformation
Get-WmiObject Win32_Service | Where-Object {$_.Name -like '*DLO*' -and $_.StartMode -eq 'Auto' -and $_.State -eq 'Stopped'} | Select-Object Name | export-csv C:\temp\services.csv -NoTypeInformation -Append
Get-WmiObject Win32_Service | Where-Object {$_.Name -like '*BKUPEXEC*' -and $_.StartMode -eq 'Auto' -and $_.State -eq 'Stopped'} | Select-Object Name | export-csv C:\temp\services.csv -NoTypeInformation -Append

#Logic. If the file is not empty then there are failures.
$NewBody = &quot;The following list are services found that are listed as to be automatically running`f&quot;
$NewBody = $NewBody + &quot;and are currently stopped / not running.`f`f&quot;
$NewBody = $NewBody + &quot;Failed Services:`f&quot;
$test = Import-CSV C:\temp\services.csv
if ($test -ne $NULL)
{
	Foreach ($line in $test)
	{
		$NewLine = $line.Name
		$NewLine = $NewLine + &quot;`f&quot;
		$NewBody = $NewBody + $NewLine

	}
	RunSendEmail
}
</code></pre>

</div>

    <footer class="blog-footer">
        <p>&copy; Joel &quot;Jaykul&quot; Bennett 2018</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="/js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>