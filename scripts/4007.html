<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sign up for PowerShell.Slack.com">
    <meta name="author" content="chriskenis">
    <title>Twitter Module v0.2.1b - PoshCode</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>

    <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
    <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/b167be35-3674-4571-8142-df1f7dcfc268">
<!--
    <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud" />
    <link rel="openid2.local_id" href="https://profiles.google.com/+JoelBennett" />
-->
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/Scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<h1>Twitter Module v0.2.1b</h1>
<h3><a href="//scripts/4007.ps1">download</a> - <a href="//scripts/3988.md">parent</a></h3>
<p>Social Media Scripting Framework - Twitter Library
very crude revision, catch code for revised functions</p>
<pre><code class="language-posh">&lt;#
&lt;#
Name: Social Media Scripting Framework
Module: Twitter
Version: 0.2 BETA
Date: 2013/02/03
Author: Carlos Veira Lorenzo
RoughRevision: chriskenis
e-mail: cveira [at] thinkinbig [dot] org
blog: thinkinbig.org
twitter: @cveira
facebook: www.facebook.com/cveira
Google+: gplus.to/cveira
LinkedIn: es.linkedin.com/in/cveira/

Support:
http://thinkinbig.org/oms/

Forums &amp; Communities:
facebook.com/ThinkInBig
gplus.to/ThinkInBig
http://bit.ly/SMSF-Forum

Code Mirror Sites:
https://smsf.codeplex.com/
https://github.com/cveira/social-media-scripting-framework
https://code.google.com/p/social-media-scripting-framework/
http://sourceforge.net/projects/smsf/

Social Media Scripting Framework.
Copyright (C) 2013 Carlos Veira Lorenzo.

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.

#&gt;

[Reflection.Assembly]::LoadWithPartialName(&quot;System.Security&quot;) | Out-Null
[Reflection.Assembly]::LoadWithPartialName(&quot;System.Net&quot;) | Out-Null

[string] $script:TweetContentPattern = 	'((?s)&lt;p[^&gt;]*js-tweet-text tweet-text[^&gt;]*&gt;(?&lt;TweetContent&gt;.*?)&lt;/p&gt;.*?' + `
										'&lt;li[^&gt;]*js-stat-count js-stat-retweets stat-count[^&gt;]*&gt;(?&lt;ReTweetStats&gt;.*?)&lt;/li&gt;.*?' + `
										'&lt;li[^&gt;]*js-stat-count js-stat-favorites stat-count[^&gt;]*&gt;(?&lt;FavoritesStats&gt;.*?)&lt;/li&gt;)|' + `
										'((?s)&lt;p[^&gt;]*js-tweet-text tweet-text[^&gt;]*&gt;(?&lt;TweetContent&gt;.*?)&lt;/p&gt;.*?' + `
										'&lt;li[^&gt;]*js-stat-count js-stat-retweets stat-count[^&gt;]*&gt;(?&lt;ReTweetStats&gt;.*?)&lt;/li&gt;)|' + `
										'((?s)&lt;p[^&gt;]*js-tweet-text tweet-text[^&gt;]*&gt;(?&lt;TweetContent&gt;.*?)&lt;/p&gt;.*?' + `
										'&lt;li[^&gt;]*js-stat-count js-stat-favorites stat-count[^&gt;]*&gt;(?&lt;FavoritesStats&gt;.*?)&lt;/li&gt;)|' + `
										'((?s)&lt;p[^&gt;]*js-tweet-text tweet-text[^&gt;]*&gt;(?&lt;TweetContent&gt;.*?)&lt;/p&gt;)'
$script:TwitterTimeOut = 3 * 60 * 1000 # seconds
[string] $script:TwitterUserAgent = &quot;PowerShell&quot; + (Get-Host).Version.Major
[string] $script:ApiRoot = &quot;http://api.twitter.com/1.1/&quot;


Function Get-TweetRetweetsFromPage([ref] $PageSourceCode){
[string] $RetweetsCountPattern = '&lt;strong[^&gt;]*[^&gt;]*&gt;(?&lt;RetweetsCount&gt;.*?)&lt;/strong&gt;'
if ($PageSourceCode.Value -match $script:TweetContentPattern){
	if ($Matches.ReTweetStats -match $RetweetsCountPattern){$Matches.RetweetsCount}
	else {0}
	}
else {0}
}

Function Get-TweetFavoritesFromPage([ref] $PageSourceCode){
[string] $FavoritesCountPattern = '&lt;strong[^&gt;]*[^&gt;]*&gt;(?&lt;FavoritesCount&gt;.*?)&lt;/strong&gt;'
if ($PageSourceCode.Value -match $script:TweetContentPattern){
	if ($Matches.FavoritesStats -match $FavoritesCountPattern){$Matches.FavoritesCount}
	else {0}
	}
else {0}
}

Function Get-TweetContentFromPage([ref] $PageSourceCode){
if ($PageSourceCode.Value -match $script:TweetContentPattern){$Matches.TweetContent}
else {&quot;N/D&quot;}
}

Function Get-TweetLinksFromPage([ref] $PageSourceCode){
[RegEx] $LinksPattern = '(data-expanded-url=&quot;(.*?)&quot;)+'
[string[]] $TweetLinks = @()

if ($PageSourceCode.Value -match $script:TweetContentPattern){
	$CurrentMatch = $LinksPattern.match($Matches.TweetContent)
	if (-not $CurrentMatch.Success){$TweetLinks += &quot;N/D&quot;}
	while ($CurrentMatch.Success){
		$TweetLinks += $CurrentMatch.Value.Split('&quot;')[1]
		$CurrentMatch = $CurrentMatch.NextMatch()
		}
	}
else {$TweetLinks += &quot;N/D&quot;}
return $TweetLinks
}

Function Get-TweetHashTagsFromPage([ref] $PageSourceCode){
[string] $HashTagNamePattern = &quot;%23(?&lt;HashTag&gt;.*?)&amp;amp&quot;
[RegEx] $LinksPattern = '(href=&quot;(.*?)&quot;)+'
[string[]] $TweetLinks = @()

if ($PageSourceCode.Value -match $script:TweetContentPattern){
	$CurrentMatch = $LinksPattern.match($Matches.TweetContent)
	if (-not $CurrentMatch.Success){$TweetLinks += &quot;N/D&quot;}
	while ($CurrentMatch.Success){
		if ($CurrentMatch.Value -match $HashTagNamePattern){$TweetLinks += $Matches.HashTag }
		$CurrentMatch = $CurrentMatch.NextMatch()
		}
	}
else {$TweetLinks += &quot;N/D&quot;}
return $TweetLinks
}

Function EscapeDataStringRfc3986([string]$text){
[string[]] $Rfc3986CharsToEscape = @(&quot;!&quot;, &quot;*&quot;, &quot;'&quot;, &quot;(&quot;, &quot;)&quot;)
[string] $EscapedText = [System.Uri]::EscapeDataString($text)
for ($i = 0; $i -lt $Rfc3986CharsToEscape.Length; $i++){
	$EscapedText = $EscapedText.Replace($Rfc3986CharsToEscape[$i], [System.Uri]::HexEscape($Rfc3986CharsToEscape[$i]))
	}
return $EscapedText
}

Function Set-OAuthSignature{
param(
[string] $HttpRequestType,
[string] $HttpEndpoint,
[string] $HttpQueryString,
[string] $OAuthNonce,
[string] $OAuthTimeStamp,
[string] $OAuthConsumerKey,
[string] $OAuthConsumerSecret,
[string] $OAuthToken,
[string] $OAuthTokenSecret
)
[string[]] $HttpQueryStringParameters
$ParameterString = @{}

if ($HttpQueryString.Length -gt 0){
	$HttpQueryStringParameters = $HttpQueryString.Split(&quot;&amp;&quot;)
	$HttpQueryStringParameters | ForEach-Object {$ParameterString.Add($_.Split(&quot;=&quot;)[0], $_.Split(&quot;=&quot;)[1]) }
	}
$ParameterString.Add(&quot;oauth_consumer_key&quot;, $OAuthConsumerKey)
$ParameterString.Add(&quot;oauth_nonce&quot;, $OAuthNonce)
$ParameterString.Add(&quot;oauth_signature_method&quot;, &quot;HMAC-SHA1&quot;)
$ParameterString.Add(&quot;oauth_timestamp&quot;, $OAuthTimeStamp)
$ParameterString.Add(&quot;oauth_token&quot;, $OAuthToken)
$ParameterString.Add(&quot;oauth_version&quot;, &quot;1.0&quot;)
$signature = $HttpRequestType + &quot;&amp;&quot;
# 1. The URL in the signature string HAS NO QUERY_STRING PARAMETERS
$signature += [System.Uri]::EscapeDataString($HttpEndpoint) + &quot;&amp;&quot;
# 2. All the parameters included in the QUERY_STRING {when calling [System.Net.WebRequest]::Create()} have to be included in the signature
# 3. When building the signature string, parameters must be in alphabetical order.
$ParameterString.Keys | Sort-Object | ForEach-Object {
	# [System.Uri]::EscapeDataString($_ + &quot;=&quot; + $ParameterString.$_ + &quot;&amp;&quot;) is not RFC3986 compliant in .NET &lt; 4.x!
	# RFC3986 compliancy is documented in OAuth 1.0A, not in Twitter documentation!
	$signature += EscapeDataStringRfc3986 $($_ + &quot;=&quot; + $ParameterString.$_ + &quot;&amp;&quot;)
	}
$signature = $signature.Substring(0, $signature.Length - 3)
$SignatureKey = [System.Uri]::EscapeDataString($OAuthConsumerSecret) + &quot;&amp;&quot; + [System.Uri]::EscapeDataString($OAuthTokenSecret)
$Hasher = New-Object System.Security.Cryptography.HMACSHA1
$Hasher.Key = [System.Text.Encoding]::ASCII.GetBytes($SignatureKey)
$OAuthSignature = [System.Convert]::ToBase64String($Hasher.ComputeHash([System.Text.Encoding]::ASCII.GetBytes($signature)))
return $OAuthSignature
}

Function Set-OAuthHeader{
param(
[string] $OAuthConsumerKey,
[string] $OAuthNonce,
[string] $OAuthSignature,
[string] $OAuthTimeStamp,
[string] $OAuthToken
)
$OAuthHeader = 'OAuth '
$OAuthHeader += 'oauth_consumer_key=&quot;' + [System.Uri]::EscapeDataString($OAuthConsumerKey) + '&quot;, '
$OAuthHeader += 'oauth_nonce=&quot;' + [System.Uri]::EscapeDataString($OAuthNonce) + '&quot;, '
$OAuthHeader += 'oauth_signature=&quot;' + [System.Uri]::EscapeDataString($OAuthSignature) + '&quot;, '
$OAuthHeader += 'oauth_signature_method=&quot;HMAC-SHA1&quot;, '
$OAuthHeader += 'oauth_timestamp=&quot;' + [System.Uri]::EscapeDataString($OAuthTimeStamp) + '&quot;, '
$OAuthHeader += 'oauth_token=&quot;' + [System.Uri]::EscapeDataString($OAuthToken) + '&quot;, '
$OAuthHeader += 'oauth_version=&quot;1.0&quot;'
return $OAuthHeader
}

Function Get-RawTweetRetweetedBy([string]$TweetPermaLink, [string]$Output = 'raw'){
[string] $HttpRequestType = &quot;GET&quot;
[string] $TwitterRawResponse = &quot;&quot;
[string] $ApiURL = $script:ApiRoot + &quot;/statuses/&quot; + $TweetPermaLink.Split(&quot;/&quot;)[5] + &quot;/retweeted_by.xml&quot;
# [string] $ApiURL = &quot;http://api.twitter.com/1/statuses/&quot; + $TweetPermaLink.Split(&quot;/&quot;)[5] + &quot;/retweeted_by.xml&quot; --&gt; = typo or version 1 iso 1.1 ???
[string] $HttpQueryString = &quot;&quot;

$OAuthConsumerKey = $TwitterConsumerKey
$OAuthConsumerSecret = $TwitterConsumerSecret
$OAuthToken = $TwitterAccessToken
$OAuthTokenSecret = $TwitterAccessTokenSecret
$OAuthNonce = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes([System.DateTime]::Now.Ticks.ToString()))
$OAuthTimeStamp = [int64](New-TimeSpan &quot;01 January 1970 00:00:00&quot; $(Get-Date)).TotalSeconds
$OAuthSignature = Set-OAuthSignature $HttpRequestType $ApiURL $HttpQueryString $OAuthNonce $OAuthTimeStamp $OAuthConsumerKey $OAuthConsumerSecret $OAuthToken $OAuthTokenSecret
$OAuthHeader = Set-OAuthHeader $OAuthConsumerKey $OAuthNonce $OAuthSignature $OAuthTimeStamp $OAuthToken
[System.Net.HttpWebRequest] $request = [System.Net.WebRequest]::Create($ApiURL)
$request.Method = $HttpRequestType
$request.UserAgent = $script:TwitterUserAgent
$request.Timeout = $script:TwitterTimeOut
$request.ContentType = &quot;application/x-www-form-urlencoded&quot;
$request.Headers.Add(&quot;Authorization&quot;, $OAuthHeader)

try {
	[System.Net.HttpWebResponse] $response = $request.GetResponse()
	if ($response -ne $null){
		$ResponseStream = New-Object System.IO.StreamReader($response.GetResponseStream())
		$ResponseStream.ReadToEnd().Trim() | Select-String -NotMatch &quot;api.twitter.com&quot; | ForEach-Object {$TwitterRawResponse += $_ } | Out-Null
		}
		switch ($Output){
		'raw'{return $TwitterRawResponse}
		'xml'{
			$TwitterXMLResponse = @()
			[xml]$TwitterRawResponse | ForEach-Object {$_.users.user } | ForEach-Object {
				$TwitterXMLResponse += New-Object PSObject -Property @{
					Name = $_.name
					ScreenName = $_.screen_name
					Description = $_.description
					URL = $_.url
					Friends = $_.friends_count
					Followers = $_.followers_count
					Tweets = $_.statuses_count
					Listed = $_.listed_count
					}
				}
			return $TwitterXMLResponse
			}
		}
	$response.Close()
	}
catch {$_.Exception.Message}
}

Function Get-RawTweetRetweetedByAsXml([string] $TweetPermaLink){
Get-RawTweetRetweetedBy -TweetPermaLink $TweetPermaLink -Output 'xml'
}

Function Get-RawTwitterAsJson {
param(
[string]$TwitterObject,
[string]$TweetPermaLink = &quot;&quot;,
[string]$UserName = &quot;&quot;,
[int] $results = 20,
[string] $FirstId = &quot;&quot;,
[string] $LastId = &quot;&quot;,
[string] $PageId = &quot;-1&quot;,
[int] $ResultsPerPage = 20
)
[string] $HttpRequestType = &quot;GET&quot;
[string] $HttpEndpoint = &quot;&quot;
[string] $HttpQueryString = &quot;&quot;
[string] $ApiURL = &quot;&quot;
switch ($TwitterObject){
	'TwitterMentions'{$ApiURL = $script:ApiRoot + &quot;statuses/mentions_timeline.json?count=20&amp;include_entities=true&amp;include_rts=true&quot;}
	'TweetRetweets'{$ApiURL = $script:ApiRoot + &quot;statuses/retweets/&quot; + $TweetPermaLink.Split(&quot;/&quot;)[5] + &quot;.json?count=100&quot;}
	'TwitterUser'{$ApiURL = $script:ApiRoot + &quot;users/show.json?screen_name=&quot; + $UserName.Trim() + &quot;&amp;include_entities=true&quot;}
	'Tweet'{$ApiURL = $script:ApiRoot + &quot;statuses/show.json?id=&quot; + $TweetPermaLink.Split(&quot;/&quot;)[5] + &quot;&amp;include_entities=true&quot;}
	'TwitterFavorites'{$ApiURL = $script:ApiRoot + &quot;favorites/list.json?count=20&amp;screen_name=&quot; + $UserName.Trim() + &quot;&amp;include_entities=true&quot;}
	'TweetsFromUser'{
		if (($FirstId -ne &quot;&quot;) -and ($FirstId -match &quot;\d+&quot;)){$FilterParameters += &quot;&amp;max_id=&quot; + $FirstId }
		if (($LastId -ne &quot;&quot;) -and ($LastId -match &quot;\d+&quot;)){$FilterParameters += &quot;&amp;since_id=&quot; + $LastId }
		$ApiURL = $script:ApiRoot + &quot;statuses/user_timeline.json?include_entities=true&amp;include_rts=true&amp;exclude_replies=true&amp;count=&quot; + $results + $FilterParameters + &quot;&amp;screen_name=&quot; + $UserName.Trim()
		}
	'TwitterTimeLine'{$ApiURL = $script:ApiRoot + &quot;statuses/home_timeline.json?include_entities=true&amp;count=20&quot;}
	'TwitterListSubscribers'{$ApiURL = $script:ApiRoot + &quot;lists/subscribers.json?slug=&quot; + $TweetPermaLink.Split(&quot;/&quot;)[4] + &quot;&amp;owner_screen_name=&quot; + $TweetPermaLink.Split(&quot;/&quot;)[3] + &quot;&amp;include_entities=true&amp;cursor=&quot; + $PageId + &quot;&amp;skip_status=true&quot;}
	'TwitterListMembers'{$ApiURL = $script:ApiRoot + &quot;lists/members.json?slug=&quot; + $TweetPermaLink.Split(&quot;/&quot;)[4] + &quot;&amp;owner_screen_name=&quot; + $TweetPermaLink.Split(&quot;/&quot;)[3] + &quot;&amp;include_entities=true&amp;cursor=&quot; + $PageId + &quot;&amp;skip_status=true&quot;}
	'TwitterListTimeLine'{$ApiURL = $script:ApiRoot + &quot;lists/statuses.json?slug=&quot; + $TweetPermaLink.Split(&quot;/&quot;)[4] + &quot;&amp;owner_screen_name=&quot; + $TweetPermaLink.Split(&quot;/&quot;)[3] + &quot;&amp;count=&quot; + $ResultsPerPage + &quot;&amp;include_entities=true&amp;include_rts=true&quot;}
	'TwitterUserFriendsFromUser'{$ApiURL = $script:ApiRoot + &quot;friends/list.json?screen_name=&quot; + $UserName.Trim() + &quot;&amp;include_entities=true&amp;cursor=&quot; + $PageId + &quot;&amp;skip_status=true&quot;}
	'TwitterFollowersFromUser'{$ApiURL = $script:ApiRoot + &quot;followers/list.json?screen_name=&quot; + $UserName.Trim() + &quot;&amp;include_entities=true&amp;cursor=&quot; + $PageId + &quot;&amp;skip_status=true&quot;}
	''{}
	}
if ($ApiURL.IndexOf(&quot;?&quot;) -ne -1){
	$HttpEndpoint = $ApiURL.Split(&quot;?&quot;)[0]
	$HttpQueryString = $ApiURL.Split(&quot;?&quot;)[1]
	}
else {
	$HttpEndpoint = $ApiURL
	$HttpQueryString = &quot;&quot;
	}
$OAuthConsumerKey = $TwitterConsumerKey
$OAuthConsumerSecret = $TwitterConsumerSecret
$OAuthToken = $TwitterAccessToken
$OAuthTokenSecret = $TwitterAccessTokenSecret
$OAuthNonce = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes([System.DateTime]::Now.Ticks.ToString()))
$OAuthTimeStamp = [int64](New-TimeSpan &quot;01 January 1970 00:00:00&quot; $(Get-Date)).TotalSeconds
$OAuthSignature = Set-OAuthSignature $HttpRequestType $HttpEndpoint $HttpQueryString $OAuthNonce $OAuthTimeStamp $OAuthConsumerKey $OAuthConsumerSecret $OAuthToken $OAuthTokenSecret
$OAuthHeader = Set-OAuthHeader $OAuthConsumerKey $OAuthNonce $OAuthSignature $OAuthTimeStamp $OAuthToken
[System.Net.HttpWebRequest] $request = [System.Net.WebRequest]::Create($ApiURL)
$request.Method = $HttpRequestType
$request.UserAgent = $script:TwitterUserAgent
$request.Timeout = $script:TwitterTimeOut
$request.ContentType = &quot;application/x-www-form-urlencoded&quot;
$request.Headers.Add(&quot;Authorization&quot;, $OAuthHeader)

try {
	[System.Net.HttpWebResponse] $response = $request.GetResponse()
	if ($response -ne $null){
		$ResponseStream = New-Object System.IO.StreamReader($response.GetResponseStream())
		$ResponseStream.ReadToEnd().Trim()
		}
	$response.Close()
	}
catch {$_.Exception.Message}
}

Function Get-RawTwitterMentionsAsJson {
Get-RawTwitterAsJson -TwitterObject 'TwitterMentions'
}
Function Get-RawTweetRetweetsAsJson($TweetPermaLink){
Get-RawTwitterAsJson -TwitterObject 'TweetRetweets' -TweetPermaLink $TweetPermaLink
}
Function Get-RawTwitterUserAsJson($UserName){
Get-RawTwitterAsJson -TwitterObject 'TwitterUser' -Username $Username
}
Function Get-RawTweetAsJson($TweetPermaLink){
Get-RawTwitterAsJson -TwitterObject 'Tweet' -TweetPermaLink $TweetPermaLink
}
Function Get-RawTwitterFavoritesAsJson($UserName){
Get-RawTwitterAsJson -TwitterObject 'TwitterFavorites' -UserName $UserName
}
Function Get-RawTweetsFromUserAsJson($UserName,$results = 20,$FirstId = &quot;&quot;,$LastId = &quot;&quot;){
Get-RawTwitterAsJson -TwitterObject 'TweetsFromUser' -UserName $UserName -results $results -FirstId $FirstId -LastId $LastId
}
Function Get-RawTwitterTimeLineAsJson{
Get-RawTwitterAsJson -TwitterObject 'TwitterTimeLine'
}
Function Get-RawTwitterListSubscribersAsJson($TweetPermaLink,$PageId = &quot;-1&quot; ) {
Get-RawTwitterAsJson -TwitterObject 'TwitterListSubscribers' -TweetPermaLink $TweetPermaLink -PageId $PageId
}
Function Get-RawTwitterListMembersAsJson($TweetPermaLink,$PageId = &quot;-1&quot;){
Get-RawTwitterAsJson -TwitterObject 'TwitterListMembers' -TweetPermaLink $TweetPermaLink -PageId $PageId
}
Function Get-RawTwitterListTimeLineAsJson($TweetPermaLink,$ResultsPerPage = 20){
Get-RawTwitterAsJson -TwitterObject 'TwitterListTimeLine' -TweetPermaLink $TweetPermaLink -ResultsPerPage $ResultsPerPage
}
Function Get-RawTwitterUserFriendsFromUserAsJson($UserName,$PageId = &quot;-1&quot;){
Get-RawTwitterAsJson -TwitterObject 'TwitterUserFriendsFromUser' -UserName $UserName -PageId $PageId
}
Function Get-RawTwitterFollowersFromUserAsJson($UserName,$PageId = &quot;-1&quot;){
Get-RawTwitterAsJson -TwitterObject 'TwitterFollowersFromUser' -UserName $UserName -PageId $PageId
}

Function Get-RawTwitterSearchAsJson{
param(
[string] $query,
[int] $ResultsPerPage = 20,
[string] $Language = &quot;&quot;,
[string] $ResultType = &quot;&quot;,
[string] $StartDate = &quot;&quot;,
[string] $GeoCode = &quot;&quot;,
[int64] $SinceId = 0,
[int64] $MaxId = 0
)
# https://dev.twitter.com/docs/api/1.1/get/search/tweets
# https://dev.twitter.com/docs/using-search
# https://dev.twitter.com/docs/working-with-timelines
[string] $HttpRequestType = &quot;GET&quot;
[string] $HttpEndpoint = &quot;&quot;
[string] $HttpQueryString = &quot;&quot;
[string] $TwitterRawResponse = &quot;&quot;
[string] $SearchParameters = &quot;include_entities=true&quot;

if ($ResultType -eq &quot;&quot;){$SearchParameters += &quot;&amp;result_type=mixed&quot;}
else {
	switch ($ResultType){
		&quot;mixed&quot; {$SearchParameters += &quot;&amp;result_type=mixed&quot;}
		&quot;recent&quot; {$SearchParameters += &quot;&amp;result_type=recent&quot;}
		&quot;popular&quot; {$SearchParameters += &quot;&amp;result_type=popular&quot;}
		default {$SearchParameters += &quot;&amp;result_type=mixed&quot;}
		}
	}

if (($StartDate -ne &quot;&quot;) -and ($StartDate -match &quot;\d{4}-\d{2}-\d{2}&quot;)){$SearchParameters += &quot;&amp;until=&quot; + $StartDate}
if (($GeoCode -ne &quot;&quot;) -and ($GeoCode -match &quot;(\-*[\d\.]+),(\-*[\d\.]+),(\d+)(km|mi)&quot;)){$SearchParameters += &quot;&amp;geocode=&quot; + $GeoCode}
if ($SinceId -ne 0){$SearchParameters += &quot;&amp;since_id=&quot; + $SinceId}
if ($MaxId -ne 0){$SearchParameters += &quot;&amp;max_id=&quot; + $MaxId}
$SearchParameters += &quot;&amp;count=&quot; + $ResultsPerPage + &quot;&amp;q=&quot;
[string] $ApiURL = $script:ApiRoot + &quot;search/tweets.json?&quot; + $SearchParameters + [System.Uri]::EscapeDataString($query.Trim())

if ($ApiURL.IndexOf(&quot;?&quot;) -ne -1){
	$HttpEndpoint = $ApiURL.Split(&quot;?&quot;)[0]
	$HttpQueryString = $ApiURL.Split(&quot;?&quot;)[1]
	}
else {
	$HttpEndpoint = $ApiURL
	$HttpQueryString = &quot;&quot;
	}
$OAuthConsumerKey = $TwitterConsumerKey
$OAuthConsumerSecret = $TwitterConsumerSecret
$OAuthToken = $TwitterAccessToken
$OAuthTokenSecret = $TwitterAccessTokenSecret
$OAuthNonce = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes([System.DateTime]::Now.Ticks.ToString()))
$OAuthTimeStamp = [int](New-TimeSpan &quot;01 January 1970 00:00:00&quot; $(Get-Date)).TotalSeconds
$OAuthSignature = Set-OAuthSignature $HttpRequestType $HttpEndpoint $HttpQueryString $OAuthNonce $OAuthTimeStamp $OAuthConsumerKey $OAuthConsumerSecret $OAuthToken $OAuthTokenSecret
$OAuthHeader = Set-OAuthHeader $OAuthConsumerKey $OAuthNonce $OAuthSignature $OAuthTimeStamp $OAuthToken
[System.Net.HttpWebRequest] $request = [System.Net.WebRequest]::Create($ApiURL)
$request.Method = $HttpRequestType
$request.UserAgent = $script:TwitterUserAgent
$request.Timeout = $script:TwitterTimeOut
$request.ContentType = &quot;application/x-www-form-urlencoded&quot;
$request.Headers.Add(&quot;Authorization&quot;, $OAuthHeader)

try {
	[System.Net.HttpWebResponse] $response = $request.GetResponse()
	if ($response -ne $null){
		$ResponseStream = New-Object System.IO.StreamReader($response.GetResponseStream())
		$ResponseStream.ReadToEnd().Trim()
		}
	$response.Close()
	}
catch {$_.Exception.Message}
}

Function Send-Tweet ([string] $TweetMessage){
# https://dev.twitter.com/docs/api/1.1/post/statuses/update
# Send-Tweet &quot;This is my first Tweet from #PowerShell using, raw #DotNet and #OAuth!&quot;
[string] $HttpRequestType = &quot;POST&quot;
[string] $HttpEndpoint = &quot;&quot;
[string] $HttpQueryString = &quot;&quot;
[string] $TwitterRawResponse = &quot;&quot;
[string] $ApiURL = $script:ApiRoot + &quot;statuses/update.json&quot;

if ($TweetMessage.Length -gt 140){$TweetMessage = $TweetMessage.Substring(0,140)}
# Body POST Data format is NOT documented!
# look at how the supplied example looks like @ https://dev.twitter.com/docs/api/1.1/post/statuses/update
[byte[]] $HttpPostBody = [System.Text.Encoding]::UTF8.GetBytes(&quot;status=&quot; + (EscapeDataStringRfc3986 ($TweetMessage)))
$HttpEndpoint = $ApiURL
# The 'status' parameter gets encoded TWICE in the OAuth signature. This detail is NOT documented!
# Run an example with the OAuth Tool and look at the results for the OAuth signature.
# [System.Uri]::EscapeDataString() is not RFC3986 compliant in .NET &lt; 4.x!
# RFC3986 compliancy is documented in OAuth 1.0A, not in Twitter documentation!
$HttpQueryString = &quot;status=&quot; + (EscapeDataStringRfc3986 $TweetMessage)
$OAuthConsumerKey = $TwitterConsumerKey
$OAuthConsumerSecret = $TwitterConsumerSecret
$OAuthToken = $TwitterAccessToken
$OAuthTokenSecret = $TwitterAccessTokenSecret
$OAuthNonce = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes([System.DateTime]::Now.Ticks.ToString()))
$OAuthTimeStamp = [int](New-TimeSpan &quot;01 January 1970 00:00:00&quot; $(Get-Date)).TotalSeconds
$OAuthSignature = Set-OAuthSignature $HttpRequestType $HttpEndpoint $HttpQueryString $OAuthNonce $OAuthTimeStamp $OAuthConsumerKey $OAuthConsumerSecret $OAuthToken $OAuthTokenSecret
$OAuthHeader = Set-OAuthHeader $OAuthConsumerKey $OAuthNonce $OAuthSignature $OAuthTimeStamp $OAuthToken
[System.Net.HttpWebRequest] $request = [System.Net.WebRequest]::Create($ApiURL)
$request.Method = $HttpRequestType
$request.UserAgent = $script:TwitterUserAgent
$request.Timeout = $script:TwitterTimeOut
$request.ContentType = &quot;application/x-www-form-urlencoded&quot;
$request.ContentLength = $HttpPostBody.Length
$request.ServicePoint.Expect100Continue = $false
$request.Headers.Add(&quot;Authorization&quot;, $OAuthHeader)

try {
	[System.IO.Stream] $RequestBody = $request.GetRequestStream()
	$RequestBody.Write($HttpPostBody, 0, $HttpPostBody.Length)
	# $RequestBody.Flush()
	$RequestBody.Close()
	[System.Net.HttpWebResponse] $response = $request.GetResponse()
	if ($response -ne $null){
		$ResponseStream = New-Object System.IO.StreamReader($response.GetResponseStream())
		$ResponseStream.ReadToEnd().Trim()
		}
	$response.Close()
	}
catch {$_.Exception.Message}
}

Function Get-TwitterProfile([string]$UserName){Get-RawTwitterUserAsJson $UserName | ConvertFrom-JSON}

Function Get-UnpagedFollowerList([object[]] $PagedFollowersList){
$UnpagedFollowers = @()
$PagedFollowersList | ForEach-Object {$UnpagedFollowers += $_.users }
$UnpagedFollowers = $UnpagedFollowers | Select-Object * -unique
return $UnpagedFollowers
}

Function Get-TwitterFollowers([string] $UserName){
begin{
[PSCustomObject[]] $RawFollowersPages = @()
$CurrentPage = $null
$TimeToWait = 66
$FollowersPerPage = 20
$PageCount = 0
[int] $TotalFollowers = (Get-RawTwitterUserAsJson $UserName | ConvertFrom-JSON).followers_count
}

process{
try {
	$PageCount = 1
	$CurrentPage = Get-RawTwitterFollowersFromUserAsJson $UserName | ConvertFrom-JSON
	$RawFollowersPages += $CurrentPage
	do {
		Write-Progress -Activity &quot;Retrieving Followers ...&quot; -Status &quot;Progress: &quot; -PercentComplete ((($PageCount * $FollowersPerPage) / $TotalFollowers) * 100)
		$PageCount++
		$RawFollowersPages += $CurrentPage
		Start-Sleep -Seconds $TimeToWait
		$CurrentPage = Get-RawTwitterFollowersFromUserAsJson $UserName -PageId $CurrentPage.next_cursor | ConvertFrom-JSON
		}
	until ($CurrentPage.next_cursor -eq 0)
	}
catch {
	[PSCustomObject[]] $RawFollowersPages = @()
	$_.Exception.Message
	}
}

end {
Get-UnpagedFollowerList $RawFollowersPages
# $RawFollowersPages
}
}

Function Get-TweetsFromUser{
param(
[string]$UserName,
[int]$results = 20,
[switch]$quick,
[switch]$IncludeAll
)
# Get-TweetsFromUser cveira -results 250 -quick
# $DebugPreference = &quot;Continue&quot;
[PSObject[]] $TimeLine = @()
[PSObject[]] $tweets = @()
$SourcePattern = '((?s)&lt;a[^&gt;]*[^&gt;]*&gt;(?&lt;TweetSource&gt;.*?)&lt;/a&gt;)'
$TwitterMaxResults = 100
$TimeToWait = 6
$ExtendedTimeToWait = 0
$TimeToWaitForRTs = 66
$TimeToWaitForFavs = 66
$IncludeRTs = $false
$IncludeFavorites = $false

if ($quick){
	$IncludeAll = $false
	$IncludeRTs = $false
	$IncludeFavorites = $false
	}
elseif ($IncludeAll){
	$IncludeRTs = $true
	$IncludeFavorites = $true
	}
if ($TimeToWaitForRTs -ge $TimeToWaitForFavs){$ExtendedTimeToWait = $TimeToWaitForRTs}
else {$ExtendedTimeToWait = $TimeToWaitForFavs}
if ($results -lt $TwitterMaxResults){$tweets = Get-RawTweetsFromUserAsJson -UserName $UserName -results $results | ConvertFrom-Json}
else {
	do {
		Write-Progress -Activity &quot;Retrieving Tweets ...&quot; -Status &quot;Progress: $($tweets.Count) / $results&quot; -PercentComplete (($($tweets.Count) / $results) * 100)
		$CurrentTweets = Get-RawTweetsFromUserAsJson -UserName $UserName -results $TwitterMaxResults -FirstId $LastId | ConvertFrom-Json
		Write-Debug &quot;[INFO] Retrieved Tweets: $($tweets.Count)&quot;
		Write-Debug &quot;[INFO] CurrentTweets count: $($CurrentTweets.Count)&quot;
		Write-Debug &quot;[INFO] LastId: $LastId&quot;
		Write-Debug &quot;[INFO] FirstId: $($CurrentTweets[0].id)&quot;
		if ($CurrentTweets[0].id -eq $LastId){$FirstTweet = 1}
		else {$FirstTweet = 0}
		$LastId = $CurrentTweets[($CurrentTweets.Count -1)].id
		$tweets += $CurrentTweets[ $FirstTweet..($CurrentTweets.Count - 1) ]
		Start-Sleep -Seconds $TimeToWait
		}
	until ($tweets.Count -gt $results)
	$tweets = $tweets[0..($results - 1)]
	}
if ($quick){$tweets}
else {
	$i = 1
	$tweets | ForEach-Object {
		if ($IncludeAll){
			Write-Progress -Activity &quot;Normalizing Information ...&quot; -Status &quot;Progress: $i / $results - ETC: $((($results - $i) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes - Time Elapsed: $((($i - 1) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes&quot; -PercentComplete (($i / $results) * 100)
			}
		else {
			Write-Progress -Activity &quot;Normalizing Information ...&quot; -Status &quot;Progress: $i / $results&quot; -PercentComplete (($i / $results) * 100)
			}
		$NewTweet = $_
		$NewTweet.user = $NewTweet.user.screen_name
		if ($NewTweet.source -match $SourcePattern){
			$NewTweet.source = $Matches.TweetSource
			}
		Write-Debug &quot;.Links not exists: $($NewTweet.Links -eq $null)&quot;
		if ($NewTweet.Links -eq $null){
			$NewTweet | Add-Member -NotePropertyName Links -NotePropertyValue $NewTweet.entities.urls.expanded_url
			}
		else {
			$NewTweet.Links = $NewTweet.entities.urls.expanded_url
			}
		Write-Debug &quot;.HashTags not exists: $($null -eq $NewTweet.HashTags)&quot;
		if ($null -eq $NewTweet.HashTags){
			$NewTweet | Add-Member -NotePropertyName HashTags -NotePropertyValue $NewTweet.entities.hashtags.text -force
			}
		else {
			$NewTweet.HashTags = $NewTweet.entities.hashtags.text
			}
		Write-Debug &quot;.Mentions not exists: $($null -eq $NewTweet.Mentions)&quot;
		if ($null -eq $NewTweet.Mentions){
			$NewTweet | Add-Member -NotePropertyName Mentions -NotePropertyValue $NewTweet.entities.user_mentions.screen_name -force
			}
		else {
			$NewTweet.Mentions = $NewTweet.entities.user_mentions.screen_name
			}
		Write-Debug &quot;.PermaLink not exists: $($NewTweet.PermaLink -eq $null)&quot;
		if ($NewTweet.retweeted_status.user.screen_name -eq $null){
			if ($NewTweet.PermaLink -eq $null){
				$NewTweet | Add-Member -NotePropertyName PermaLink -NotePropertyValue &quot;https://twitter.com/$($NewTweet.user)/status/$($NewTweet.id)&quot;
				}
			else {
				$NewTweet.PermaLink = &quot;https://twitter.com/$($NewTweet.user)/status/$($NewTweet.id)&quot;
				}
			}
		else {
			if ($NewTweet.PermaLink -eq $null){
				$NewTweet | Add-Member -NotePropertyName PermaLink -NotePropertyValue &quot;https://twitter.com/$($NewTweet.retweeted_status.user.screen_name)/status/$($NewTweet.retweeted_status.id)&quot;
				}
			else {
				$NewTweet.PermaLink = &quot;https://twitter.com/$($NewTweet.retweeted_status.user.screen_name)/status/$($NewTweet.retweeted_status.id)&quot;
				}
			}
		Write-Debug &quot;[INFO] PermaLink: $($NewTweet.PermaLink)&quot;
		if ($IncludeRTs){
			if ($IncludeAll){
				Write-Progress -Activity &quot;Retrieving Retweets ...&quot; -Status &quot;Progress: $i / $results - ETC: $((($results - $i) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes - Time Elapsed: $((($i - 1) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes&quot; -PercentComplete (($i / $results) * 100)
				}
			else {
				Write-Progress -Activity &quot;Retrieving Retweets ...&quot; -Status &quot;Progress: $i / $results&quot; -PercentComplete (($i / $results) * 100)
				}
			Write-Debug &quot;.retweets not exists: $($NewTweet.entities.retweets -eq $null)&quot;
			if ($NewTweet.entities.retweets -eq $null){
				$NewTweet.entities | Add-Member -NotePropertyName retweets -NotePropertyValue @()
				}
			else {
				$NewTweet.entities.retweets = @()
				}
			Write-Debug &quot;.Interactions not exists: $($NewTweet.Interactions -eq $null)&quot;
			if ($NewTweet.Interactions -eq $null){
				$NewTweet | Add-Member -NotePropertyName Interactions -NotePropertyValue @()
				}
			else {
				$NewTweet.Interactions = @()
				}
			$NewTweet.entities.retweets = Get-RawTweetRetweetsAsJson $NewTweet.PermaLink | ConvertFrom-Json
			# $NewTweet.retweet_count = $NewTweet.entities.retweets.Count
			$NewTweet.Interactions += $NewTweet.entities.retweets | ForEach-Object {
				New-Object PSObject -Property @{
					screen_name = $_.user.screen_name
					location = $_.user.location
					}
				}
			Write-Debug &quot;[INFO] Retrieved Retweets: $($NewTweet.entities.retweets.Count)&quot;
			Write-Debug &quot;[INFO] Interactions: $($NewTweet.Interactions.Count)&quot;
			}
		if ($IncludeFavorites){
			if ($IncludeAll){
				Write-Progress -Activity &quot;Retrieving Favorites ...&quot; -Status &quot;Progress: $i / $results - ETC: $((($results - $i) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes - Time Elapsed: $((($i - 1) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes&quot; -PercentComplete (($i / $results) * 100)
				}
			else {
				Write-Progress -Activity &quot;Retrieving Favorites ...&quot; -Status &quot;Progress: $i / $results&quot; -PercentComplete (($i / $results) * 100)
				}
			Write-Debug &quot;.favorites_count not exists: $($NewTweet.favorites_count -eq $null)&quot;
			if ($NewTweet.favorites_count -eq $null){
				$NewTweet | Add-Member -NotePropertyName favorites_count -NotePropertyValue 0
				}
			else {
				$NewTweet.favorites_count = 0
				}
			$SourceCode = Get-PageSourceCode $NewTweet.PermaLink
			$NewTweet.favorites_count = Get-TweetFavoritesFromPage ([ref] $SourceCode)
			Write-Debug &quot;[INFO] Retrieved Favorites: $($NewTweet.favorites_count)&quot;
			}
		if ($IncludeAll){Start-Sleep -Seconds $ExtendedTimeToWait }
		$TimeLine += $NewTweet
		$i++
		}
	$TimeLine
	}# $DebugPreference = &quot;SilentlyContinue&quot;
}

Function Normalize-TwitterTimeLine{
param(
[PSObject[]]$TimeLine,
[switch]$IncludeAll
)
# $TimeLine = Normalize-TwitterTimeLine $tweets -IncludeAll
# $DebugPreference = &quot;Continue&quot;
[PSObject[]] $NewTimeLine = @()
$TimeToWait = 0
$TimeToWaitForRTs = 66
$TimeToWaitForFavs = 66
$SourcePattern = '((?s)&lt;a[^&gt;]*[^&gt;]*&gt;(?&lt;TweetSource&gt;.*?)&lt;/a&gt;)'
$i = 1
$IncludeRTs = $false
$IncludeFavorites = $false

if ($IncludeAll){$IncludeRTs = $IncludeFavorites = $true}
if ($TimeToWaitForRTs -ge $TimeToWaitForFavs){$TimeToWait = $TimeToWaitForRTs}
else {$TimeToWait = $TimeToWaitForFavs}
$TimeLine | ForEach-Object {
	$NewTweet = $_
	if ($IncludeAll){Write-Progress -Activity &quot;Normalizing Information ...&quot; -Status &quot;Progress: $i / $($TimeLine.Count) - ETC: $((($TimeLine.Count - $i)*($TimeToWaitForRTs + $TimeToWaitForFavs))/60) minutes - Time Elapsed: $((($i - 1)*($TimeToWaitForRTs + $TimeToWaitForFavs))/60) minutes&quot; -PercentComplete (($i / $TimeLine.Count)* 100)}
	else {Write-Progress -Activity &quot;Normalizing Information ...&quot; -Status &quot;Progress: $i / $($TimeLine.Count)&quot; -PercentComplete (($i / $TimeLine.Count) * 100)}
	$NewTweet.user = $NewTweet.user.screen_name
	if ($NewTweet.source -match $SourcePattern){$NewTweet.source = $Matches.TweetSource}
	Write-Debug &quot;.Links not exists: $($NewTweet.Links -eq $null)&quot;
	if ($NewTweet.Links -eq $null) {$NewTweet | Add-Member -NotePropertyName Links -NotePropertyValue $NewTweet.entities.urls.expanded_url}
	else {$NewTweet.Links = $NewTweet.entities.urls.expanded_url}
Write-Debug &quot;.HashTags not exists: $($null -eq $NewTweet.HashTags)&quot;
if ($null -eq $NewTweet.HashTags) {$NewTweet | Add-Member -NotePropertyName HashTags -NotePropertyValue $NewTweet.entities.hashtags.text -force}
	else {$NewTweet.HashTags = $NewTweet.entities.hashtags.text}
Write-Debug &quot;.Mentions not exists: $($null -eq $NewTweet.Mentions)&quot;
if ($null -eq $NewTweet.Mentions) {$NewTweet | Add-Member -NotePropertyName Mentions -NotePropertyValue $NewTweet.entities.user_mentions.screen_name -force}
	else {$NewTweet.Mentions = $NewTweet.entities.user_mentions.screen_name}
Write-Debug &quot;.PermaLink not exists: $($NewTweet.PermaLink -eq $null)&quot;
if ($NewTweet.retweeted_status.user.screen_name -eq $null) {
		if ($NewTweet.PermaLink -eq $null) {$NewTweet | Add-Member -NotePropertyName PermaLink -NotePropertyValue &quot;https://twitter.com/$($NewTweet.user)/status/$($NewTweet.id)&quot;}
		else {$NewTweet.PermaLink = &quot;https://twitter.com/$($NewTweet.user)/status/$($NewTweet.id)&quot;}
		}
	else {
		if ($NewTweet.PermaLink -eq $null) {$NewTweet | Add-Member -NotePropertyName PermaLink -NotePropertyValue &quot;https://twitter.com/$($NewTweet.retweeted_status.user.screen_name)/status/$($NewTweet.retweeted_status.id)&quot;}
		else {$NewTweet.PermaLink = &quot;https://twitter.com/$($NewTweet.retweeted_status.user.screen_name)/status/$($NewTweet.retweeted_status.id)&quot;}
		}
Write-Debug &quot;[INFO] PermaLink: $($NewTweet.PermaLink)&quot;
if ($IncludeRTs) {
		if ($IncludeAll) {Write-Progress -Activity &quot;Retrieving Retweets ...&quot; -Status &quot;Progress: $i / $($TimeLine.Count) - ETC: $((($TimeLine.Count - $i) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes - Time Elapsed: $((($i - 1) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes&quot; -PercentComplete (($i / $TimeLine.Count) * 100) }
		else {Write-Progress -Activity &quot;Retrieving Retweets ...&quot; -Status &quot;Progress: $i / $($TimeLine.Count)&quot; -PercentComplete (($i / $TimeLine.Count) * 100) }
		Write-Debug &quot;.retweets not exists: $($NewTweet.entities.retweets -eq $null)&quot;
		if ($NewTweet.entities.retweets -eq $null) {$NewTweet.entities | Add-Member -NotePropertyName retweets -NotePropertyValue @() }
		else {$NewTweet.entities.retweets = @() }
		Write-Debug &quot;.Interactions not exists: $($NewTweet.Interactions -eq $null)&quot;
		if ($NewTweet.Interactions -eq $null) {$NewTweet | Add-Member -NotePropertyName Interactions -NotePropertyValue @() }
		else {$NewTweet.Interactions = @() }
		$NewTweet.entities.retweets = Get-RawTweetRetweetsAsJson $NewTweet.PermaLink | ConvertFrom-Json
		# $NewTweet.retweet_count = $NewTweet.entities.retweets.Count
		$NewTweet.Interactions += $NewTweet.entities.retweets | ForEach-Object {
			New-Object PSObject -Property @{
				screen_name = $_.user.screen_name
				location = $_.user.location
				}
			}
		Write-Debug &quot;[INFO] Retrieved Retweets: $($NewTweet.entities.retweets.Count)&quot;
		Write-Debug &quot;[INFO] Interactions: $($NewTweet.Interactions.Count)&quot;
		}
if ($IncludeFavorites) {
		if ($IncludeAll) {Write-Progress -Activity &quot;Retrieving Favorites ...&quot; -Status &quot;Progress: $i / $($TimeLine.Count) - ETC: $((($TimeLine.Count - $i) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes - Time Elapsed: $((($i - 1) * ($TimeToWaitForRTs + $TimeToWaitForFavs)) / 60) minutes&quot; -PercentComplete (($i / $TimeLine.Count) * 100) }
		else {Write-Progress -Activity &quot;Retrieving Favorites ...&quot; -Status &quot;Progress: $i / $($TimeLine.Count)&quot; -PercentComplete (($i / $TimeLine.Count) * 100) }
		Write-Debug &quot;.favorites_count not exists: $($NewTweet.favorites_count -eq $null)&quot;
		if ($NewTweet.favorites_count -eq $null) {$NewTweet | Add-Member -NotePropertyName favorites_count -NotePropertyValue 0 }
		else {$NewTweet.favorites_count = 0 }
		$SourceCode = Get-PageSourceCode $NewTweet.PermaLink
		$NewTweet.favorites_count = Get-TweetFavoritesFromPage ([ref] $SourceCode)
		Write-Debug &quot;[INFO] Retrieved Favorites: $($NewTweet.favorites_count)&quot;
		}
if ($IncludeAll) {Start-Sleep -Seconds $TimeToWait }
$NewTimeLine += $NewTweet
$i++
	}# end $TimeLine foreach
	# $DebugPreference = &quot;SilentlyContinue&quot;
	$NewTimeLine
}

Function Analyze-TwitterHasTags() {
begin {
$HashTags = @{}
[PSObject[]] $ranking = @()
}

process {
$post = $_
$post.HashTags | ForEach-Object {
	if ($HashTags.ContainsKey(&quot;$_&quot;)) {		$HashTags[&quot;$_&quot;] = $HashTags[&quot;$_&quot;] + 1		}
	else {	$HashTags.Add(&quot;$_&quot;, 1)	}
	}
}

end {
$HashTags.keys | ForEach-Object {
	$ranking += New-Object PSObject -Property @{
		HashTag = $_
		Count = $HashTags.$_
		}
	}
return $ranking
}
}

Function Analyze-TwitterMentions() {
begin {
$Mentions = @{}
[PSObject[]] $ranking = @()
}

process {
$post = $_
$post.Mentions | ForEach-Object {
	if ($Mentions.ContainsKey(&quot;$_&quot;)) {	$Mentions[&quot;$_&quot;] = $Mentions[&quot;$_&quot;] + 1	}
	else {	$Mentions.Add(&quot;$_&quot;, 1)	}
	}
}

end {
$Mentions.keys | ForEach-Object {
	$ranking += New-Object PSObject -Property @{
		User = $_
		Count = $Mentions.$_
		}
	}
return $ranking
}
}


Function Analyze-TwitterTimeProfile([string] $range = 'month') {
begin {
$Hours = @{}
$DaysOfWeek = @{}
$Days = @{}
$Months = @{}
$Years = @{}
[PSObject[]] $ranking = @()
$DAY_OF_WEEK = 0
$MONTH = 1
$DAY = 2
$HOUR = 3
$YEAR = 5
}

process {
$post = $_
$CreationDate = $post.created_at.Split(&quot; &quot;)
$CurrentDayOfWeek = $CreationDate[$DAY_OF_WEEK]
$CurrentDay = $CreationDate[$DAY]
$CurrentMonth = $CreationDate[$MONTH]
$CurrentYear = $CreationDate[$YEAR]
$CurrentHour = $CreationDate[$HOUR].Split(&quot;:&quot;)[0]

switch ($range.ToLower()) {
	&quot;hour&quot; {
		if ($Hours.ContainsKey(&quot;$CurrentHour&quot;)) {		$Hours[&quot;$CurrentHour&quot;] = $Hours[&quot;$CurrentHour&quot;] + 1		}
		else {		$Hours.Add(&quot;$CurrentHour&quot;, 1)		}
		}
	&quot;DayOfWeek&quot; {
		if ($DaysOfWeek.ContainsKey(&quot;$CurrentDayOfWeek&quot;)) {		$DaysOfWeek[&quot;$CurrentDayOfWeek&quot;] = $DaysOfWeek[&quot;$CurrentDayOfWeek&quot;] + 1		}
		else {		$DaysOfWeek.Add(&quot;$CurrentDayOfWeek&quot;, 1)		}
		}
	&quot;day&quot; {
		if ($Days.ContainsKey(&quot;$CurrentDay&quot;)) {		$Days[&quot;$CurrentDay&quot;] = $Days[&quot;$CurrentDay&quot;] + 1		}
		else {		$Days.Add(&quot;$CurrentDay&quot;, 1)		}
		}
	&quot;month&quot; {
		if ($Months.ContainsKey(&quot;$CurrentMonth&quot;)) {		$Months[&quot;$CurrentMonth&quot;] = $Months[&quot;$CurrentMonth&quot;] + 1		}
		else {		$Months.Add(&quot;$CurrentMonth&quot;, 1)		}
		}
	&quot;year&quot; {
		if ($Years.ContainsKey(&quot;$CurrentYear&quot;)) {		$Years[&quot;$CurrentYear&quot;] = $Years[&quot;$CurrentYear&quot;] + 1		}
		else {		$Years.Add(&quot;$CurrentYear&quot;, 1)		}
		}
	default {
		if ($Months.ContainsKey(&quot;$CurrentMonth&quot;)) {		$Months[&quot;$CurrentMonth&quot;] = $Months[&quot;$CurrentMonth&quot;] + 1		}
		else {		$Months.Add(&quot;$CurrentMonth&quot;, 1)		}
		}
	}
}

end {
switch ($range.ToLower()) {
	&quot;hour&quot; {
		$Hours.keys | ForEach-Object {
			$ranking += New-Object PSObject -Property @{
				Hour = $_
				Count = $Hours.$_
				}
			}
		}
	&quot;DayOfWeek&quot; {
		$DaysOfWeek.keys | ForEach-Object {
			$ranking += New-Object PSObject -Property @{
				DayOfWeek = $_
				Count = $DaysOfWeek.$_
				}
			}
		}
	&quot;day&quot; {
		$Days.keys | ForEach-Object {
			$ranking += New-Object PSObject -Property @{
				Day = $_
				Count = $Days.$_
				}
			}
		}
	&quot;month&quot; {
		$Months.keys | ForEach-Object {
			$ranking += New-Object PSObject -Property @{
				Month = $_
				Count = $Months.$_
				}
			}
		}
	&quot;year&quot; {
		$Years.keys | ForEach-Object {
			$ranking += New-Object PSObject -Property @{
				Year = $_
				Count = $Years.$_
				}
			}
		}
	default {
		$Months.keys | ForEach-Object {
			$ranking += New-Object PSObject -Property @{
				Month = $_
				Count = $Months.$_
				}
			}
		}
	}
return $ranking
}
}

Function Analyze-TwitterInteractions() {
begin {
$Interactions = @{}
[PSObject[]] $ranking = @()
}

process {
$post = $_
$post.Interactions.screen_name | ForEach-Object {
	if ($Interactions.ContainsKey(&quot;$_&quot;)) {	$Interactions[&quot;$_&quot;] = $Interactions[&quot;$_&quot;] + 1	}
	else {	$Interactions.Add(&quot;$_&quot;, 1)	}
	}
}

end {
$Interactions.keys | ForEach-Object {
	$ranking += New-Object PSObject -Property @{
		User = $_
		Count = $Interactions.$_
		}
	}
return $ranking
}
}

Function Analyze-TwitterLocations() {
begin {
$Locations = @{}
[PSObject[]] $ranking = @()
}

process {
$post = $_
if ($post.Connections.location -eq $null) {$LocationInfo = $post.location}
else {$LocationInfo = $post.Connections.location}
$LocationInfo | ForEach-Object {
	if ($Locations.ContainsKey(&quot;$_&quot;)) {	$Locations[&quot;$_&quot;] = $Locations[&quot;$_&quot;] + 1	}
	else {	$Locations.Add(&quot;$_&quot;, 1)	}
	}
}

end {
$Locations.keys | ForEach-Object {
	$ranking += New-Object PSObject -Property @{
		Location = $_
		Count = $Locations.$_
		}
	}
return $ranking
}
}

Function Rebuild-TwitterTimeLine([PSObject[]] $from) {
[PSObject[]] $TimeLine = @()
$TimeToWait = 6
$i = 1
$ExecutionTime = [Diagnostics.Stopwatch]::StartNew()
$from | ForEach-Object {
	if ($SourceSchema.count -eq 0) {
		$SourceSchema = $_ | Get-Member -MemberType NoteProperty | ForEach-Object {$_.Name }
		$PropertyName = GetMatchesInCollection &quot;PermaLink&quot; $SourceSchema
		}
	$ExecutionTime.Stop()
	Write-Progress -Activity &quot;Retrieving tweets ...&quot; -Status &quot;Progress: $i / $($from.Count) - ETC: $('{0:#0.00}' -f (($from.Count - $i) * $ExecutionTime.Elapsed.TotalMinutes)) minutes - Time Elapsed: $('{0:#0.00}' -f (($i - 1) * $ExecutionTime.Elapsed.TotalMinutes)) minutes&quot; -PercentComplete (($i / $from.Count) * 100)
	$ExecutionTime = [Diagnostics.Stopwatch]::StartNew()
	if ($_.$PropertyName -match &quot;twitter.com&quot;) {
		$TimeLine += Get-RawTweetAsJson $_.$PropertyName | ConvertFrom-Json
		Start-Sleep -Seconds $TimeToWait
		}
	else {	Write-Host -foregroundcolor $COLOR_BRIGHT &quot; INFO: Skipping non-Twitter post: $($_.$PropertyName)&quot;}
	$i++
	}
return $TimeLine
}

Function Get-TwitterSearch{
param(
[string] $query,
[int] $results = 20,
[string] $language = &quot;&quot;,
[string] $type = &quot;mixed&quot;,
[string] $StartDate = &quot;&quot;,
[string] $GeoCode = &quot;&quot;
)
# Get-TwitterSearch -query &quot;#cloud&quot; -results 250
# $DebugPreference = &quot;Continue&quot;
[PSObject[]] $tweets = @()
$TwitterMaxResults = 100
$SecondsToWait = 6
[int64] $MaxId = 0
if (($type -ne &quot;recent&quot;) -and ($type -ne &quot;popular&quot;)) {$type = &quot;mixed&quot; }
if (-not (($StartDate -ne &quot;&quot;) -and ($StartDate -match &quot;\d{4}-\d{2}-\d{2}&quot;))) {$StartDate = &quot;&quot; }
if (-not (($GeoCode -ne &quot;&quot;) -and ($GeoCode -match &quot;(\-*[\d\.]+),(\-*[\d\.]+),(\d+)(km|mi)&quot;))) {$GeoCode = &quot;&quot; }
if (-not (($language -ne &quot;&quot;) -and ($language -match &quot;\w{2}&quot;))) {$language = &quot;&quot; }
if ($results -lt $TwitterMaxResults) {$tweets = (Get-RawTwitterSearchAsJson -query $query -ResultsPerPage $results -Language $language -ResultType $type -StartDate $StartDate -GeoCode $GeoCode).statuses | ConvertFrom-Json }
else {
	$MaxId = 0
	$ExecutionTime = [Diagnostics.Stopwatch]::StartNew()
	do {
		$ExecutionTime.Stop()
		Write-Progress -Activity &quot;Retrieving Tweets ...&quot; -Status &quot;Progress: $($tweets.Count) / $results - ETC: $('{0:#0.00}' -f (($results - $($tweets.Count)) * $ExecutionTime.Elapsed.TotalMinutes)) minutes - Time Elapsed: $('{0:#0.00}' -f (($($tweets.Count) - 1) * $ExecutionTime.Elapsed.TotalMinutes)) minutes&quot; -PercentComplete (($($tweets.Count) / $results) * 100)
		$ExecutionTime = [Diagnostics.Stopwatch]::StartNew()
		if ($MaxId -eq 0) {$CurrentTweets = Get-RawTwitterSearchAsJson -query $query -ResultsPerPage $TwitterMaxResults -Language $language -ResultType $type -StartDate $StartDate -GeoCode $GeoCode | ConvertFrom-Json}
		else {
			$CurrentTweets = Get-RawTwitterSearchAsJson -query $query -ResultsPerPage $TwitterMaxResults -Language $language -ResultType $type -StartDate $StartDate -GeoCode $GeoCode -MaxId ($MaxId - 1) | ConvertFrom-Json
			if ($CurrentTweets.statuses.count -eq 0) {break}
			}
		Write-Debug &quot;[INFO] Retrieved Tweets: $($tweets.Count)&quot;
		Write-Debug &quot;[INFO] CurrentTweets count: $($CurrentTweets.statuses.Count)&quot;
		Write-Debug &quot;[INFO] CurrentTweets metadata count: $($CurrentTweets.search_metadata.count)&quot;
		Write-Debug &quot;[INFO] MaxId: $MaxId&quot;
		$MaxId = $CurrentTweets.search_metadata.max_id
		$tweets += $CurrentTweets.statuses
		Start-Sleep -Seconds $SecondsToWait
		}
	until ($tweets.Count -gt $results)
	if ($tweets.count -gt $results) {	$tweets = $tweets[0..($results - 1)]	}
	}
return $tweets
# $DebugPreference = &quot;SilentlyContinue&quot;
}
</code></pre>

    <footer class="blog-footer">
        <p>© Joel "Jaykul" Bennett 2018.</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>