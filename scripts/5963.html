
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sign up for PowerShell.Slack.com">
    <meta name="author" content="YellowOnline">
    <title>UserManagementTool - PoshCode</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<div class="blog-post">
    <h2 class="blog-post-title">UserManagementTool</h2>
    <p class="blog-post-meta">
        <span class="blog-post-time">2015-08-04</span> by <a class="blog-post-author">YellowOnline</a>
    </p>

    <h1>UserManagementTool</h1>
<h3><a href="//scripts/5963.ps1">download</a></h3>
<pre><code class="language-posh">#Requires -version 2
&lt;#
Microsoft PowerShell Source File
NAME  : UserManagement.ps1 v3.10
AUTHOR: YellowOnline
DATE  : 19-29/05/2015; 27-31/07/2015
#&gt;

$ForestName = &quot;microsoft.com&quot;
$Credentials = Get-Credential
$Username = $Credentials.UserName
$Password = $Credentials.GetNetworkCredential().Password
$WorkingPath = $ENV:HOMESHARE

#region Assemblies
[void][Reflection.Assembly]::Load(&quot;System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)
[void][Reflection.Assembly]::Load(&quot;System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)
[void][Reflection.Assembly]::Load(&quot;System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;)
[void][Reflection.Assembly]::Load(&quot;mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)
[void][Reflection.Assembly]::Load(&quot;System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)
[void][Reflection.Assembly]::Load(&quot;System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)
[void][Reflection.Assembly]::Load(&quot;System.DirectoryServices, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;)
[void][reflection.assembly]::Load(&quot;System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)
[void][reflection.assembly]::Load(&quot;System.ServiceProcess, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;)
#endregion Assemblies

#region Functions (Yellow)
Function Convert-DNtoEMail ([string]$DN)
	{
	[string]$EMail = $DN
	Return $EMail;
	}

Function Get-DN ($FQDN)
	{
	$FQDNArray = $FQDN.Split(&quot;.&quot;)
	$Separator = &quot;,&quot;
	For ($x = 0; $x -LT $FQDNArray.Length ; $x++)
		{ 
		If ($x -EQ ($FQDNArray.Length - 1)) { $Separator = &quot;&quot; }
		[string]$DN += &quot;DC=&quot; + $FQDNArray[$x] + $Separator
		}
	Return $DN
	}

Function Get-FQDN ($x)
	{
	#OK, this is quick and dirty
	$y = $x -Split &quot;DC=&quot;
	$a = $y | Select-Object -Skip 1 | % {$_.Replace(&quot;,&quot;,&quot;.&quot;)}
	$b = $a + $y[0] -Replace &quot;CN=&quot;,&quot;/&quot; -Replace &quot;OU=&quot;,&quot;/&quot; -Replace &quot;,&quot;,&quot;&quot; #to do: escaped commas \, -&gt; regex
	$b = -join $b
	$b
	}

Function Get-UserStatus ($UAC)
	{
	Switch ($UAC) 
    	{ 
        512 {&quot;Enabled&quot;} 
        514 {&quot;Disabled&quot;} 
        66048 {&quot;Enabled&quot;} 
        66050 {&quot;Disabled&quot;} 
		Default {&quot;Unknown&quot;}
        }
	}

Function Prepare-Filter
	{
	$i = 0
	ForEach ($Row in $Table.Rows){$i++}
	$txtLog.Text = $txtLog.Text + &quot;$i row(s)`r`n&quot;
		
	$Columns = $Table | Get-Member | Where-Object {$_.MemberType -EQ 'Property'} | Select-Object Name
	ForEach ($Column in $Columns) 
		{            
	    $cbxColumn.Items.Add($Column.Name)            
	    } 

	$Operators = @(&quot;LIKE&quot;,&quot;NOT LIKE&quot;)
	ForEach ($Operator in $Operators) 
		{            
	    $cbxOperator.Items.Add($Operator)            
	    } 
	$cbxOperator.SelectedIndex = 0	
	}
#endregion Functions (Yellow)	

#region Functions (Sapien)
Function OnApplicationLoad() 
	{
	Return $True
	}

Function OnApplicationExit()
	{
	$script:ExitCode = 0
	}

Function Load-DataGridView()
	{
	&lt;#
	.SYNOPSIS
		This functions helps you load items into a DataGridView.

	.DESCRIPTION
		Use this function to dynamically load items into the DataGridView control.

	.PARAMETER  DataGridView
		The ComboBox control you want to add items to.

	.PARAMETER  Item
		The object or objects you wish to load into the ComboBox's items collection.
	
	.PARAMETER  DataMember
		Sets the name of the list or table in the data source for which the DataGridView is displaying data.

	#&gt;
	Param (
		[ValidateNotNull()]
		[Parameter(Mandatory=$true)]
		[System.Windows.Forms.DataGridView]$DataGridView,
		[ValidateNotNull()]
		[Parameter(Mandatory=$true)]
		$Item,
	    [Parameter(Mandatory=$false)]
		[string]$DataMember
	)
	$DataGridView.SuspendLayout()
	$DataGridView.DataMember = $DataMember
	
	If ($Item -is [System.ComponentModel.IListSource] -Or $Item -is [System.ComponentModel.IBindingList] -Or $Item -is [System.ComponentModel.IBindingListView])
		{
		$DataGridView.DataSource = $Item
		}
	Else
		{
		$array = New-Object System.Collections.ArrayList
		
		If ($Item -is [System.Collections.IList])
			{
			$array.AddRange($Item)
			}
		Else
			{	
			$array.Add($Item)	
			}
		$DataGridView.DataSource = $array
		}
	$DataGridView.ResumeLayout()
	}

Function ConvertTo-DataTable()
	{
	&lt;#
		.SYNOPSIS
			Converts objects into a DataTable.
	
		.DESCRIPTION
			Converts objects into a DataTable, which are used for DataBinding.
	
		.PARAMETER  InputObject
			The input to convert into a DataTable.
	
		.PARAMETER  Table
			The DataTable you wish to load the input into.
	
		.PARAMETER RetainColumns
			This switch tells the function to keep the DataTable's existing columns.
		
		.PARAMETER FilterWMIProperties
			This switch removes WMI properties that start with an underline.
	
		.EXAMPLE
			$DataTable = ConvertTo-DataTable -InputObject (Get-Process)
	#&gt;
	[OutputType([System.Data.DataTable])]
	Param([ValidateNotNull()]$InputObject,[ValidateNotNull()][System.Data.DataTable]$Table,[switch]$RetainColumns,[switch]$FilterWMIProperties)
	If($Table -EQ $null)
		{
		$Table = New-Object System.Data.DataTable
		}

	If($InputObject -is [System.Data.DataTable])
		{
		$Table = $InputObject
		}
	Else
		{
		If (-Not $RetainColumns -Or $Table.Columns.Count -EQ 0)
			{
			#Clear out the Table Contents
			$Table.Clear()

			If ($InputObject -EQ $Null)
				{
				Return 
				} 
			
			$object = $Null
			#find the first non null value
			ForEach ($item in $InputObject)
				{
				If ($item -NE $Null)
					{
					$object = $item
					Break	
					}
				}

			If ($object -EQ $null) 
				{
				Return 
				}
			
			#Get all the properties in order to create the columns
			ForEach ($prop in $object.PSObject.Get_Properties())
				{
				If (-Not $FilterWMIProperties -Or -Not $prop.Name.StartsWith('__'))#filter out WMI properties
					{
					#Get the type from the Definition string
					$type = $Null
					
					If ($prop.Value -NE $Null)
						{
						Try
							{
							$type = $prop.Value.GetType()
							} 
						Catch 
							{
							}
						}

					If ($type -NE $Null) # -and [System.Type]::GetTypeCode($type) -ne 'Object')
						{
		      			[void]$Table.Columns.Add($prop.Name, $type) 
						}
					Else #Type info not found
						{ 
						[void]$Table.Columns.Add($prop.Name) 	
						}
					}
		    	}
			
			If ($object -is [System.Data.DataRow])
				{
				ForEach($item in $InputObject)
					{	
					$Table.Rows.Add($item)
					}
				Return  @(,$Table)
				}
			}
		Else
			{
			$Table.Rows.Clear()	
			}
		
		ForEach ($item in $InputObject)
			{		
			$row = $Table.NewRow()
			
			If($item)
				{
				ForEach ($prop in $item.PSObject.Get_Properties())
					{
					If($Table.Columns.Contains($prop.Name))
						{
						$row.Item($prop.Name) = $prop.Value
						}
					}
				}
			[void]$Table.Rows.Add($row)
			}
		}
	Return @(,$Table)	
	}

Function Load-ListBox()
	{
&lt;#
	.SYNOPSIS
		This functions helps you load items into a ListBox or CheckedListBox.

	.DESCRIPTION
		Use this function to dynamically load items into the ListBox control.

	.PARAMETER  ListBox
		The ListBox control you want to add items to.

	.PARAMETER  Items
		The object or objects you wish to load into the ListBox's Items collection.

	.PARAMETER  DisplayMember
		Indicates the property to display for the items in this control.
	
	.PARAMETER  Append
		Adds the item(s) to the ListBox without clearing the Items collection.
	
	.EXAMPLE
		Load-ListBox $ListBox1 &quot;Red&quot;, &quot;White&quot;, &quot;Blue&quot;
	
	.EXAMPLE
		Load-ListBox $listBox1 &quot;Red&quot; -Append
		Load-ListBox $listBox1 &quot;White&quot; -Append
		Load-ListBox $listBox1 &quot;Blue&quot; -Append
	
	.EXAMPLE
		Load-ListBox $listBox1 (Get-Process) &quot;ProcessName&quot;
#&gt;
	Param (
		[ValidateNotNull()]
		[Parameter(Mandatory=$true)]
		[System.Windows.Forms.ListBox]$ListBox,
		[ValidateNotNull()]
		[Parameter(Mandatory=$true)]
		$Items,
	    [Parameter(Mandatory=$false)]
		[string]$DisplayMember,
		[switch]$Append
	)
	
	if(-not $Append)
		{
		$listBox.Items.Clear()	
		}
	
	if($Items -is [System.Windows.Forms.ListBox+ObjectCollection])
		{
		$listBox.Items.AddRange($Items)
		}
	elseif ($Items -is [Array])
		{
		$listBox.BeginUpdate()
		foreach($obj in $Items)
			{
			$listBox.Items.Add($obj)
			}
		$listBox.EndUpdate()
		}
	else
		{
		$listBox.Items.Add($Items)	
		}

	$listBox.DisplayMember = $DisplayMember	
	}

Function Load-ComboBox 
{
&lt;#
	.SYNOPSIS
		This functions helps you load items into a ComboBox.

	.DESCRIPTION
		Use this function to dynamically load items into the ComboBox control.

	.PARAMETER  ComboBox
		The ComboBox control you want to add items to.

	.PARAMETER  Items
		The object or objects you wish to load into the ComboBox's Items collection.

	.PARAMETER  DisplayMember
		Indicates the property to display for the items in this control.
	
	.PARAMETER  Append
		Adds the item(s) to the ComboBox without clearing the Items collection.
	
	.EXAMPLE
		Load-ComboBox $combobox1 &quot;Red&quot;, &quot;White&quot;, &quot;Blue&quot;
	
	.EXAMPLE
		Load-ComboBox $combobox1 &quot;Red&quot; -Append
		Load-ComboBox $combobox1 &quot;White&quot; -Append
		Load-ComboBox $combobox1 &quot;Blue&quot; -Append
	
	.EXAMPLE
		Load-ComboBox $combobox1 (Get-Process) &quot;ProcessName&quot;
#&gt;
	Param (
		[ValidateNotNull()]
		[Parameter(Mandatory=$true)]
		[System.Windows.Forms.ComboBox]$ComboBox,
		[ValidateNotNull()]
		[Parameter(Mandatory=$true)]
		$Items,
	    [Parameter(Mandatory=$false)]
		[string]$DisplayMember,
		[switch]$Append
	)
	
	if(-not $Append)
	{
		$ComboBox.Items.Clear()	
	}
	
	if($Items -is [Object[]])
	{
		$ComboBox.Items.AddRange($Items)
	}
	elseif ($Items -is [Array])
	{
		$ComboBox.BeginUpdate()
		foreach($obj in $Items)
		{
			$ComboBox.Items.Add($obj)	
		}
		$ComboBox.EndUpdate()
	}
	else
	{
		$ComboBox.Items.Add($Items)	
	}

	$ComboBox.DisplayMember = $DisplayMember	
}
#endregion Functions (Sapien)

#region Main functions
Function Main([String]$Commandline)
	{
	If((Call-MainForm_pff) -EQ &quot;OK&quot;){}
	$global:ExitCode = 0
	}

Function Call-MainForm_pff
	{
	[System.Windows.Forms.Application]::EnableVisualStyles()
	$frmMain = New-Object 'System.Windows.Forms.Form'
	$btnReset = New-Object 'System.Windows.Forms.Button'
	$cbxAdvanced = New-Object 'System.Windows.Forms.CheckBox'
	$txtAdvancedFilter = New-Object 'System.Windows.Forms.TextBox'
	$btnFilter = New-Object 'System.Windows.Forms.Button'
	$txtSearchText = New-Object 'System.Windows.Forms.TextBox'
	$cbxOperator = New-Object 'System.Windows.Forms.ComboBox'
	$cbxColumn = New-Object 'System.Windows.Forms.ComboBox'
	$btnClearLog = New-Object 'System.Windows.Forms.Button'
	$txtLog = New-Object 'System.Windows.Forms.TextBox'
	$btnCommitToAD = New-Object 'System.Windows.Forms.Button'
	$btnExportSelectionToCSV = New-Object 'System.Windows.Forms.Button'
	$btnDeleteSelectionFromCSV = New-Object 'System.Windows.Forms.Button'
	$boxPicture2 = New-Object 'System.Windows.Forms.PictureBox'
	$boxPicture1 = New-Object 'System.Windows.Forms.PictureBox'
	$btnGetDataFromAD = New-Object 'System.Windows.Forms.Button'
	$btnSaveCSV = New-Object 'System.Windows.Forms.Button'
	$btnOpenCSV = New-Object 'System.Windows.Forms.Button'
	$dgvResults = New-Object 'System.Windows.Forms.DataGridView'
	$btnExit = New-Object 'System.Windows.Forms.Button'
	$InitialFormWindowState = New-Object 'System.Windows.Forms.FormWindowState'
	
	$FormEvent_Load={}
	
	$btnExit_Click={$frmMain.Close()}
	
	$btnSave_Click=
		{
		$dlgSaveFile 					= New-Object System.Windows.Forms.SaveFileDialog
		$dlgSaveFile.ShowHelp 			= $True
		$dlgSaveFile.AddExtension 		= &quot;.csv&quot;
		$dlgSaveFile.InitialDirectory 	= &quot;$WorkingPath&quot;
		$dlgSaveFile.Filter 			= &quot;CSV files (*.csv)| *.csv&quot;
		$dlgSaveFile.OverwritePrompt 	= $True
		$dlgSaveFile.CreatePrompt 		= $True
		[void]$dlgSaveFile.ShowDialog()
		$dgvResults.Rows | Select-Object -Expand DataBoundItem | Export-CSV $dlgSaveFile.FileName -NoTypeInformation -Encoding UTF8 -Delimiter &quot;;&quot;
		#TODO: catch 'Cancel'
		}
	
	$btnLoad_Click={
		$dlgOpenFile 					= New-Object System.Windows.Forms.OpenFileDialog
		$dlgOpenFile.ShowHelp 			= $True
		$dlgOpenFile.InitialDirectory 	= &quot;$WorkingPath&quot;
		$dlgOpenFile.Filter 			= &quot;CSV files (*.csv)| *.csv&quot;
		[void]$dlgOpenFile.ShowDialog()
		$Data = Import-Csv $dlgOpenFile.FileName -Delimiter &quot;;&quot;
		$Table = ConvertTo-DataTable -InputObject $Data -FilterWMIProperties
		Load-DataGridView -DataGridView $dgvResults -Item $Table
		}
	
	$btnGetDataFromAD_Click={If((Call-ChildForm_pff) -EQ 'OK'){}}
	
	$dgvResults_ColumnHeaderMouseClick=[System.Windows.Forms.DataGridViewCellMouseEventHandler]{
		If($dgvResults.DataSource -is [System.Data.DataTable])
			{
			$Column = $dgvResults.Columns[$_.ColumnIndex]
			$Direction = [System.ComponentModel.ListSortDirection]::Ascending
			
			If ($Column.HeaderCell.SortGlyphDirection -EQ 'Descending')
				{
				$Direction = [System.ComponentModel.ListSortDirection]::Descending
				}
			$dgvResults.Sort($dgvResults.Columns[$_.ColumnIndex], $Direction)
			}
		}
	
	$btnExportSelectionToCSV_Click=
		{
		$dlgExportSelection 					= New-Object System.Windows.Forms.SaveFileDialog
		$dlgExportSelection.ShowHelp 			= $True
		$dlgExportSelection.AddExtension 		= &quot;.csv&quot;
		$dlgExportSelection.InitialDirectory 	= &quot;$WorkingPath&quot;
		$dlgExportSelection.Filter 				= &quot;CSV files (*.csv)| *.csv&quot;
		$dlgExportSelection.OverwritePrompt 	= $True
		$dlgExportSelection.CreatePrompt 		= $True
		[void]$dlgExportSelection.ShowDialog()
		$dgvResults.SelectedRows | Select-Object -Expand DataBoundItem | Export-CSV $dlgExportSelection.FileName -NoTypeInformation -Encoding UTF8 -Delimiter &quot;;&quot;
		#TODO: catch 'Cancel'
		}
	
	$btnDeleteSelectionFromCSV_Click=
		{
		ForEach ($SelectedRow in $dgvResults.SelectedRows)
			{
			$dgvResults.Rows.Remove($SelectedRow)
			}
		}
	
	$btnCommitSelectionToAD_Click={If((Call-ChildForm2_pff) -EQ 'OK'){}}
	
	$btnClearLog_Click={$txtLog.Text = &quot;&quot;}
	
	$btnFilter_Click=
		{
		If (!$AdvancedFilter){$Query = &quot;$($cbxColumn.Text) $($cbxOperator.Text) `'*$($txtSearchText.Text)*`'&quot;}
		Else {$Query = $txtAdvancedFilter.Text}
		Try {$Table.DefaultView.RowFilter = $Query}
		Catch {$txtLog.Text = $txtLog.Text + &quot;$($error[0])`r`n&quot;}
		Load-DataGridView -DataGridView $dgvResults -Item $Table.DefaultView
		$i = 0
		ForEach ($Row in $Table.DefaultView){$i++}
		$txtLog.Text = $txtLog.Text + &quot;$i row(s)`r`n&quot;
		}
	
	$btnReset_Click=
		{
		$Query = &quot;$('Company') $('LIKE') '**'&quot;
		$txtAdvancedFilter.Text = $Query
		Try {$Table.DefaultView.RowFilter = $Query}
		Catch {$txtLog.Text = $txtLog.Text + &quot;$($error[0])`r`n&quot;}
		Load-DataGridView -DataGridView $dgvResults -Item $Table.DefaultView
		$i = 0
		ForEach ($Row in $Table.DefaultView){$i++}
		$txtLog.Text = $txtLog.Text + &quot;$i row(s)`r`n&quot;
		}
	
	$cbxAdvanced_CheckedChanged=
		{
		If ($cbxAdvanced.Checked -EQ $True)
			{
			$txtAdvancedFilter.Visible = $True
			$cbxColumn.Enabled = $False
			$cbxOperator.Enabled = $False
			$txtSearchText.Enabled = $False
			$AdvancedFilter = $True
			}
		If ($cbxAdvanced.Checked -EQ $False)
			{
			$txtAdvancedFilter.Visible = $False
			$cbxColumn.Enabled = $True
			$cbxOperator.Enabled = $True
			$txtSearchText.Enabled = $True
			$AdvancedFilter = $False
			}
		}
	
	$Form_StateCorrection_Load={$frmMain.WindowState = $InitialFormWindowState}
	
	$Form_StoreValues_Closing=
		{
		$script:MainForm_cbxAdvanced = $cbxAdvanced.Checked
		$script:MainForm_txtAdvancedFilter = $txtAdvancedFilter.Text
		$script:MainForm_txtSearchText = $txtSearchText.Text
		$script:MainForm_cbxOperator = $cbxOperator.Text
		$script:MainForm_cbxColumn = $cbxColumn.Text
		$script:MainForm_txtLog = $txtLog.Text
		}

	
	$Form_Cleanup_FormClosed=
		{
		Try
			{
			$btnReset.remove_Click($btnReset_Click)
			$cbxAdvanced.remove_CheckedChanged($cbxAdvanced_CheckedChanged)
			$txtAdvancedFilter.remove_KeyDown($btnFilter_Click)
			$btnFilter.remove_Click($btnFilter_Click)
			$txtSearchText.remove_KeyDown($btnFilter_Click)
			$btnClearLog.remove_Click($btnClearLog_Click)
			$btnCommitToAD.remove_Click($btnCommitSelectionToAD_Click)
			$btnExportSelectionToCSV.remove_Click($btnExportSelectionToCSV_Click)
			$btnDeleteSelectionFromCSV.remove_Click($btnDeleteSelectionFromCSV_Click)
			$btnGetDataFromAD.remove_Click($btnGetDataFromAD_Click)
			$btnSaveCSV.remove_Click($btnSave_Click)
			$btnOpenCSV.remove_Click($btnLoad_Click)
			$dgvResults.remove_ColumnHeaderMouseClick($dgvResults_ColumnHeaderMouseClick)
			$btnExit.remove_Click($btnExit_Click)
			$frmMain.remove_Load($FormEvent_Load)
			$frmMain.remove_Load($Form_StateCorrection_Load)
			$frmMain.remove_Closing($Form_StoreValues_Closing)
			$frmMain.remove_FormClosed($Form_Cleanup_FormClosed)
			}
		Catch [Exception]{ }
		}

	$frmMain.Controls.Add($btnReset)
	$frmMain.Controls.Add($cbxAdvanced)
	$frmMain.Controls.Add($txtAdvancedFilter)
	$frmMain.Controls.Add($btnFilter)
	$frmMain.Controls.Add($txtSearchText)
	$frmMain.Controls.Add($cbxOperator)
	$frmMain.Controls.Add($cbxColumn)
	$frmMain.Controls.Add($btnClearLog)
	$frmMain.Controls.Add($txtLog)
	$frmMain.Controls.Add($btnCommitToAD)
	$frmMain.Controls.Add($btnExportSelectionToCSV)
	$frmMain.Controls.Add($btnDeleteSelectionFromCSV)
	$frmMain.Controls.Add($boxPicture2)
	$frmMain.Controls.Add($boxPicture1)
	$frmMain.Controls.Add($btnGetDataFromAD)
	$frmMain.Controls.Add($btnSaveCSV)
	$frmMain.Controls.Add($btnOpenCSV)
	$frmMain.Controls.Add($dgvResults)
	$frmMain.Controls.Add($btnExit)
	$frmMain.ClientSize = '1024, 814'
	$frmMain.MinimumSize = '1024, 814'
	$frmMain.Name = &quot;frmMain&quot;
	$frmMain.StartPosition = 'CenterScreen'
	$frmMain.Text = &quot;User Management v3.10&quot;
	$frmMain.add_Load($FormEvent_Load)

	$btnReset.Anchor = 'Bottom, Right'
	$btnReset.FlatStyle = 'Flat'
	$btnReset.ForeColor = 'ControlDarkDark'
	$btnReset.Location = '937, 710'
	$btnReset.Name = &quot;btnReset&quot;
	$btnReset.Size = '75, 23'
	$btnReset.TabIndex = 17
	$btnReset.Text = &quot;Reset&quot;
	$btnReset.UseVisualStyleBackColor = $True
	$btnReset.add_Click($btnReset_Click)

	
	$cbxAdvanced.Anchor = 'Bottom, Right'
	$cbxAdvanced.Location = '937, 738'
	$cbxAdvanced.Name = &quot;cbxAdvanced&quot;
	$cbxAdvanced.Size = '77, 24'
	$cbxAdvanced.TabIndex = 16
	$cbxAdvanced.Text = &quot;Advanced&quot;
	$cbxAdvanced.UseVisualStyleBackColor = $True
	$cbxAdvanced.add_CheckedChanged($cbxAdvanced_CheckedChanged)

	$txtAdvancedFilter.Anchor = 'Bottom, Right'
	$txtAdvancedFilter.Location = '574, 712'
	$txtAdvancedFilter.Name = &quot;txtAdvancedFilter&quot;
	$txtAdvancedFilter.Size = '356, 20'
	$txtAdvancedFilter.TabIndex = 14
	$txtAdvancedFilter.Visible = $False
	$txtAdvancedFilter.add_KeyDown($btnFilter_Click)
	
	$btnFilter.Anchor = 'Bottom, Right'
	$btnFilter.FlatStyle = 'Flat'
	$btnFilter.ForeColor = 'ControlDarkDark'
	$btnFilter.Location = '937, 686'
	$btnFilter.Name = &quot;btnFilter&quot;
	$btnFilter.Size = '75, 23'
	$btnFilter.TabIndex = 13
	$btnFilter.Text = &quot;Filter&quot;
	$btnFilter.UseVisualStyleBackColor = $True
	$btnFilter.add_Click($btnFilter_Click)

	$txtSearchText.Anchor = 'Bottom, Right'
	$txtSearchText.Location = '830, 686'
	$txtSearchText.Name = &quot;txtSearchText&quot;
	$txtSearchText.Size = '100, 20'
	$txtSearchText.TabIndex = 12
	$txtSearchText.add_KeyDown($btnFilter_Click)

	$cbxOperator.Anchor = 'Bottom, Right'
	$cbxOperator.FormattingEnabled = $True
	$cbxOperator.Location = '702, 686'
	$cbxOperator.Name = &quot;cbxOperator&quot;
	$cbxOperator.Size = '121, 21'
	$cbxOperator.TabIndex = 11

	$cbxColumn.Anchor = 'Bottom, Right'
	$cbxColumn.FormattingEnabled = $True
	$cbxColumn.Location = '574, 686'
	$cbxColumn.Name = &quot;cbxColumn&quot;
	$cbxColumn.Size = '121, 21'
	$cbxColumn.TabIndex = 10

	$btnClearLog.Anchor = 'Bottom, Right'
	$btnClearLog.BackColor = 'ControlLight'
	$btnClearLog.FlatStyle = 'Popup'
	$btnClearLog.Location = '469, 686'
	$btnClearLog.Name = &quot;btnClearLog&quot;
	$btnClearLog.Size = '75, 23'
	$btnClearLog.TabIndex = 9
	$btnClearLog.Text = &quot;Clear Log&quot;
	$btnClearLog.UseVisualStyleBackColor = $False
	$btnClearLog.add_Click($btnClearLog_Click)

	$txtLog.Anchor = 'Bottom, Left, Right'
	$txtLog.Location = '12, 686'
	$txtLog.Multiline = $True
	$txtLog.Name = &quot;txtLog&quot;
	$txtLog.ReadOnly = $True
	$txtLog.ScrollBars = 'Vertical'
	$txtLog.Size = '451, 76'
	$txtLog.TabIndex = 8

	$btnCommitToAD.Anchor = 'Bottom, Left'
	$btnCommitToAD.FlatStyle = 'Flat'
	$btnCommitToAD.Location = '747, 779'
	$btnCommitToAD.Name = &quot;btnCommitToAD&quot;
	$btnCommitToAD.Size = '141, 23'
	$btnCommitToAD.TabIndex = 6
	$btnCommitToAD.Text = &quot;&amp;Commit selection to AD&quot;
	$btnCommitToAD.UseVisualStyleBackColor = $True
	$btnCommitToAD.add_Click($btnCommitSelectionToAD_Click)

	$btnExportSelectionToCSV.Anchor = 'Bottom, Left'
	$btnExportSelectionToCSV.FlatStyle = 'Flat'
	$btnExportSelectionToCSV.Location = '600, 779'
	$btnExportSelectionToCSV.Name = &quot;btnExportSelectionToCSV&quot;
	$btnExportSelectionToCSV.Size = '141, 23'
	$btnExportSelectionToCSV.TabIndex = 5
	$btnExportSelectionToCSV.Text = &quot;&amp;Export selection to CSV&quot;
	$btnExportSelectionToCSV.UseVisualStyleBackColor = $True
	$btnExportSelectionToCSV.add_Click($btnExportSelectionToCSV_Click)

	$btnDeleteSelectionFromCSV.Anchor = 'Bottom, Left'
	$btnDeleteSelectionFromCSV.FlatStyle = 'Flat'
	$btnDeleteSelectionFromCSV.Location = '453, 779'
	$btnDeleteSelectionFromCSV.Name = &quot;btnDeleteSelectionFromCSV&quot;
	$btnDeleteSelectionFromCSV.Size = '141, 23'
	$btnDeleteSelectionFromCSV.TabIndex = 4
	$btnDeleteSelectionFromCSV.Text = &quot;&amp;Delete selection f CSV&quot;
	$btnDeleteSelectionFromCSV.UseVisualStyleBackColor = $True
	$btnDeleteSelectionFromCSV.add_Click($btnDeleteSelectionFromCSV_Click)

	$boxPicture2.Image = ''
	$boxPicture2.Location = '12, 13'
	$boxPicture2.Name = &quot;boxPicture2&quot;
	$boxPicture2.Size = '230, 69'
	$boxPicture2.TabIndex = 7
	$boxPicture2.TabStop = $False

	$boxPicture1.Anchor = 'Top, Right'
	$boxPicture1.Image = ''
	$boxPicture1.Location = '778, 13'
	$boxPicture1.Name = &quot;boxPicture1&quot;
	$boxPicture1.Size = '234, 69'
	$boxPicture1.TabIndex = 6
	$boxPicture1.TabStop = $False

	$btnGetDataFromAD.Anchor = 'Bottom, Left'
	$btnGetDataFromAD.FlatStyle = 'Flat'
	$btnGetDataFromAD.Location = '306, 779'
	$btnGetDataFromAD.Name = &quot;btnGetDataFromAD&quot;
	$btnGetDataFromAD.Size = '141, 23'
	$btnGetDataFromAD.TabIndex = 3
	$btnGetDataFromAD.Text = &quot;&amp;Get Data from AD&quot;
	$btnGetDataFromAD.UseVisualStyleBackColor = $True
	$btnGetDataFromAD.add_Click($btnGetDataFromAD_Click)

	$btnSaveCSV.Anchor = 'Bottom, Left'
	$btnSaveCSV.FlatStyle = 'Flat'
	$btnSaveCSV.Location = '12, 779'
	$btnSaveCSV.Name = &quot;btnSaveCSV&quot;
	$btnSaveCSV.Size = '141, 23'
	$btnSaveCSV.TabIndex = 1
	$btnSaveCSV.Text = &quot;&amp;Save CSV&quot;
	$btnSaveCSV.UseVisualStyleBackColor = $True
	$btnSaveCSV.add_Click($btnSave_Click)

	$btnOpenCSV.Anchor = 'Bottom, Left'
	$btnOpenCSV.FlatStyle = 'Flat'
	$btnOpenCSV.Location = '159, 779'
	$btnOpenCSV.Name = &quot;btnOpenCSV&quot;
	$btnOpenCSV.Size = '141, 23'
	$btnOpenCSV.TabIndex = 2
	$btnOpenCSV.Text = &quot;&amp;Open CSV&quot;
	$btnOpenCSV.UseVisualStyleBackColor = $True
	$btnOpenCSV.add_Click($btnLoad_Click)

	$dgvResults.AllowUserToAddRows = $False
	$dgvResults.AllowUserToDeleteRows = $False
	$dgvResults.AllowUserToOrderColumns = $True
	$dgvResults.AllowUserToResizeRows = $False
	$System_Windows_Forms_DataGridViewCellStyle_1 = New-Object 'System.Windows.Forms.DataGridViewCellStyle'
	$System_Windows_Forms_DataGridViewCellStyle_1.BackColor = '255, 255, 192'
	$dgvResults.AlternatingRowsDefaultCellStyle = $System_Windows_Forms_DataGridViewCellStyle_1
	$dgvResults.Anchor = 'Top, Bottom, Left, Right'
	$dgvResults.Location = '12, 88'
	$dgvResults.Name = &quot;dgvResults&quot;
	$dgvResults.ShowEditingIcon = $False
	$dgvResults.Size = '1000, 591'
	$dgvResults.TabIndex = 7
	$dgvResults.add_ColumnHeaderMouseClick($dgvResults_ColumnHeaderMouseClick)

	$btnExit.Anchor = 'Bottom, Right'
	$btnExit.FlatStyle = 'Flat'
	$btnExit.Location = '937, 779'
	$btnExit.Name = &quot;btnExit&quot;
	$btnExit.Size = '75, 23'
	$btnExit.TabIndex = 1
	$btnExit.Text = &quot;E&amp;xit&quot;
	$btnExit.UseVisualStyleBackColor = $True
	$btnExit.add_Click($btnExit_Click)

	$InitialFormWindowState = $frmMain.WindowState
	$frmMain.add_Load($Form_StateCorrection_Load)
	$frmMain.add_FormClosed($Form_Cleanup_FormClosed)
	$frmMain.add_Closing($Form_StoreValues_Closing)
	Return $frmMain.ShowDialog()

	}

Function Call-ChildForm_pff
	{
	[System.Windows.Forms.Application]::EnableVisualStyles()
	$frmSelectDomain = New-Object 'System.Windows.Forms.Form'
	$btnCancel = New-Object 'System.Windows.Forms.Button'
	$btnOK = New-Object 'System.Windows.Forms.Button'
	$boxCheckedList = New-Object 'System.Windows.Forms.CheckedListBox'
	$InitialFormWindowState = New-Object 'System.Windows.Forms.FormWindowState'

	$frmSelectDomain_Load=
		{
		$adCtx = New-Object System.DirectoryServices.ActiveDirectory.DirectoryContext(&quot;forest&quot;, $ForestName, $Username, $Password)
		$Forest = ([System.DirectoryServices.ActiveDirectory.Forest]::GetForest($adCtx))  
		$Domains = $Forest.Domains | Select-Object Name
		ForEach ($Domain in $Domains) 
			{
			Load-Listbox $boxCheckedList $Domain.Name -Append
			}
		}
	
	$btnCancel_Click={$frmSelectDomain.Close()}
	
	$btnOK_Click={
		$MeasureDataFetch = Measure-Command	{
		$SelectedDomains = @()
		$ForestUsers = @()
		ForEach ($objCheckedList in $boxCheckedList.CheckedItems)
			{
			$SelectedDomains += $objCheckedList	
			}
		ForEach ($SelectedDomain in $SelectedDomains) 
			{
			$objDomain = New-Object System.DirectoryServices.DirectoryEntry &quot;LDAP://$SelectedDomain&quot;, $Username, $Password
			$objSearcher = New-Object System.DirectoryServices.DirectorySearcher
			$objSearcher.SearchRoot = $objDomain
			$objSearcher.PageSize = 5000
			$objSearcher.Filter = &quot;(&amp;(objectCategory=person)(objectClass=user))&quot;
			$objSearcher.SearchScope = &quot;Subtree&quot;
			$RawUsers = $objSearcher.FindAll()
			$Users = $RawUsers | Select-Object `
			@{e={(Get-FQDN $_.properties.distinguishedname).Split(&quot;/&quot;)[0]};n='Domain'},`
			@{e={Get-FQDN $_.properties.distinguishedname};n='Distinguished Name'},`
			@{e={$_.properties.samaccountname};n='UserName'},`
			@{e={[datetime]::FromFileTimeUtc([int64]$_.properties.lastlogontimestamp[0])};n='LastLogon'},`
			@{e={Get-UserStatus $_.properties.useraccountcontrol};n='Status'},`
			@{e={$_.properties.givenname};n='GivenName'},`
			@{e={$_.properties.sn};n='Surname'},`
			@{e={$_.properties.displayname};n='DisplayName'},`
			@{e={$_.properties.mail};n='Mail'},`
			@{e={$_.properties.altrecipient};n='Forwarding'},`
			@{e={$_.properties.description};n='Description'},`
			@{e={$_.properties.title};n='Title'},`
			@{e={$_.properties.streetaddress};n='StreetAddress'},`
			@{e={$_.properties.postalcode};n='PostalCode'},`
			@{e={$_.properties.l};n='City'},`
			@{e={$_.properties.c};n='Country'},`
			@{e={$_.properties.company};n='Company'},`
			@{e={$_.properties.wwwhomepage};n='HomePage'},`
			@{e={$_.properties.telephonenumber};n='OfficePhone'},`
			@{e={$_.properties.homephone};n='HomePhone'},`
			@{e={$_.properties.mobile};n='MobilePhone'},`
			@{e={$_.properties.facsimiletelephonenumber};n='Fax'}
			$ForestUsers = $ForestUsers + $Users
			}
		}
		$TempDataFromAD = $($WorkingPath + &quot;\&quot; + &quot;Temp.csv&quot;)
		$ForestUsers | Export-CSV $TempDataFromAD -Delimiter &quot;;&quot; -Encoding UTF8 -NoTypeInformation		
		$Data = Import-Csv $TempDataFromAD -Delimiter &quot;;&quot;
		$script:Table = ConvertTo-DataTable -InputObject $Data -FilterWMIProperties
		Load-DataGridView -DataGridView $dgvResults -Item $Table
		$txtLog.Text = $txtLog.Text + &quot;Query took &quot; + $MeasureDataFetch.TotalSeconds + &quot; seconds`r`n&quot;
		Remove-Item $TempDataFromAD -Force
		Prepare-Filter
		$frmSelectDomain.Close()
		}
		
	$Form_StateCorrection_Load=
		{
		$frmSelectDomain.WindowState = $InitialFormWindowState
		}
	
	$Form_StoreValues_Closing=
		{
		$script:ChildForm_boxCheckedList = $boxCheckedList.SelectedItems
		}

	
	$Form_Cleanup_FormClosed=
		{
		Try
		{
			$btnCancel.remove_Click($btnCancel_Click)
			$btnOK.remove_Click($btnOK_Click)
			$frmSelectDomain.remove_Load($frmSelectDomain_Load)
			$frmSelectDomain.remove_Load($Form_StateCorrection_Load)
			$frmSelectDomain.remove_Closing($Form_StoreValues_Closing)
			$frmSelectDomain.remove_FormClosed($Form_Cleanup_FormClosed)
		}
		Catch [Exception]{ }
	}

	$frmSelectDomain.Controls.Add($btnCancel)
	$frmSelectDomain.Controls.Add($btnOK)
	$frmSelectDomain.Controls.Add($boxCheckedList)
	$frmSelectDomain.ClientSize = '284, 335'
	$frmSelectDomain.Name = &quot;frmSelectDomain&quot;
	$frmSelectDomain.ShowIcon = $False
	$frmSelectDomain.StartPosition = 'CenterParent'
	$frmSelectDomain.Text = &quot;Select Domain&quot;
	$frmSelectDomain.add_Load($frmSelectDomain_Load)

	$btnCancel.FlatStyle = 'Flat'
	$btnCancel.Location = '95, 294'
	$btnCancel.Name = &quot;btnCancel&quot;
	$btnCancel.Size = '75, 23'
	$btnCancel.TabIndex = 2
	$btnCancel.Text = &quot;Cancel&quot;
	$btnCancel.UseVisualStyleBackColor = $True
	$btnCancel.add_Click($btnCancel_Click)

	$btnOK.FlatStyle = 'Flat'
	$btnOK.Location = '13, 294'
	$btnOK.Name = &quot;btnOK&quot;
	$btnOK.Size = '75, 23'
	$btnOK.TabIndex = 1
	$btnOK.Text = &quot;OK&quot;
	$btnOK.UseVisualStyleBackColor = $True
	$btnOK.add_Click($btnOK_Click)

	$boxCheckedList.FormattingEnabled = $True
	$boxCheckedList.Location = '13, 13'
	$boxCheckedList.Name = &quot;boxCheckedList&quot;
	$boxCheckedList.Size = '259, 274'
	$boxCheckedList.TabIndex = 0

	$InitialFormWindowState = $frmSelectDomain.WindowState
	$frmSelectDomain.add_Load($Form_StateCorrection_Load)
	$frmSelectDomain.add_FormClosed($Form_Cleanup_FormClosed)
	$frmSelectDomain.add_Closing($Form_StoreValues_Closing)
	Return $frmSelectDomain.ShowDialog()
	}

Function Call-ChildForm2_pff
	{
	[System.Windows.Forms.Application]::EnableVisualStyles()
	$frmCommitAD = New-Object 'System.Windows.Forms.Form'
	$checkboxMobilePhone = New-Object 'System.Windows.Forms.CheckBox'
	$cbxDescription = New-Object 'System.Windows.Forms.CheckBox'
	$cbxLastLogon = New-Object 'System.Windows.Forms.CheckBox'
	$btnADCancel = New-Object 'System.Windows.Forms.Button'
	$btnADOK = New-Object 'System.Windows.Forms.Button'
	$cbxFax = New-Object 'System.Windows.Forms.CheckBox'
	$cbxMobilePhone = New-Object 'System.Windows.Forms.CheckBox'
	$cbxOfficePhone = New-Object 'System.Windows.Forms.CheckBox'
	$lblCommitToAD = New-Object 'System.Windows.Forms.Label'
	$cbxUserName = New-Object 'System.Windows.Forms.CheckBox'
	$cbxSID = New-Object 'System.Windows.Forms.CheckBox'
	$cbxCanonicalName = New-Object 'System.Windows.Forms.CheckBox'
	$cbxHomePage = New-Object 'System.Windows.Forms.CheckBox'
	$cbxCompany = New-Object 'System.Windows.Forms.CheckBox'
	$cbxCountry = New-Object 'System.Windows.Forms.CheckBox'
	$cbxCity = New-Object 'System.Windows.Forms.CheckBox'
	$cbxPostalCode = New-Object 'System.Windows.Forms.CheckBox'
	$cbxStreetAddress = New-Object 'System.Windows.Forms.CheckBox'
	$cbxTitle = New-Object 'System.Windows.Forms.CheckBox'
	$cbxMail = New-Object 'System.Windows.Forms.CheckBox'
	$cbxDisplayName = New-Object 'System.Windows.Forms.CheckBox'
	$cbxSurName = New-Object 'System.Windows.Forms.CheckBox'
	$cbxGivenName = New-Object 'System.Windows.Forms.CheckBox'
	$InitialFormWindowState = New-Object 'System.Windows.Forms.FormWindowState'

	Function OnApplicationLoad() 
		{
		Return $True
		}	
	
	Function OnApplicationExit() 
		{
		$script:ExitCode = 0
		}
	
	$btnADCancel_Click={$frmCommitAD.Close()}
	
	$btnADOK_Click={
		#To be replaced by something that doesn't use the ActiveDirectory module, because it uses ADWS and is very, very slow
		Import-Module ActiveDirectory
		ForEach ($SelectedRow in $dgvResults.SelectedRows)
				{
				$ADCmdlet = &quot;Set-ADUser&quot;
				$ADIdentity =&quot;-Identity $($SelectedRow.Cells[&quot;UserName&quot;].Value)&quot;
				$ADServer = &quot;-Server $($SelectedRow.Cells[&quot;Domain&quot;].Value)&quot;
				$ADWhatIf = &quot;-WhatIf&quot;
				$ADCommandString = $ADCmdlet + &quot; &quot; + $ADIdentity + &quot; &quot; + $ADServer + &quot; &quot; + &quot;-Credential (New-Object System.Management.Automation.PSCredential $Username,(ConvertTo-SecureString $Password -AsPlainText -Force))&quot;
				If ($cbxGivenName.Checked -And ($($SelectedRow.Cells[&quot;GivenName&quot;].Value) -NE &quot;&quot;))			{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-GivenName '$($SelectedRow.Cells[&quot;GivenName&quot;].Value)'&quot;}
				If ($cbxSurName.Checked -And ($($SelectedRow.Cells[&quot;Surname&quot;].Value) -NE &quot;&quot;))				{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Surname `&quot;$($SelectedRow.Cells[&quot;Surname&quot;].Value)`&quot;&quot;}
				If ($cbxDisplayName.Checked -And ($($SelectedRow.Cells[&quot;DisplayName&quot;].Value) -NE &quot;&quot;))		{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-DisplayName '$($SelectedRow.Cells[&quot;DisplayName&quot;].Value)'&quot;}
				If ($cbxMail.Checked -And ($($SelectedRow.Cells[&quot;Mail&quot;].Value) -NE &quot;&quot;))						{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Emailaddress '$($SelectedRow.Cells[&quot;Mail&quot;].Value)'&quot;}
				If ($cbxDescription.Checked -And ($($SelectedRow.Cells[&quot;Description&quot;].Value) -NE &quot;&quot;))		{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Description '$($SelectedRow.Cells[&quot;Description&quot;].Value)'&quot;}
				If ($cbxTitle.Checked -And ($($SelectedRow.Cells[&quot;Title&quot;].Value) -NE &quot;&quot;))					{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Title '$($SelectedRow.Cells[&quot;Title&quot;].Value)'&quot;}
				If ($cbxStreetAddress.Checked -And ($($SelectedRow.Cells[&quot;StreetAddress&quot;].Value) -NE &quot;&quot;))	{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-StreetAddress '$($SelectedRow.Cells[&quot;StreetAddress&quot;].Value)'&quot;}
				If ($cbxPostalCode.Checked -And ($($SelectedRow.Cells[&quot;PostalCode&quot;].Value) -NE &quot;&quot;))			{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-PostalCode '$($SelectedRow.Cells[&quot;PostalCode&quot;].Value)'&quot;}
				If ($cbxCity.Checked -And ($($SelectedRow.Cells[&quot;City&quot;].Value) -NE &quot;&quot;))						{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-City '$($SelectedRow.Cells[&quot;City&quot;].Value)'&quot;}
				If ($cbxCountry.Checked -And ($($SelectedRow.Cells[&quot;Country&quot;].Value) -NE &quot;&quot;))				{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Country '$($SelectedRow.Cells[&quot;Country&quot;].Value)'&quot;}
				If ($cbxCompany.Checked -And ($($SelectedRow.Cells[&quot;Company&quot;].Value) -NE &quot;&quot;))				{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Company '$($SelectedRow.Cells[&quot;Company&quot;].Value)'&quot;}
				If ($cbxHomePage.Checked -And ($($SelectedRow.Cells[&quot;HomePage&quot;].Value) -NE &quot;&quot;))				{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Homepage '$($SelectedRow.Cells[&quot;Homepage&quot;].Value)'&quot;}
				If ($cbxOfficePhone.Checked -And ($($SelectedRow.Cells[&quot;OfficePhone&quot;].Value) -NE &quot;&quot;))		{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-OfficePhone '$($SelectedRow.Cells[&quot;OfficePhone&quot;].Value)'&quot;}
				If ($cbxHomePhone.Checked -And ($($SelectedRow.Cells[&quot;HomePhone&quot;].Value) -NE &quot;&quot;))			{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-HomePhone '$($SelectedRow.Cells[&quot;HomePhone&quot;].Value)'&quot;}	
				If ($cbxMobilePhone.Checked -And ($($SelectedRow.Cells[&quot;MobilePhone&quot;].Value) -NE &quot;&quot;))		{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-MobilePhone '$($SelectedRow.Cells[&quot;MobilePhone&quot;].Value)'&quot;}
				If ($cbxFax.Checked -And ($($SelectedRow.Cells[&quot;Fax&quot;].Value) -NE &quot;&quot;))						{$ADCommandString = $ADCommandString + &quot; &quot; + &quot;-Fax '$($SelectedRow.Cells[&quot;Fax&quot;].Value)'&quot; }
				Try
					{
					Invoke-Expression $ADCommandString -ErrorAction 'Stop'
					}
				Catch
					{	
					$txtLog.Text = $txtLog.Text + &quot;$($Error[0])`r`n&quot;
					}
				}
		[System.Windows.Forms.MessageBox]::Show(&quot;Finished&quot; , &quot;Info&quot; , 0)
		$frmCommitAD.Close()
	}

	$Form_StateCorrection_Load=
		{
		$frmCommitAD.WindowState = $InitialFormWindowState
		}
	
	$Form_StoreValues_Closing=
		{
		$script:ChildForm2_checkboxMobilePhone = $checkboxMobilePhone.Checked
		$script:ChildForm2_cbxDescription = $cbxDescription.Checked
		$script:ChildForm2_cbxLastLogon = $cbxLastLogon.Checked
		$script:ChildForm2_cbxFax = $cbxFax.Checked
		$script:ChildForm2_cbxMobilePhone = $cbxMobilePhone.Checked
		$script:ChildForm2_cbxOfficePhone = $cbxOfficePhone.Checked
		$script:ChildForm2_cbxUserName = $cbxUserName.Checked
		$script:ChildForm2_cbxSID = $cbxSID.Checked
		$script:ChildForm2_cbxCanonicalName = $cbxCanonicalName.Checked
		$script:ChildForm2_cbxHomePage = $cbxHomePage.Checked
		$script:ChildForm2_cbxCompany = $cbxCompany.Checked
		$script:ChildForm2_cbxCountry = $cbxCountry.Checked
		$script:ChildForm2_cbxCity = $cbxCity.Checked
		$script:ChildForm2_cbxPostalCode = $cbxPostalCode.Checked
		$script:ChildForm2_cbxStreetAddress = $cbxStreetAddress.Checked
		$script:ChildForm2_cbxTitle = $cbxTitle.Checked
		$script:ChildForm2_cbxMail = $cbxMail.Checked
		$script:ChildForm2_cbxDisplayName = $cbxDisplayName.Checked
		$script:ChildForm2_cbxSurName = $cbxSurName.Checked
		$script:ChildForm2_cbxGivenName = $cbxGivenName.Checked
		}

	
	$Form_Cleanup_FormClosed=
		{
		Try
			{
			$btnADCancel.remove_Click($btnADCancel_Click)
			$btnADOK.remove_Click($btnADOK_Click)
			$frmCommitAD.remove_Load($Form_StateCorrection_Load)
			$frmCommitAD.remove_Closing($Form_StoreValues_Closing)
			$frmCommitAD.remove_FormClosed($Form_Cleanup_FormClosed)
			}
		Catch [Exception]{ }
	}

	$frmCommitAD.Controls.Add($checkboxMobilePhone)
	$frmCommitAD.Controls.Add($cbxDescription)
	$frmCommitAD.Controls.Add($cbxLastLogon)
	$frmCommitAD.Controls.Add($btnADCancel)
	$frmCommitAD.Controls.Add($btnADOK)
	$frmCommitAD.Controls.Add($cbxFax)
	$frmCommitAD.Controls.Add($cbxMobilePhone)
	$frmCommitAD.Controls.Add($cbxOfficePhone)
	$frmCommitAD.Controls.Add($lblCommitToAD)
	$frmCommitAD.Controls.Add($cbxUserName)
	$frmCommitAD.Controls.Add($cbxSID)
	$frmCommitAD.Controls.Add($cbxCanonicalName)
	$frmCommitAD.Controls.Add($cbxHomePage)
	$frmCommitAD.Controls.Add($cbxCompany)
	$frmCommitAD.Controls.Add($cbxCountry)
	$frmCommitAD.Controls.Add($cbxCity)
	$frmCommitAD.Controls.Add($cbxPostalCode)
	$frmCommitAD.Controls.Add($cbxStreetAddress)
	$frmCommitAD.Controls.Add($cbxTitle)
	$frmCommitAD.Controls.Add($cbxMail)
	$frmCommitAD.Controls.Add($cbxDisplayName)
	$frmCommitAD.Controls.Add($cbxSurName)
	$frmCommitAD.Controls.Add($cbxGivenName)
	$frmCommitAD.ClientSize = '535, 289'
	$frmCommitAD.Name = &quot;frmCommitAD&quot;
	$frmCommitAD.ShowIcon = $False
	$frmCommitAD.StartPosition = 'CenterParent'
	$frmCommitAD.Tag = &quot;-OfficePhone $($dgvResults.CurrentRow.Cells['OfficePhone'].Value)&quot;
	$frmCommitAD.Text = &quot;Commit to AD&quot;

	$checkboxMobilePhone.Checked = $True
	$checkboxMobilePhone.CheckState = 'Checked'
	$checkboxMobilePhone.Location = '153, 176'
	$checkboxMobilePhone.Name = &quot;checkboxMobilePhone&quot;
	$checkboxMobilePhone.Size = '104, 24'
	$checkboxMobilePhone.TabIndex = 22
	$checkboxMobilePhone.Text = &quot;Mobile Phone&quot;
	$checkboxMobilePhone.UseVisualStyleBackColor = $True

	$cbxDescription.Checked = $True
	$cbxDescription.CheckState = 'Checked'
	$cbxDescription.Location = '12, 116'
	$cbxDescription.Name = &quot;cbxDescription&quot;
	$cbxDescription.Size = '104, 24'
	$cbxDescription.TabIndex = 21
	$cbxDescription.Text = &quot;Description&quot;
	$cbxDescription.UseVisualStyleBackColor = $True

	$cbxLastLogon.Enabled = $False
	$cbxLastLogon.Location = '421, 56'
	$cbxLastLogon.Name = &quot;cbxLastLogon&quot;
	$cbxLastLogon.Size = '104, 24'
	$cbxLastLogon.TabIndex = 20
	$cbxLastLogon.Text = &quot;LastLogon&quot;
	$cbxLastLogon.UseVisualStyleBackColor = $True

	$btnADCancel.FlatStyle = 'Flat'
	$btnADCancel.Location = '285, 247'
	$btnADCancel.Name = &quot;btnADCancel&quot;
	$btnADCancel.Size = '75, 23'
	$btnADCancel.TabIndex = 19
	$btnADCancel.Text = &quot;Cancel&quot;
	$btnADCancel.UseVisualStyleBackColor = $True
	$btnADCancel.add_Click($btnADCancel_Click)

	$btnADOK.FlatStyle = 'Flat'
	$btnADOK.Location = '153, 247'
	$btnADOK.Name = &quot;btnADOK&quot;
	$btnADOK.Size = '75, 23'
	$btnADOK.TabIndex = 18
	$btnADOK.Text = &quot;OK&quot;
	$btnADOK.UseVisualStyleBackColor = $True
	$btnADOK.add_Click($btnADOK_Click)

	$cbxFax.Checked = $True
	$cbxFax.CheckState = 'Checked'
	$cbxFax.Location = '421, 176'
	$cbxFax.Name = &quot;cbxFax&quot;
	$cbxFax.Size = '104, 24'
	$cbxFax.TabIndex = 17
	$cbxFax.Text = &quot;Fax&quot;
	$cbxFax.UseVisualStyleBackColor = $True

	$cbxMobilePhone.Checked = $True
	$cbxMobilePhone.CheckState = 'Checked'
	$cbxMobilePhone.Location = '285, 176'
	$cbxMobilePhone.Name = &quot;cbxMobilePhone&quot;
	$cbxMobilePhone.Size = '104, 24'
	$cbxMobilePhone.TabIndex = 16
	$cbxMobilePhone.Text = &quot;Mobile Phone&quot;
	$cbxMobilePhone.UseVisualStyleBackColor = $True

	$cbxOfficePhone.Checked = $True
	$cbxOfficePhone.CheckState = 'Checked'
	$cbxOfficePhone.Location = '12, 176'
	$cbxOfficePhone.Name = &quot;cbxOfficePhone&quot;
	$cbxOfficePhone.Size = '104, 24'
	$cbxOfficePhone.TabIndex = 15
	$cbxOfficePhone.Text = &quot;Office Phone&quot;
	$cbxOfficePhone.UseVisualStyleBackColor = $True

	$lblCommitToAD.Location = '12, 13'
	$lblCommitToAD.Name = &quot;lblCommitToAD&quot;
	$lblCommitToAD.Size = '260, 23'
	$lblCommitToAD.TabIndex = 14
	$lblCommitToAD.Text = &quot;Select the properties to be committed to AD&quot;

	$cbxUserName.Enabled = $False
	$cbxUserName.Location = '285, 56'
	$cbxUserName.Name = &quot;cbxUserName&quot;
	$cbxUserName.Size = '104, 24'
	$cbxUserName.TabIndex = 13
	$cbxUserName.Text = &quot;UserName&quot;
	$cbxUserName.UseVisualStyleBackColor = $True

	$cbxSID.Enabled = $False
	$cbxSID.Location = '153, 56'
	$cbxSID.Name = &quot;cbxSID&quot;
	$cbxSID.Size = '104, 24'
	$cbxSID.TabIndex = 12
	$cbxSID.Text = &quot;SID&quot;
	$cbxSID.UseVisualStyleBackColor = $True

	$cbxCanonicalName.Enabled = $False
	$cbxCanonicalName.Location = '12, 56'
	$cbxCanonicalName.Name = &quot;cbxCanonicalName&quot;
	$cbxCanonicalName.Size = '130, 24'
	$cbxCanonicalName.TabIndex = 11
	$cbxCanonicalName.Text = &quot;Canonical Name&quot;
	$cbxCanonicalName.UseVisualStyleBackColor = $True

	$cbxHomePage.Checked = $True
	$cbxHomePage.CheckState = 'Checked'
	$cbxHomePage.Location = '421, 116'
	$cbxHomePage.Name = &quot;cbxHomePage&quot;
	$cbxHomePage.Size = '104, 24'
	$cbxHomePage.TabIndex = 10
	$cbxHomePage.Text = &quot;Homepage&quot;
	$cbxHomePage.UseVisualStyleBackColor = $True

	$cbxCompany.Checked = $True
	$cbxCompany.CheckState = 'Checked'
	$cbxCompany.Location = '285, 116'
	$cbxCompany.Name = &quot;cbxCompany&quot;
	$cbxCompany.Size = '104, 24'
	$cbxCompany.TabIndex = 9
	$cbxCompany.Text = &quot;Company&quot;
	$cbxCompany.UseVisualStyleBackColor = $True

	$cbxCountry.Checked = $True
	$cbxCountry.CheckState = 'Checked'
	$cbxCountry.Location = '421, 146'
	$cbxCountry.Name = &quot;cbxCountry&quot;
	$cbxCountry.Size = '104, 24'
	$cbxCountry.TabIndex = 8
	$cbxCountry.Text = &quot;Country&quot;
	$cbxCountry.UseVisualStyleBackColor = $True

	$cbxCity.Checked = $True
	$cbxCity.CheckState = 'Checked'
	$cbxCity.Location = '285, 146'
	$cbxCity.Name = &quot;cbxCity&quot;
	$cbxCity.Size = '104, 24'
	$cbxCity.TabIndex = 7
	$cbxCity.Text = &quot;City&quot;
	$cbxCity.UseVisualStyleBackColor = $True

	$cbxPostalCode.Checked = $True
	$cbxPostalCode.CheckState = 'Checked'
	$cbxPostalCode.Location = '153, 146'
	$cbxPostalCode.Name = &quot;cbxPostalCode&quot;
	$cbxPostalCode.Size = '104, 24'
	$cbxPostalCode.TabIndex = 6
	$cbxPostalCode.Text = &quot;Postal Code&quot;
	$cbxPostalCode.UseVisualStyleBackColor = $True

	$cbxStreetAddress.Checked = $True
	$cbxStreetAddress.CheckState = 'Checked'
	$cbxStreetAddress.Location = '12, 146'
	$cbxStreetAddress.Name = &quot;cbxStreetAddress&quot;
	$cbxStreetAddress.Size = '104, 24'
	$cbxStreetAddress.TabIndex = 5
	$cbxStreetAddress.Text = &quot;Street Address&quot;
	$cbxStreetAddress.UseVisualStyleBackColor = $True

	$cbxTitle.Checked = $True
	$cbxTitle.CheckState = 'Checked'
	$cbxTitle.Location = '153, 116'
	$cbxTitle.Name = &quot;cbxTitle&quot;
	$cbxTitle.Size = '104, 24'
	$cbxTitle.TabIndex = 4
	$cbxTitle.Text = &quot;Title&quot;
	$cbxTitle.UseVisualStyleBackColor = $True

	$cbxMail.Checked = $True
	$cbxMail.CheckState = 'Checked'
	$cbxMail.Location = '421, 86'
	$cbxMail.Name = &quot;cbxMail&quot;
	$cbxMail.Size = '104, 24'
	$cbxMail.TabIndex = 3
	$cbxMail.Text = &quot;Mail&quot;
	$cbxMail.UseVisualStyleBackColor = $True

	$cbxDisplayName.Checked = $True
	$cbxDisplayName.CheckState = 'Checked'
	$cbxDisplayName.Location = '285, 86'
	$cbxDisplayName.Name = &quot;cbxDisplayName&quot;
	$cbxDisplayName.Size = '104, 24'
	$cbxDisplayName.TabIndex = 2
	$cbxDisplayName.Text = &quot;Display Name&quot;
	$cbxDisplayName.UseVisualStyleBackColor = $True

	$cbxSurName.Checked = $True
	$cbxSurName.CheckState = 'Checked'
	$cbxSurName.Location = '153, 86'
	$cbxSurName.Name = &quot;cbxSurName&quot;
	$cbxSurName.Size = '104, 24'
	$cbxSurName.TabIndex = 1
	$cbxSurName.Text = &quot;Surname&quot;
	$cbxSurName.UseVisualStyleBackColor = $True

	$cbxGivenName.Checked = $True
	$cbxGivenName.CheckState = 'Checked'
	$cbxGivenName.Location = '12, 86'
	$cbxGivenName.Name = &quot;cbxGivenName&quot;
	$cbxGivenName.Size = '104, 24'
	$cbxGivenName.TabIndex = 0
	$cbxGivenName.Text = &quot;Given Name&quot;
	$cbxGivenName.UseVisualStyleBackColor = $True

	$InitialFormWindowState = $frmCommitAD.WindowState
	$frmCommitAD.add_Load($Form_StateCorrection_Load)
	$frmCommitAD.add_FormClosed($Form_Cleanup_FormClosed)
	$frmCommitAD.add_Closing($Form_StoreValues_Closing)
	Return $frmCommitAD.ShowDialog()
	}

Main ($CommandLine)
#EOF
</code></pre>

</div>

    <footer class="blog-footer">
        <p>&copy; Joel &quot;Jaykul&quot; Bennett 2018</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="/js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>