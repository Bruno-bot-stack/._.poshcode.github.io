
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="PoshCode - Community resources for PowerShell coders">
    <meta name="author" content="Joel Bennett">
    <title>whois - PoshCode</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<div class="blog-post">
    <h2 class="blog-post-title">whois</h2>
    <p class="blog-post-meta">
        <span class="blog-post-time">2013-08-19</span> by <a class="blog-post-author">Joel Bennett</a>
    </p>

    <h1>whois</h1>
<h3><a href="//scripts/4404.ps1">download</a> - <a href="//scripts/4403.md">parent</a></h3>
<p>A Whois script for powershell.</p>
<p>v0.3 Supports commands like:  whois domain google.com
v0.2 Now strips command prefixes off when forwarding queries (if you want to send the prefix to the forwarded server, specify that server with the original query).
v0.1 Now able to re-query the correct whois for .com and .org to get the full information!</p>
<pre><code class="language-posh">    #.Synopsis
    #   Does a raw WHOIS query and returns the results
    #.Example
    #   whois poshcode.org
    #
    #   The simplest whois search
    #.Example
    #   whois poshcode.com
    #
    #   This example is one that forwards to a second whois server ...
    #.Example
    #   whois poshcode.com -NoForward
    #
    #   Returns the partial results you get when you don't follow forwarding to a new whois server
    #.Example
    #   whois domain google.com
    #
    #   Shows an example of sending a command as part of the search.
    #   This example does a search for an exact domain (the &quot;domain&quot; command works on crsnic.net for .com and .net domains)
    #
    #   The google.com domain has a lot of look-alike domains, the least offensive ones are actually Google's domains (like &quot;GOOGLE.COM.BR&quot;), but in general, if you want to look up the actual &quot;google.com&quot; you need to search for the exact domain.
    #.Example
    #   whois n 129.21.1.82 -server whois.arin.net
    #  
    #   Does an ip lookup at arin.net
    #.Notes
    # v0.3 Added documentation, examples, error handling for ip lookups, etc.
    # v0.2 Now strips command prefixes off when forwarding queries (if you want to send the prefix to the forwarded server, specify that server with the original query).
    # v0.1 Now able to re-query the correct whois for .com and .org to get the full information!
# function Get-WhoIs {
    [CmdletBinding()]
    param(
        # The query to send to WHOIS servers
        [Parameter(Position=0, ValueFromRemainingArguments=$true)]
        [string]$query,

        # A specific whois server to search
        [string]$server,

        # Disable forwarding to new whois servers
        [switch]$NoForward
    )
    end {
        $TLDs = DATA {
          @{
            &quot;.br.com&quot;=&quot;whois.centralnic.net&quot;
            &quot;.cn.com&quot;=&quot;whois.centralnic.net&quot;
            &quot;.eu.org&quot;=&quot;whois.eu.org&quot;
            &quot;.com&quot;=&quot;whois.crsnic.net&quot;
            &quot;.net&quot;=&quot;whois.crsnic.net&quot;
            &quot;.org&quot;=&quot;whois.publicinterestregistry.net&quot;
            &quot;.edu&quot;=&quot;whois.educause.net&quot;
            &quot;.gov&quot;=&quot;whois.nic.gov&quot;
          }
        }

        $EAP, $ErrorActionPreference = $ErrorActionPreference, &quot;Stop&quot;

        $query = $query.Trim()

        if($query -match &quot;(?:\d{1,3}\.){3}\d{1,3}&quot;) {
            Write-Verbose &quot;IP Lookup!&quot;
            if($query -notmatch &quot; &quot;) {
                $query = &quot;n $query&quot;
            }
            if(!$server) { $server = &quot;whois.arin.net&quot; }
        } elseif(!$server) {
            $server = $TLDs.GetEnumerator() |
                Where { $query -like  (&quot;*&quot;+$_.name) } |
                Select -Expand Value -First 1
        }

        if(!$server) { $server = &quot;whois.arin.net&quot; }
        $maxRequery = 3 

        do {
            Write-Verbose &quot;Connecting to $server&quot;
            $client = New-Object System.Net.Sockets.TcpClient $server, 43

            try {
                $stream = $client.GetStream()

                Write-Verbose &quot;Sending Query: $query&quot;
                $data = [System.Text.Encoding]::Ascii.GetBytes( $query + &quot;`r`n&quot; )
                $stream.Write($data, 0, $data.Length)

                Write-Verbose &quot;Reading Response:&quot;
                $reader = New-Object System.IO.StreamReader $stream, [System.Text.Encoding]::ASCII

                $result = $reader.ReadToEnd()

                if($result -match &quot;(?s)Whois Server:\s*(\S+)\s*&quot;) {
                    Write-Warning &quot;Recommended WHOIS server: ${server}&quot;
                    if(!$NoForward) {
                        Write-verbose &quot;Non-Authoritative Results:`n${result}&quot;
                        # cache, in case we can't get an answer at the forwarder
                        if(!$cachedResult) {
                            $cachedResult = $result
                            $cachedServer = $server
                        }
                        $server = $matches[1]
                        $query = ($query -split &quot; &quot;)[-1]
                        $maxRequery--
                    } else { $maxRequery = 0 }
                } else { $maxRequery = 0 }
            } finally {
                if($stream) {
                    $stream.Close()
                    $stream.Dispose()
                }
            }
        } while ($maxRequery -gt 0)

        $result

        if($cachedResult -and ($result -split &quot;`n&quot;).count -lt 5) {
            Write-Warning &quot;Original Result from ${cachedServer}:&quot;
            $cachedResult
        }

        $ErrorActionPreference = $EAP
    }
# }
# Set-Alias whois Get-WhoIs
</code></pre>

</div>

    <footer class="blog-footer">
        <p>&copy; Joel &quot;Jaykul&quot; Bennett 2018</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="/js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>