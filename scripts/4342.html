<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sign up for PowerShell.Slack.com">
    <meta name="author" content="Larry Coffey">
    <title> - PoshCode</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>

    <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
    <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/b167be35-3674-4571-8142-df1f7dcfc268">
<!--
    <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud" />
    <link rel="openid2.local_id" href="https://profiles.google.com/+JoelBennett" />
-->
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/Scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<h1></h1>
<h3><a href="//scripts/4342.ps1">download</a></h3>
<p>Dot Sourced PSISE Snippet Editor Form</p>
<p>PowershellISE form to easily select, create and modify PSISE snippet XML files stored in the standard location, while protecting the portions of the XML that should not be changed.
Includes full control of the CaretOffset field for manipulating the insertion point when the snippet is loaded into the PSISE.
Intended to be run as a .\DotSourced script that can be added to the PSISE AddOn menu for quick access.
This is a complete working stand alone form, tested on V3 only.</p>
<pre><code class="language-posh"># PSISE Snippet Editor
function Select-ItemV2 {
    PARAM (
        [Parameter(Mandatory=$true, ValueFromPipeline=$True,ValueFromPipelineByPropertyName=$true,Position=0)]
        $options,
        [Parameter(Mandatory=$true, ValueFromPipeline=$True, ValueFromPipelineByPropertyName=$true, Position=1)]
        $displayProperty,
        [Parameter(Mandatory=$false, ValueFromPipeline=$True, ValueFromPipelineByPropertyName=$true)]
        [string]$title=&quot;Select an item from the list&quot;,
        [Parameter(Mandatory=$false, ValueFromPipeline=$True, ValueFromPipelineByPropertyName=$true,
        HelpMessage='Form Size format is an Array of two interger values as: @(width, height)`nMinimum form width: 225, minimum form height: 250!')]
        [ValidateRange(225,1050)]
        [array]$PopupFormSize
    )
    
    # Create the popup form and all controls              
    [Windows.Forms.form]$PopupForm = new-object Windows.Forms.form
    [System.Windows.Forms.ListBox]$lstOptions = New-Object System.Windows.Forms.ListBox
    [System.Windows.Forms.Button]$btnOK = New-Object System.Windows.Forms.Button 
    [System.Windows.Forms.Button]$btnCancel = New-Object System.Windows.Forms.Button
    Add-Member -InputObject $PopupForm -MemberType NoteProperty -Name gv_ReturnItem -Value $null
    $PopupForm.StartPosition = &quot;CenterParent&quot; #&quot;CenterScreen&quot;
    $PopupForm.ControlBox = $False
    $PopupForm.KeyPreview = $True
    $PopupForm.Add_KeyDown({if ($_.KeyCode -eq &quot;Enter&quot;) {if (($btnOk.Enabled)) {&amp; $btnOkClick}}})
    $PopupForm.Add_KeyDown({if ($_.KeyCode -eq &quot;Escape&quot;) {&amp; $btnCancelClick}})
    
    # form control scripts              	
    $btnOkClick = {if ($lstOptions.SelectedIndex -lt 0) {
            $PopupForm.gv_ReturnItem = $null
        } else {
            $PopupForm.gv_ReturnItem = $options[$lstOptions.SelectedIndex]
            $PopupForm.Close()
        }
    }
    $btnCancelClick = {$PopupForm.gv_ReturnItem = $null;$PopupForm.Close()}
    $lstOptionsChanged = {if ($lstOptions.SelectedIndex -ge 0) {$btnOk.Enabled = $true} else {$btnOk.Enabled = $false} }
    
    # form initialize code
    if ($PopupFormSize) {
        if ($PopupFormsize[0] -lt 225) {$PopupFormsize[0] = 225}
        if ($PopupFormsize[1] -lt 250) {$PopupFormsize[1] = 250}
    } else {
        $PopupFormsize = @(225,250)
    }
    $lstsize = @(($PopupFormsize[0]-25),($PopupFormsize[1]-70))
    $btnOksize = @([int](($PopupFormsize[0]/2)-100),($PopupFormsize[1]-65))
    $btnCancelsize = @([int](($PopupFormsize[0]/2)+5),($PopupFormsize[1]-65))
    $PopupForm.Size = new-object System.Drawing.Size @($PopupFormsize[0],$PopupFormsize[1])   
    $PopupForm.text = $title
                      
    $lstOptions.Name = &quot;lstOptions&quot;
    $lstOptions.Width = $lstsize[0]
    $lstOptions.Height = $lstsize[1]
    $lstOptions.Location = New-Object System.Drawing.Size(5,5)
    $lstOptions.Add_SelectedIndexChanged($lstOptionsChanged)
    $lstOptions.Add_MouseDoubleClick($btnOkClick)
                  
    $btnOK.Width=75
    $btnOK.Location = New-Object System.Drawing.Size($btnOksize[0], $btnOksize[1])
    $btnOK.Text = &quot;OK&quot;
    $btnOK.add_click($btnOkClick)
    $btnOk.Enabled = $false
    $PopupForm.Controls.Add($lstOptions)
    $PopupForm.Controls.Add($btnOK)
                  
    $btnCancel.Width=75
    $btnCancel.Location = New-Object System.Drawing.Size($btnCancelsize[0], $btnCancelsize[1])
    $btnCancel.Text = &quot;Cancel&quot;
    $btnCancel.Add_Click($btnCancelClick)
    $PopupForm.Controls.Add($btnCancel)
                      
    #Populate ListBox
    foreach ($option in $options) {
        $lstOptions.Items.Add($option.$displayProperty) | Out-Null
    }
    $PopupForm.ShowDialog() | Out-Null
    return ($PopupForm.gv_ReturnItem)
}

cls
#Create the main form
[System.Windows.Forms.Application]::EnableVisualStyles()
[Windows.Forms.form]$form = new-object Windows.Forms.form
$form.Size = new-object System.Drawing.Size (933, 575)
$form.StartPosition = &quot;CenterParent&quot; #&quot;CenterScreen&quot;  
$form.text = &quot;PowerShellISE Snippet Editor: by &quot;
$form.BackColor = &quot;lightgray&quot;
$form.MinimizeBox = $False
$form.MaximizeBox = $False
$form.WindowState = &quot;Normal&quot;

$lblTitle = new-object System.Windows.Forms.Label
$txtTitle = new-object System.Windows.Forms.TextBox
$lblAuthor = new-object System.Windows.Forms.Label
$txtAuthor = new-object System.Windows.Forms.TextBox
$lblDescription = new-object System.Windows.Forms.Label
$txtDescription = new-object System.Windows.Forms.TextBox
$lblScriptCode = new-object System.Windows.Forms.Label
$txtScriptCode = new-object System.Windows.Forms.TextBox
$lblLanguage = new-object System.Windows.Forms.Label
$txtLanguage = new-object System.Windows.Forms.TextBox
$lblExpansion = new-object System.Windows.Forms.Label
$txtSnippetType = new-object System.Windows.Forms.TextBox
$lblCursorOffset = new-object System.Windows.Forms.Label
$txtCursorOffset = new-object System.Windows.Forms.TextBox
$lblVarOffset = new-object System.Windows.Forms.Label
$txtVarOffset = new-object System.Windows.Forms.TextBox
$lblCaretOffset = new-object System.Windows.Forms.Label
$txtCaretOffset = new-object System.Windows.Forms.TextBox
$lblCodeEndOffset = new-object System.Windows.Forms.Label
$txtCodeEndOffset = new-object System.Windows.Forms.TextBox
$lblFilePath = new-object System.Windows.Forms.Label
$txtFilePath = new-object System.Windows.Forms.TextBox
$lblStatus = new-object System.Windows.Forms.Label
$ckbAutoEdit = New-Object System.Windows.Forms.CheckBox
$ckbNoBlanks = New-Object System.Windows.Forms.CheckBox
$btnPsIse = new-object System.Windows.Forms.Button
$btnOpen = new-object System.Windows.Forms.Button
$btnNew = new-object System.Windows.Forms.Button
$btnEdit = new-object System.Windows.Forms.Button
$btnFixOffset = new-object System.Windows.Forms.Button
$rdbFirstVar = New-Object System.Windows.Forms.RadioButton
$rdbCodeEnd = New-Object System.Windows.Forms.RadioButton
$rdbCursorPos = New-Object System.Windows.Forms.RadioButton
$rdbFirstElipsis = New-Object System.Windows.Forms.RadioButton
$btnSave = new-object System.Windows.Forms.Button

Add-Member -InputObject $form -MemberType NoteProperty -Name gv_ProgramAuthor -Value 'Larry Coffey' -TypeName [string]
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_SnippetAuthor -Value 'Larry Coffey'  -TypeName [string]
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_FileElipsisOffset -Value 0 -TypeName [int32]
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_FileVariableOffset -Value 0 -TypeName [int32]
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_FileCursorOffset -Value 0  -TypeName [int32]
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_FileCodeEndOffset -Value 1 -TypeName [int32]
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_FileLastWriteTime -Value $null
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_SnippetModified -Value $false -TypeName [bool]
Add-Member -InputObject $form -MemberType NoteProperty -Name gv_SaveSnippetFlag -Value $false -TypeName [bool]

# Script function code
$scriptFldr = Split-Path -parent $MyInvocation.MyCommand.Definition
$configPath = join-path -Path $scriptFldr -ChildPath &quot;SnippetEditorConfig.txt&quot;

$LoadAuthor = {
  if (!(Test-Path $configPath)) {
    out-file -FilePath $configPath -InputObject $form.gv_SnippetAuthor -Encoding string
  }
  [array]$configs =  Get-Content -Path $configPath
  $form.gv_SnippetAuthor = $configs[0]
}

$SaveAuthor = {
 Set-Content -Path $configPath -Value $form.gv_SnippetAuthor -Encoding String -Force
}

$ValidateAuthor = {
  if (!($txtAuthor.ReadOnly) -and ($txtAuthor.TabStop)) {
    $form.KeyPreview = $false
    $txtAuthor.ReadOnly = $true
    $txtAuthor.TabStop = $false
    $txtAuthor.ResetBackColor()
    if (($txtAuthor.Text.Trim()) -match &quot;^\w*\s+\w*&quot; ) {
      $form.gv_SnippetAuthor = ($txtAuthor.Text.Trim())
      &amp; $SaveAuthor
      $lblStatus.Text = (($form.gv_SnippetAuthor) + &quot;, your name has been permanently saved for future use!`n&quot;)
    } else {$lblStatus.Text = (&quot;Your name was NOT entered correctly, and has reverted to the previous entry!`nAuthor: &quot; + ($form.gv_SnippetAuthor))}
    $txtAuthor.Text = ($txtAuthor.TempAuthor)
  }
}

$ChangeDefaultAuthor = {
  $txtAuthor.Add_LostFocus($ValidateAuthor)
  $txtAuthor.TempAuthor = ($txtAuthor.Text)
  $lblStatus.Text = &quot;Enter your first and last name into the Author TextBox.`nPress the Enter ot Tab key to Save your name or Escape to cancel Saving your name!&quot;
  $txtAuthor.Text = $null
  $txtAuthor.ReadOnly = $false
  $txtAuthor.BackColor = 0xffC0ffC0
  $txtAuthor.TabStop = $true
  $form.KeyPreview = $true
  $txtAuthor.Focus()
}

&amp; $LoadAuthor

$Paths = $env:PSModulePath.Split(&quot;;&quot;)
$Path = $paths[0]
$parentArray = $Path.Split(&quot;\&quot;)
$parentPath = &quot;&quot; 
for($i=0;$i -lt (($parentArray.Count)-1);$i++) {$parentPath = $parentPath + $parentArray[($i)] + &quot;\&quot;}
$snippetPath = Join-Path -Path $parentPath -ChildPath Snippets
$snippetWild = Join-Path -Path $parentPath -ChildPath Snippets\*.ps1xml
Write-Warning (&quot;Hi &quot; + ($form.gv_SnippetAuthor) + &quot;, your snippet path is...`n '&quot; + $snippetPath + &quot;'&quot;)
$form.gv_SnippetModified = $false
$form.gv_SaveSnippetFlag = $false
$form.Tag = $null 

function Check_UnsavedSnippet($form) {
  if (($form.gv_SnippetModified) -and ($txtTitle.Text)) {
    $FileName = ($txtFilePath.Text).Split(&quot;\&quot;)[-1] 
    $msg = (&quot;Save your changes to this snippet file?`n`nTitle: &quot; + ($txtTitle.Text) + &quot;`n`nFileName: &quot; + $FileName)
    $answ = [windows.forms.messagebox]::show($msg,&quot;SAVE SNIPPET CHANGES:&quot;,[system.windows.forms.messageboxbuttons]::yesno,[System.Windows.Forms.MessageBoxIcon]::Question)
    if ($answ -eq &quot;Yes&quot;) {&amp; $btnSaveClick}
  }
}

function RadioButton_CheckedChanged( $rdbObject ){ 
 if (($rdbObject.Checked)) {
   switch ($rdbObject.Name) {
     ($rdbFirstElipsis.Name) {
       if (($txtScriptCode.Elipsis1Pos) -gt 0) {
         $lblStatus.Text = (&quot;First Elipsis found at position &quot; + ($form.gv_FileElipsisOffset) + &quot;.&quot;)
         $lblVarOffset.Text = &quot;1st Elipsis:&quot;
         $txtVarOffset.Text = ($form.gv_FileElipsisOffset)
         $txtScriptCode.SelectionStart = ($txtScriptCode.Elipsis1Pos)
         $txtScriptCode.Focus()
       } else {
         $lblStatus.Text = &quot;Elipsis not found in snippet code.&quot;
       }
     }
     ($rdbFirstVar.Name) {
       if (($txtScriptCode.Variable1Pos) -gt 0) {
         $lblStatus.Text = (&quot;First Variable found at position &quot; + ($form.gv_FileVariableOffset) + &quot;.&quot;)
         $lblVarOffset.Text = &quot;1st Variable:&quot;
         $txtVarOffset.Text = ($form.gv_FileVariableOffset)
         $txtScriptCode.SelectionStart = ($txtScriptCode.Variable1Pos)
         $txtScriptCode.Focus()
       } else {
        $lblStatus.Text = &quot;Variable not found in snippet code.&quot;
       }
     }
     ($rdbCursorPos.Name) {
       if (($txtScriptCode.CursorPos) -gt 0) {
         $lblStatus.Text = (&quot;Cursor position to be set at location &quot; + ($form.gv_FileCursorOffset) + &quot;.&quot;)
         $txtScriptCode.SelectionStart = ($txtScriptCode.CursorPos)
         $txtScriptCode.Focus()
       } else {
         $lblStatus.Text = &quot;Cursor Offset at start of snippet code.&quot;
       }
     }
     ($rdbCodeEnd.Name) {
       if (($txtScriptCode.CodeEndPos) -gt 0) {
         $lblStatus.Text = (&quot;Cursor position to be set at end of script code, at location &quot; + ($txtCodeEndOffset.Text) + &quot;.&quot;)
         $txtScriptCode.SelectionStart = ($txtScriptCode.CodeEndPos)
         $txtScriptCode.Focus()
       } else {
         $lblStatus.Text = &quot;Cursor Offset at end of snippet script code.&quot;
       }
     }
   }
  }
}

function Get-CodeOffset ($selStart) {
  if ($selStart -eq 0) {
    $OF = 0
  } else {
    $OL = ($txtScriptCode.GetLineFromCharIndex($selStart))
    $OF = ($selStart - $OL)
  }
  return $OF
}

function Get-CodeLine ($selStart) {
  if ($selStart -eq 0) {
    $OL = 0
  } else {
    $OL = ($txtScriptCode.GetLineFromCharIndex($selStart))
  }
  return $OL
}

$form.Text = ($form.Text + $form.gv_ProgramAuthor)
# Open snippet in PsIse
$btnPsIseClick = {$lblStatus.Text=&quot;Select a snippet file to edit in the PowershellISE&quot;
  $snippets = Get-ChildItem -File -Path $snippetWild
  $ht = @{options=$snippets;displayProperty=&quot;Name&quot;;title=&quot;Select one of the following PowershellISE Snippets&quot;;formSize=@(450,500)}
  $ReturnedItem = Select-ItemV2 @ht #SPLATTING the hashtable!
  if ($ReturnedItem) {
  Write-Warning &quot;Opening: $ReturnedItem in PSISE&quot;
  $psISE.CurrentPowerShellTab.Files.Add(($ReturnedItem.FullName))
  $form.Close()
  } else {$lblStatus.Text=&quot;No valid snippet file path provided for PowershellISE...&quot;}
}
# Open snippet in Snippet Editor
$btnOpenClick = {$lblStatus.Text=&quot;Select a snippet file to edit in the Snippet Editer&quot;
  $snippets = Get-ChildItem -File -Path $snippetWild
  $ht = @{options=$snippets;displayProperty=&quot;Name&quot;;title=&quot;Select one of the following PowershellISE Snippets&quot;;PopupFormSize=@(450,500)}
  $ReturnedItem = Select-ItemV2 @ht #SPLATTING the hashtable!
  if ($ReturnedItem) {$txtFilePath.Text = $ReturnedItem.FullName
    &amp; $nullEdits
    &amp; $loadXml
  } else {$lblStatus.Text=&quot;No valid snippet file path provided for editing...&quot;}
}
# New Snippet
$do_btnNew = {
  if (!($txtTitle.Modified) -and !($txtDescription.Modified) -and !($txtScriptCode.Modified)) {
    $form.Tag  = &quot;Only the Title, Description and ScriptCode fields are enabled for a new snippet! Filename generated upon leaving the Title field.&quot;
    $txtFilePath.Text=$null
    $txtCaretOffset.Text = 1
    ($form.gv_FileCursorOffset) = 0
    $txtCursorOffset.Text = 0
    $form.gv_SnippetModified = $false
    &amp; $nullEdits
    &amp; $enableEdits
    $md = (Get-Date)
    $mds = &quot;{0:MMM-dd-yyyy}&quot; -f $md
    $form.gv_FileLastWriteTime = $mds
    $txtDescription.Text = ([char]27 + &quot; ; Modified: &quot; + $mds + [char]29)
    $txtTitle.Focus()
  } else {
    $lblStatus.Text=&quot;Unable to clear fields for a new snippet as you have unsaved work in progress!&quot;
  }
}
# Get Snippet Fields
$loadXml = {[xml]$snippetXml = Get-Content ($txtFilePath.Text)
  $txtTitle.Text = $snippetXml.Snippets.Snippet.Header.Title
  $txtDescription.Text = $snippetXml.Snippets.Snippet.Header.Description
  $txtAuthor.Text = $snippetXml.Snippets.Snippet.Header.Author
  $txtSnippetType.Text = $snippetXml.Snippets.Snippet.Header.SnippetTypes.SnippetType
  $txtLanguage.Text = $snippetXml.Snippets.Snippet.Code.Script.GetAttribute(&quot;Language&quot;)
  $txtCaretOffset.Text = $snippetXml.Snippets.Snippet.Code.Script.GetAttribute(&quot;CaretOffset&quot;)
  $txtCursorOffset.Text = $txtCaretOffset.Text
  $form.gv_FileCursorOffset = $txtCursorOffset.Text
  $txtCodeEndOffset.Text = &quot;0&quot;
  $txtScriptCode.CursorPos = -1
  $form.gv_SnippetModified = $false
  if (($ckbNoBlanks.Checked)) {
    $tmptxt = $snippetXml.Snippets.Snippet.Code.Script.InnerText
    if (($tmptxt.indexOf(&quot;`r`n`r`n&quot;) -ge 0)) {$tmptxt = ($tmptxt.Replace(&quot;`r`n`r`n&quot;,&quot;`r`n&quot;))}
    if (($tmptxt.indexOf(&quot;`n`n&quot;) -ge 0)) {$tmptxt = ($tmptxt.Replace(&quot;`n`n&quot;,&quot;`n&quot;))}
  } else {
    $tmptxt = $snippetXml.Snippets.Snippet.Code.Script.InnerText
    if (($tmptxt.indexOf(&quot;`r`n&quot;) -ge 0)) {$tmptxt = ($tmptxt.Replace(&quot;`r`n&quot;,&quot;`n&quot;))}
  }
  $txtScriptCode.Text = $tmptxt.Replace(&quot;`n&quot;,&quot;`r`n&quot;)
  $btnFixOffset.Enabled = $false
  $form.gv_FileLastWriteTime = (Get-Item ($txtFilePath.Text)).LastWriteTime.DateTime
  &amp; $UpdateDescription
  if ($ckbAutoEdit.Checked) {
    $lblStatus.Text=(&quot;CaretOffset fixing is only enabled before editing. (File CaretOffset: &quot; + ($txtCaretOffset.Text) + &quot;, Script CodeEndOffset: &quot; + ($txtcodeEndOffset.Text) + &quot;, &quot; + ($lblVarOffset.Text) + &quot; &quot; + ($txtVarOffset.Text) +&quot;)`nDisable AutoEdit as the time to fix it is just after snippet opening, or use the save button when done editing!&quot;)
    &amp; $enableEdits
    $txtScriptCode.SelectionStart = 0
    $txtScriptCode.Focus()
  } else {
    &amp; $disableEdits
    $btnFixOffset.Enabled = $true
    $txtScriptCode.SelectionStart = 0
    $txtScriptCode.Focus()
    $lblStatus.Text=&quot;CarretOffset fixing is only enabled before editing!&quot;
  }
  $txtTitle.Modified = $false
  $txtDescription.Modified = $false
  $txtScriptcode.Modified = $false 
  $form.gv_SnippetModified = $false
  &amp; $txtScriptCode_TextChanged
  if($rdbFirstElipsis.Checked -eq $true) { &amp; RadioButton_CheckedChanged($rdbFirstElipsis)}
  if($rdbFirstVar.Checked -eq $true) { &amp; RadioButton_CheckedChanged($rdbFirstVar)}
  if($rdbCursorPos.Checked -eq $true) { &amp; RadioButton_CheckedChanged($rdbCursorPos)}
  if($rdbCodeEnd.Checked -eq $true) { &amp; RadioButton_CheckedChanged($rdbCodeEnd)} 
}
# Erase field content
$nullEdits = {
  $txtTitle.Text=$null
  $txtDescription.Text=$null
  $txtScriptCode.Text=$null
  $txtTitle.Modified = $false
  $txtDescription.Modified = $false
  $txtScriptcode.Modified = $false 
}
# Toggle Edit Lock
$btnEditClick = {if($btnEdit.Text -eq &quot;Edit&quot;) {
    $lblStatus.Text=&quot;Only the Title, Description and ScriptCode fields are enabled for edit!&quot;
    &amp; $enableEdits
    if (!($txtTitle.Text)) {
      $txtTitle.Focus()
    } else {
      $txtScriptCode.SelectionStart = $txtCaretOffset.Text
      $txtScriptCode.Focus()
    }
  } else {
    $lblStatus.Text=&quot;All fields are view only. (Editing is disabled)&quot;
    &amp; $disableEdits
  }
}
# Allow Edits
$enableEdits = {
  $btnFixOffset.Enabled = $false
  $txtTitle.ReadOnly=$false
  $txtDescription.ReadOnly=$false
  $txtScriptCode.ReadOnly=$false
  $txtTitle.Modified=$false
  $txtDescription.Modified=$false
  $txtScriptCode.Modified=$false
  $btnEdit.Text = &quot;Lock&quot;
}
# Prevent edits
$disableEdits = {
  $txtTitle.ReadOnly=$true
  $txtDescription.ReadOnly=$true
  $txtScriptCode.ReadOnly=$true
  $btnEdit.Text = &quot;Edit&quot;
}
# Verify file ready for Saving
$btnSaveClick = {
  $form.gv_SaveSnippetFlag = $true
  if (($txtFilePath.text.Length) -lt 10) {
    $lblStatus.Text=&quot;No Title or File Name provided for snippet!&quot;
    $form.gv_SaveSnippetFlag = $false
  }
  if (($txtDescription.text.Length) -lt 10) {
    if ($form.gv_SaveSnippetFlag) {
      $lblStatus.Text=&quot;No snippet description provided yet, please add it!&quot;
      $form.gv_SaveSnippetFlag = $false
    } else {
      $lblStatus.Text=($lblStatus.Text + &quot;  No snippet description provided yet, please add it!&quot;)
    }
  }
  if (($txtScriptCode.text.Length) -lt 10) {
    if ($form.gv_SaveSnippetFlag) {
      $lblStatus.Text=&quot;No snippet script Code provided yet, please add it!&quot;
      $form.gv_SaveSnippetFlag = $false
    } else {
      $lblStatus.Text=($lblStatus.Text + &quot;  No snippet script Code provided yet, please add it!&quot;)
    }
  }
  if ($form.gv_SaveSnippetFlag -eq $true) {
    $oldFileName = ($txtFilePath.Text).Split(&quot;\&quot;)[-1]
    $msg = (&quot;Confirm overwriting the existing file name:`r`n&quot; + $oldFileName)
    $answ = [windows.forms.messagebox]::show($msg,&quot;SAVE SNIPPET: Confirm Overwrite?&quot;,[system.windows.forms.messageboxbuttons]::yesno,[System.Windows.Forms.MessageBoxIcon]::Question)
    if ($answ -eq &quot;Yes&quot;) {
      $form.gv_SaveSnippetFlag = $true
      $lblStatus.Text=(&quot;File is to be overwritten (add save file code)`r`nsaveFlag: &quot; + $form.gv_SaveSnippetFlag) 
    } else {
      $form.gv_SaveSnippetFlag = $false
      $lblStatus.Text=(&quot;File Exists. Overwrite denied. Change the Title to create a new filename...`r`nsaveFlag: &quot; + $form.gv_SaveSnippetFlag) 
      $txtTitle.Focus()
    }
  } else {
    $lblStatus.Text=(&quot;New file Editing is incomplete, the new filename is generated by the Title entry...&quot;) 
  }
  if ($form.gv_SaveSnippetFlag -eq $true) {&amp; $saveSnippetXml}
}
# duh
$confirmFilenameChange = {
  $answ = $null
  $oldFileName = ($txtFilePath.Text).Split(&quot;\&quot;)[-1]        
  $tmp = $txtTitle.Text
  $t = '*,_,?,_,/,_,|,_,\,_,&lt;,_,&gt;,_,[,_,],_'
  $tmpFileName = Invoke-Expression ('$tmp' + -join $(foreach($e in $t.Split(',')) {'.Replace(&quot;{0}&quot;,&quot;{1}&quot;)' -f $e, $([void]$foreach.MoveNext();$foreach.Current)} ))
  $tmpFileName = ($tmpFileName + &quot;.snippets.ps1xml&quot;)
  $msg = (&quot;Confirm existing file name:`n&quot; + $oldFileName + &quot;`n`nIs to be replaced with new file name:`n&quot; + $tmpFileName + &quot;`n`nAnswering No changes the Title without changing the FileName!&quot;)
  if ($txtFilePath.Text) {
    $answ = [windows.forms.messagebox]::show($msg,&quot;TITLE CHANGED: Confirm File Name Change?&quot;,[system.windows.forms.messageboxbuttons]::yesno,[System.Windows.Forms.MessageBoxIcon]::Question)
  } else {
    $answ = &quot;Yes&quot;
  }
  if ($answ -eq &quot;Yes&quot;) {
    $txtFilePath.Text = Join-Path -Path $snippetPath -ChildPath $tmpFileName
    $md = &quot;{0:y}&quot; -f (Get-Date)
    $form.gv_FileLastWriteTime = $md
    &amp; $UpdateDescription
  }
}
# Update Filename on exit
$txtTitle_LostFocus = {
  if ($txtTitle.Modified) {
    if (($txtTitle.Text)) {
      &amp; $confirmFilenameChange
      $txtTitle.Modified
    } else {
      $txtTitle.Modified
      $lblStatus.Text = (($form.Tag) + &quot;`nA Title is required as Filename is generated by the Title entry...&quot;)
    }
  }
}

$txtTitle_TextChanged = {
  if ($btnEdit.Text -eq &quot;Lock&quot;) {
    $form.gv_SnippetModified = $true
  }
}

$txtDescription_TextChanged = {
  if ($btnEdit.Text -eq &quot;Lock&quot;) {
    $form.gv_SnippetModified = $true
  }
}

# Auto Calculate CaretOffset
$txtScriptCode_TextChanged = {
  if ($btnEdit.Text -eq &quot;Lock&quot;) {$form.gv_SnippetModified = $true}
  $txtScriptCode.CodeEndPos = ($txtScriptCode.Text.Length)
  $txtCodeEndOffset.Text = (1 + ($txtScriptCode.CodeEndPos) - ($txtScriptCode.Lines.Count))
  if ($txtScriptCode.CursorPos -eq -1) { #just loaded snippet
    $txtScriptCode.CursorLine = Get-CodeLine(($txtCursorOffset.Text))
    $tempOffset = (($txtScriptCode.CursorLine) + ($txtCursorOffset.Text))
    $txtScriptCode.CursorPos = ($tempOffset)
  } elseif ($txtScriptCode.SelectionStart -gt 0) {
    $txtScriptCode.CursorPos = $txtScriptCode.SelectionStart
    $txtScriptCode.CursorLine = Get-CodeLine($txtScriptCode.CursorPos)
    if ($txtScriptCode.CursorPos -gt 0) {
      $form.gv_FileCursorOffset = Get-CodeOffset($txtScriptCode.CursorPos)
    }
    $txtCursorOffset.Text = ($form.gv_FileCursorOffset)
  }
  &amp; $getCaretOffset
  $lblStatus.Text = (($form.Tag) + &quot;`nLast insertion point Cursor Offset position: &quot; + ($form.gv_FileCursorOffset) + &quot;, Code End insertion point will be &quot; + ($txtCodeEndOffset.Text) +  &quot;.&quot;)
}

$UpdateDescription = {
  $tmpDesc = $txtDescription.Text
  $sFlag = $tmpDesc.IndexOf([char]27)
  $lFlag = $tmpDesc.LastIndexOf([char]27)
  $eFlag = $tmpDesc.IndexOf([char]29)
  $patterns = @(&quot;\s*\;\s*Filename:\s&quot;,&quot;\s*Filename:\s&quot;,&quot;\s*\;\s*Modified:\s&quot;,&quot;\s*Modified:\s&quot;,&quot;\;\s+&quot;)
  for ($i=0;$i -lt $patterns.Count;$i++) {
    $pattern = $patterns[($i)]
    $f = $tmpDesc | Select-String -Pattern $pattern
    if ($f.Matches.Index -ge 0) {
      $fFlag = $f.Matches.Index
      $i = $patterns.Count
    }
  }
  $regex = &quot;\x1B.*\x1D&quot;
  if (($form.gv_FileLastWriteTime)) {
    $dts = &quot;{0:MMM-dd-yyyy}&quot; -f (get-date ($form.gv_FileLastWriteTime))
  } else {  
    $dts = &quot;{0:MMM-dd-yyyy}&quot; -f (get-date)
  }
  if ($c) {}
  $FileName = ($txtFilePath.Text).Split(&quot;\&quot;)[-1]
  if (!$FileName) {$FileName = &quot;''&quot;}
  $newd = ([char]27 + &quot;; Filename: &quot; + $FileName + &quot;; Modified: &quot; + $dts + [char]29)
  if (($eFlag -ge 0) -and ($sFlag -ge 0)) { # All present!
    $s =  $tmpDesc.Substring(0,$sFlag)
    $s = ($s.trim() + $newd)
    $txtDescription.Text = $s
  } else { # look for more signs
    if ($eFlag -ge 0) {
      if ($fFlag -ge 0) {
        $s =  $tmpDesc.Substring(0,$fFlag)
        $s = ($s.Trim() + $newd)
        $txtDescription.Text = $s
      } else {
        $s =  $tmpDesc.Replace([char]29,$null)
        $s = ($s.Trim() + $newd)
        $txtDescription.Text = $s
      }
    } else { # No Sign, just add it
      $s = ($tmpDesc.Trim() + $newd)
      $txtDescription.Text = $s
    }
  }
}

# Save snippet (Template required for New)
$saveSnippetXml = {
$template = @&quot;
&lt;?xml version='1.0' encoding='utf-8' ?&gt;
    &lt;Snippets  xmlns='http://schemas.microsoft.com/PowerShell/Snippets'&gt;
        &lt;Snippet Version='1.0.0'&gt;
            &lt;Header&gt;
                &lt;Title&gt;&lt;/Title&gt;
                &lt;Description&gt;&lt;/Description&gt;
                &lt;Author&gt;$form.gv_SnippetAuthor&lt;/Author&gt;
                &lt;SnippetTypes&gt;
                    &lt;SnippetType&gt;Expansion&lt;/SnippetType&gt;
                &lt;/SnippetTypes&gt;
            &lt;/Header&gt;
            &lt;Code&gt;
                &lt;Script Language='PowerShell' CaretOffset='1'&gt;
                    &lt;![CDATA[]]&gt;
                &lt;/Script&gt;
            &lt;/Code&gt;
    &lt;/Snippet&gt;
&lt;/Snippets&gt;
&quot;@
  if (!(Test-Path ($txtFilePath.Text))) {
    Out-File -InputObject $template -FilePath ($txtFilePath.Text) -Encoding utf8 -NoClobber
  }
  $caretOffset = $txtCodeEndOffset.Text
  if (($rdbFirstElipsis.Checked)) {$caretOffset = $txtVarOffset.Text}
  if (($rdbFirstVar.Checked)) {$caretOffset = $txtVarOffset.Text}
  if (($rdbCursorPos.Checked)) {$caretOffset = $txtCursorOffset.Text}
  [xml]$snippetXml = Get-Content ($txtFilePath.Text)
  $snippetXml.Snippets.Snippet.Header.Title = $txtTitle.Text
  $snippetXml.Snippets.Snippet.Header.Description = $txtDescription.Text
  $snippetXml.Snippets.Snippet.Header.Author = $txtAuthor.Text
  $snippetXml.Snippets.Snippet.Header.SnippetTypes.SnippetType = $txtSnippetType.Text
  $snippetXml.Snippets.Snippet.Code.Script.SetAttribute('Language', $txtLanguage.Text)
  $snippetXml.Snippets.Snippet.Code.Script.SetAttribute('CaretOffset', $CaretOffset)
  [array]$codeLines = $txtScriptCode.Lines
  [string]$codeText = &quot;&quot;
  $max = ($codeLines.Count - 1)
  for ($i=0;$i -lt $max;$i++) {
    $codeText = ($codeText + $codeLines[($i)] + &quot;`n&quot;)
  }
  $codeText = ($codeText + $codeLines[($i)])
  $snippetXml.Snippets.Snippet.Code.Script.FirstChild.InnerText = ($codeText)
  $snippetXml.Save(($txtFilePath.Text))
  $lblStatus.Text = (&quot;Snippet: &quot; + $txtTitle.Text + &quot; saved.&quot;)
  Write-Warning $snippetXml.InnerXml
  $txtCaretOffset.text = $CaretOffset
  &amp; $loadXml
}

# Get CaretOffset based on preference
$getCaretOffset = {
  $txtScriptCode.Elipsis1Pos = (1 + ($txtScriptCode.Text.IndexOf('{')))
  $form.gv_FileElipsisOffset = Get-CodeOffset($txtScriptCode.Elipsis1Pos)
  $lblVarOffset.Text = &quot;1st Elipsis:&quot;
  $txtVarOffset.Text = ($form.gv_FileElipsisOffset)
  $txtScriptCode.Variable1Pos = (1 + ($txtScriptCode.Text.IndexOf('$')))
  $form.gv_FileVariableOffset = Get-CodeOffset($txtScriptCode.Variable1Pos)
  if (($form.gv_FileVariableOffset) -gt 0) {$form.Tag = (($form.Tag) + &quot;Variable found at position &quot; + ($form.gv_FileVariableOffset) + &quot;.&quot;)} else {$form.Tag = (($form.Tag) + &quot;Variable not found in snippet code.&quot;)}
  if (!($rdbFirstElipsis.Checked)) {
    $lblVarOffset.Text = &quot;1st Variable:&quot;
    $txtVarOffset.Text = ($form.gv_FileVariableOffset)
  }
}

# Update just the CaretOffset field
$fixCaretOffset = {
  $caretOffset = $txtCodeEndOffset.Text
  if (($rdbFirstElipsis.Checked)) {$caretOffset = $txtVarOffset.Text}
  if (($rdbFirstVar.Checked)) {$caretOffset = $txtVarOffset.Text}
  if (($rdbCursorPos.Checked)) {$caretOffset = $txtCursorOffset.Text}
  if (!($txtTitle.Modified) -and !($txtDescription.Modified) -and !($txtScriptCode.Modified) -and (($txtFilePath.Text) -ne &quot;&quot;) ) {
    if (($txtFilePath.Text) -ne $null) {
      $msg = (&quot;Confirm saving changes to ONLY the CaretOffset Field?`n`nNew CaretOffset value: $caretOffset`n`nNote: Offset based on your RadioButton selection below!&quot;)
      $answ = [windows.forms.messagebox]::show($msg,&quot;CHANGE CARET OFFSET:&quot;,[system.windows.forms.messageboxbuttons]::yesno,[System.Windows.Forms.MessageBoxIcon]::Question)
      if ($answ -eq &quot;Yes&quot;) {
        [xml]$snippetXml = Get-Content ($txtFilePath.Text)
        $oldOffset = $snippetXml.Snippets.Snippet.Code.Script.GetAttribute('CaretOffset')
        $snippetXml.Snippets.Snippet.Code.Script.SetAttribute('CaretOffset', $caretOffset)
        $snippetXml.Save(($txtFilePath.Text))
        $txtCaretOffset.Text = $caretOffset
        $lblStatus.Text=(&quot;Old CaretOffset value: &quot; + $oldOffset + &quot; replaced with current (&quot; + ($txtCaretOffset.Text) + &quot;)&quot;)
        &amp; $enableEdits
      }
    }
  }
}

$AutoEditHelp = {$lblStatus.Text = &quot;A check here Opens snippets directly in Edit mode (not locked), in the future.&quot;}

$RemoveBlankLines = {
  $lines = @($txtScriptCode.Lines)
  $txtScriptCode.Text = $null
  for($i=0;$i -lt $lines.Count;$i++) {
    if ($lines[($i)] -notmatch '^\s*$') {
      $txtScriptCode.Text = ($txtScriptCode.Text + $lines[($i)] + &quot;`r`n&quot;)
    }
  }
}

$NoBlanksHelp = {
  $lblStatus.Text = &quot;A check here removes all blank lines from snippets opened in the future too.&quot;
  if ($ckbNoBlanks.Checked -eq $true) {&amp; $RemoveBlankLines}
}

$lblFont = new-object System.Drawing.Font(&quot;Microsoft Sans Serif&quot;, 8.25, [System.Drawing.FontStyle]::Bold)

$lblTitle.AutoSize = $true
$lblTitle.Font = $lblFont
$lblTitle.Location = new-object System.Drawing.Point(35, 9)
$lblTitle.Name = &quot;lblTitle&quot;
$lblTitle.Size = new-object System.Drawing.Size(32, 13)
$lblTitle.Text = &quot;Title:&quot;
$form.Controls.Add($lblTitle)
            
$txtTitle.Location = new-object System.Drawing.Point(12, 27)
$txtTitle.Name = &quot;txtTitle&quot;
$txtTitle.ReadOnly = $true
$txtTitle.Size = new-object System.Drawing.Size(473, 20)
$txtTitle.TabIndex = 0 
$txtTitle.Add_LostFocus($txtTitle_LostFocus)
$txtTitle.Add_TextChanged($txtTitle_TextChanged)
$form.Controls.Add($txtTitle)

$lblAuthor.AutoSize = $true
$lblAuthor.Font = $lblFont
$lblAuthor.Location = new-object System.Drawing.Point(567, 9)
$lblAuthor.Name = &quot;lblAuthor&quot;
$lblAuthor.Size = new-object System.Drawing.Size(44, 13)
$lblAuthor.Text = &quot;Author:&quot;
$lblAuthor.Add_MouseDoubleClick($ChangeDefaultAuthor)
$lblAuthor.Add_Click({$lblStatus.Text = (&quot;A DoubleClick in the Author Label will allow you to enter your name...`nA DoubleClick on the Author TextBox below it will replace the current Author with &quot; + ($form.gv_SnippetAuthor))})
$form.Controls.Add($lblAuthor)
            
$txtAuthor.Location = new-object System.Drawing.Point(555, 27)
$txtAuthor.Name = &quot;txtAuthor&quot;
$txtAuthor.ReadOnly = $true
$txtAuthor.AcceptsReturn = $false
$txtAuthor.AcceptsTab = $false
$txtAuthor.Multiline = $false
$txtAuthor.Size = new-object System.Drawing.Size(145, 20)
$txtAuthor.Text = $form.gv_SnippetAuthor
$txtAuthor.TabStop = $false
$txtAuthor.Add_MouseDoubleClick({$this.Text = ($form.gv_SnippetAuthor)})
$txtAuthor.Add_Click({$lblStatus.Text = (&quot;A DoubleClick in the Author TextBox will replace the current Author with &quot; + ($form.gv_SnippetAuthor) + &quot;`nA DoubleClick on the Author Label above it will allow you to enter your name...&quot;)})
Add-Member -InputObject $txtAuthor -MemberType NoteProperty -Name TempAuthor -Value &quot;&quot; -TypeName [string]
$form.Controls.Add($txtAuthor)
            
$lblDescription.AutoSize = $true
$lblDescription.Font = $lblFont
$lblDescription.Location = new-object System.Drawing.Point(35, 58)
$lblDescription.Name = &quot;lblDescription&quot;
$lblDescription.Size = new-object System.Drawing.Size(71, 13)
$lblDescription.Text = &quot;Description:&quot;
$form.Controls.Add($lblDescription)
            
$txtDescription.Location = new-object System.Drawing.Point(12, 76)
$txtDescription.Name = &quot;txtDescription&quot;
$txtDescription.ReadOnly = $true
$txtDescription.Size = new-object System.Drawing.Size(886, 20)
$txtDescription.TabIndex = 1
$txtDescription.Add_TextChanged($txtDescription_TextChanged)
$form.Controls.Add($txtDescription)
            
$lblExpansion.Font = $lblFont
$lblExpansion.Location = new-object System.Drawing.Point(765, 9)
$lblExpansion.Name = &quot;lblExpansion&quot;
$lblExpansion.Size = new-object System.Drawing.Size(82, 13)
$lblExpansion.Text = &quot;Snippet Type:&quot;
$form.Controls.Add($lblExpansion)
            
$txtSnippetType.Location = new-object System.Drawing.Point(753, 27)
$txtSnippetType.Name = &quot;txtSnippetType&quot;
$txtSnippetType.ReadOnly = $true
$txtSnippetType.Size = new-object System.Drawing.Size(145, 20)
$txtSnippetType.Text = &quot;Expansion&quot;
$txtSnippetType.TabStop = $false
$form.Controls.Add($txtSnippetType)
            
$lblLanguage.Font = $lblFont
$lblLanguage.Location = new-object System.Drawing.Point(230, 119)
$lblLanguage.Name = &quot;lblLanguage&quot;
$lblLanguage.Size = new-object System.Drawing.Size(63, 13)
$lblLanguage.Text = &quot;Language:&quot;
#$lblLanguage.Click += new-object System.EventHandler($label2_Click_1)
$form.Controls.Add($lblLanguage)
            
$txtLanguage.Location = new-object System.Drawing.Point(300, 116)
$txtLanguage.Name = &quot;txtLanguage&quot;
$txtLanguage.ReadOnly = $true
$txtLanguage.Size = new-object System.Drawing.Size(145, 20)
$txtLanguage.Text = &quot;Powershell&quot;
$txtLanguage.TabStop = $false
$form.Controls.Add($txtLanguage)
            
$lblCursorOffset.Font = $lblFont
$lblCursorOffset.Location = new-object System.Drawing.Point(600, 119)
$lblCursorOffset.Name = &quot;lblCursorOffset&quot;
$lblCursorOffset.Size = new-object System.Drawing.Size(80, 13)
$lblCursorOffset.Text = &quot;Cursor Offset:&quot;
$form.Controls.Add($lblCursorOffset)
            
$txtCursorOffset.Location = new-object System.Drawing.Point(685, 116)
$txtCursorOffset.Name = &quot;txtCursorOffset&quot;
$txtCursorOffset.ReadOnly = $true
$txtCursorOffset.Size = new-object System.Drawing.Size(55, 20)
$txtCursorOffset.Text = &quot;0&quot;
$txtCursorOffset.TabStop = $false
$form.Controls.Add($txtCursorOffset)

$lblVarOffset.Font = $lblFont
$lblVarOffset.Location = new-object System.Drawing.Point(600, 100)
$lblVarOffset.Name = &quot;lblVarOffset&quot;
$lblVarOffset.Size = new-object System.Drawing.Size(75, 13)
$lblVarOffset.Text = &quot;1st Variable:&quot;
$form.Controls.Add($lblVarOffset)

$txtVarOffset.Location = new-object System.Drawing.Point(685, 97)
$txtVarOffset.Name = &quot;txtVarOffset&quot;
$txtVarOffset.ReadOnly = $true
$txtVarOffset.Size = new-object System.Drawing.Size(55, 20)
$txtVarOffset.Text = &quot;0&quot;
$txtVarOffset.TabStop = $false
$form.Controls.Add($txtVarOffset)
   
$lblCaretOffset.Font = $lblFont
$lblCaretOffset.Location = new-object System.Drawing.Point(762, 119)
$lblCaretOffset.Name = &quot;lblCaretOffset&quot;
$lblCaretOffset.Size = new-object System.Drawing.Size(75, 13)
$lblCaretOffset.Text = &quot;Caret Offset:&quot;
$lblCaretOffset.Add_Click($fixCaretOffset)
$form.Controls.Add($lblCaretOffset)
            
$txtCaretOffset.Location = new-object System.Drawing.Point(843, 116)
$txtCaretOffset.Name = &quot;txtCaretOffset&quot;
$txtCaretOffset.ReadOnly = $true
$txtCaretOffset.Size = new-object System.Drawing.Size(55, 20)
$txtCaretOffset.Text = &quot;1&quot;
$txtCaretOffset.TabStop = $false
$txtCaretOffset.Add_Click($fixCaretOffset)
$form.Controls.Add($txtCaretOffset)

$lblCodeEndOffset.Font = $lblFont
$lblCodeEndOffset.Location = new-object System.Drawing.Point(761, 100)
$lblCodeEndOffset.Name = &quot;lblCodeEndOffset&quot;
$lblCodeEndOffset.Size = new-object System.Drawing.Size(75, 13)
$lblCodeEndOffset.Text = &quot;Code End:&quot;
$form.Controls.Add($lblCodeEndOffset)

$txtCodeEndOffset.Location = new-object System.Drawing.Point(843, 97)
$txtCodeEndOffset.Name = &quot;txtCodeEndOffset&quot;
$txtCodeEndOffset.ReadOnly = $true
$txtCodeEndOffset.Size = new-object System.Drawing.Size(55, 20)
$txtCodeEndOffset.Text = &quot;1&quot;
$txtCodeEndOffset.TabStop = $false
$form.Controls.Add($txtCodeEndOffset)

$lblScriptCode.Font = $lblFont
$lblScriptCode.Location = new-object System.Drawing.Point(35, 116)
$lblScriptCode.Name = &quot;lblScriptCode&quot;
$lblScriptCode.Size = new-object System.Drawing.Size(73, 13)
$lblScriptCode.Text = &quot;Script Code:&quot;
$form.Controls.Add($lblScriptCode)
            
$txtScriptCode.AcceptsReturn = $true
$txtScriptCode.AcceptsTab = $true
$txtScriptCode.AllowDrop = $true
$txtScriptCode.Location = new-object System.Drawing.Point(12, 142)
$txtScriptCode.Multiline = $true
$txtScriptCode.ScrollBars = [System.Windows.Forms.ScrollBars]::Both
$txtScriptCode.Name = &quot;txtScriptCode&quot;
$txtScriptCode.ReadOnly = $true
$txtScriptCode.Size = new-object System.Drawing.Size(886, 294)
$txtScriptCode.TabIndex = 2
$txtScriptCode.WordWrap = $false
$txtScriptCode.Add_TextChanged($txtScriptCode_TextChanged)
Add-Member -InputObject $txtScriptCode -MemberType NoteProperty -Name Elipsis1Pos -Value 0
Add-Member -InputObject $txtScriptCode -MemberType NoteProperty -Name Variable1Pos -Value 0
Add-Member -InputObject $txtScriptCode -MemberType NoteProperty -Name CursorPos -Value 0
Add-Member -InputObject $txtScriptCode -MemberType NoteProperty -Name CursorLine -Value 0
Add-Member -InputObject $txtScriptCode -MemberType NoteProperty -Name CodeEndPos -Value 1
$form.Controls.Add($txtScriptCode)

$lblFilePath.Font = $lblFont
$lblFilePath.Location = new-object System.Drawing.Point(35, 455)
$lblFilePath.Name = &quot;lblFilePath&quot;
$lblFilePath.Size = new-object System.Drawing.Size(65, 13)
$lblFilePath.Text = &quot;File Path:&quot;
$form.Controls.Add($lblFilePath)
            
$txtFilePath.Location = new-object System.Drawing.Point(105, 450)
$txtFilePath.Name = &quot;txtFilePath&quot;
$txtFilePath.ReadOnly = $true
$txtFilePath.Size = new-object System.Drawing.Size(791, 20)
$txtFilePath.Text = &quot;&quot;
$form.Controls.Add($txtFilePath)
            
$lblStatus.Location = new-object System.Drawing.Point(12, 505)
$lblStatus.Name = &quot;lblStatus&quot;
$lblStatus.Size = new-object System.Drawing.Size(886, 30)
$lblStatus.Text = &quot;&quot;
$lblStatus.TextAlign = [System.Drawing.ContentAlignment]::MiddleCenter
$form.Controls.Add($lblStatus)

$btnPsIse.Location = new-object System.Drawing.Point(25, 480)
$btnPsIse.Name = &quot;btnPsIse&quot;
$btnPsIse.Size = new-object System.Drawing.Size(75, 23)
$btnPsIse.TabIndex = 3
$btnPsIse.Text = &quot;In PsIse&quot;
$btnPsIse.UseVisualStyleBackColor = $true
$btnPsIse.add_click($btnPsIseClick)
$form.Controls.Add($btnPsIse)

$btnOpen.Location = new-object System.Drawing.Point(125, 480)
$btnOpen.Name = &quot;btnOpen&quot;
$btnOpen.Size = new-object System.Drawing.Size(75, 23)
$btnOpen.TabIndex = 4
$btnOpen.Text = &quot;Open&quot;
$btnOpen.UseVisualStyleBackColor = $true
$btnOpen.add_click($btnOpenClick)
$form.Controls.Add($btnOpen)

$ckbAutoEdit.Location = new-object System.Drawing.Point(215, 472)
$ckbAutoEdit.Name = &quot;ckbAutoEdit&quot;
$ckbAutoEdit.TabIndex = 5
$ckbAutoEdit.Text = &quot;Auto Edit&quot;
$ckbAutoEdit.AutoSize = $true
$ckbAutoEdit.Add_Click($AutoEditHelp)
$form.Controls.Add($ckbAutoEdit)

$ckbNoBlanks.Location = new-object System.Drawing.Point(215, 490)
$ckbNoBlanks.Name = &quot;ckbNoBlanks&quot;
$ckbNoBlanks.TabIndex = 5
$ckbNoBlanks.Text = &quot;No Blanks&quot;
$ckbNoBlanks.AutoSize = $true
$ckbNoBlanks.Add_Click($NoBlanksHelp)
$form.Controls.Add($ckbNoBlanks)

$btnNew.Location = new-object System.Drawing.Point(300, 480)
$btnNew.Name = &quot;btnNew&quot;
$btnNew.Size = new-object System.Drawing.Size(75, 23)
$btnNew.TabIndex = 6
$btnNew.Text = &quot;New&quot;
$btnNew.UseVisualStyleBackColor = $true
$btnNew.Add_click($do_btnNew)
$form.Controls.Add($btnNew)
            
$btnEdit.Location = new-object System.Drawing.Point(400, 480)
$btnEdit.Name = &quot;btnEdit&quot;
$btnEdit.Size = new-object System.Drawing.Size(75, 23)
$btnEdit.TabIndex = 7
$btnEdit.Text = &quot;Edit&quot;
$btnEdit.UseVisualStyleBackColor = $true
$btnEdit.add_click($btnEditClick)
$form.Controls.Add($btnEdit)

$btnFixOffset.Location = new-object System.Drawing.Point(500, 480)
$btnFixOffset.Name = &quot;btnFixOffset&quot;
$btnFixOffset.Size = new-object System.Drawing.Size(75, 23)
$btnFixOffset.TabIndex = 8
$btnFixOffset.Text = &quot;Fix Offset&quot;
$btnFixOffset.UseVisualStyleBackColor = $true
$btnFixOffset.Enabled = $false
$btnFixOffset.add_click($fixCaretOffset)
$form.Controls.Add($btnFixOffset)

$rdbFirstElipsis.Location = new-object System.Drawing.Point(600, 472)
$rdbFirstElipsis.Name = &quot;rdbFirstElipsis&quot;
$rdbFirstElipsis.TabIndex = 10
$rdbFirstElipsis.Text = &quot;1st Elipsis&quot;
$rdbFirstElipsis.AutoSize = $true
$rdbFirstElipsis.Add_Click({RadioButton_CheckedChanged($this)})
$form.Controls.Add($rdbFirstElipsis)

$rdbFirstVar.Location = new-object System.Drawing.Point(600, 490)
$rdbFirstVar.Name = &quot;rdbFirstVar&quot;
$rdbFirstVar.TabIndex = 9
$rdbFirstVar.Text = &quot;1st Variable&quot;
$rdbFirstVar.AutoSize = $true
$rdbFirstVar.Add_Click({RadioButton_CheckedChanged($this)})
$form.Controls.Add($rdbFirstVar)

$rdbCursorPos.Location = new-object System.Drawing.Point(685, 472)
$rdbCursorPos.Name = &quot;rdbCursorPos&quot;
$rdbCursorPos.TabIndex = 10
$rdbCursorPos.Text = &quot;Cursor Pos&quot;
$rdbCursorPos.AutoSize = $true
$rdbCursorPos.Checked = $true
$rdbCursorPos.Add_Click({RadioButton_CheckedChanged($this)})
#$rdbCursorPos.Add_CheckedChanged({RadioButton_CheckedChanged($this)})
$form.Controls.Add($rdbCursorPos)

$rdbCodeEnd.Location = new-object System.Drawing.Point(685, 490)
$rdbCodeEnd.Name = &quot;rdbCodeEnd&quot;
$rdbCodeEnd.TabIndex = 10
$rdbCodeEnd.Text = &quot;Code End&quot;
$rdbCodeEnd.AutoSize = $true
$rdbCodeEnd.Add_Click({RadioButton_CheckedChanged($this)})
$form.Controls.Add($rdbCodeEnd)

$btnSave.Location = new-object System.Drawing.Point(800, 480)
$btnSave.Name = &quot;btnSave&quot;
$btnSave.Size = new-object System.Drawing.Size(75, 23)
$btnSave.TabIndex = 11
$btnSave.Text = &quot;Save&quot;
$btnSave.UseVisualStyleBackColor = $true
$btnSave.add_click($btnSaveClick)
$form.Controls.Add($btnSave)

$form.Add_Closing({Check_UnsavedSnippet($form)})
$form.KeyPreview = $false #only enabled on demand
$form.Add_KeyDown({if ($_.KeyCode -eq &quot;Enter&quot;) {if (($txtAuthor.TabStop)) {&amp; $ValidateAuthor}}})
$form.Add_KeyDown({if ($_.KeyCode -eq &quot;Escape&quot;) {if (($txtAuthor.TabStop)) {$txtAuthor.Text = $null; &amp; $ValidateAuthor}}})

$form.ShowDialog() | Out-Null
</code></pre>

    <footer class="blog-footer">
        <p>© Joel "Jaykul" Bennett 2018.</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>