
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sign up for PowerShell.Slack.com">
    <meta name="author" content="Tony Sathre">
    <title>Migrate-UserPrinters - PoshCode</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<div class="blog-post">
    <h2 class="blog-post-title">Migrate-UserPrinters</h2>
    <p class="blog-post-meta">
        <span class="blog-post-time">2015-10-22</span> by <a class="blog-post-author">Tony Sathre</a>
    </p>

    <h1>Migrate-UserPrinters</h1>
<h3><a href="//scripts/6064.ps1">download</a></h3>
<p>Used for migrating a users network printer connections from one server to another. Useful when migrating your printers to a new print server and need don't want to make your users remap their printers manually. If deployed with SCCM make sure to set the package to run as the user and not SYSTEM.</p>
<pre><code class="language-posh">param (
    [Parameter(Mandatory=$true)]
        [string]$OldPrintServer,
    [Parameter(Mandatory=$true)]
        [string]$NewPrintServer
)

#$ErrorActionPreference = 'SilentlyContinue'
$Printers = Get-WmiObject -Class Win32_Printer | where { $_.Network -eq $true }

foreach ($Printer in $Printers) {
    if ($Printer.SystemName -eq &quot;\\$OldPrintServer&quot;) {            
        $ShareName = $Printer.ShareName
        $Name = $Printer.Name -replace $OldPrintServer, $NewPrintServer
        (New-Object -ComObject WScript.Network).AddWindowsPrinterConnection(&quot;\\$NewPrintServer\$ShareName&quot;) | Out-Null

        if ($Printer.Default -eq $true) {
            (Get-WmiObject -Class Win32_Printer | where { $_.Name -eq $Name}).SetDefaultPrinter() | Out-Null
        }

        $Printer.Delete() | Out-Null
    }
}
</code></pre>

</div>

    <footer class="blog-footer">
        <p>&copy; Joel &quot;Jaykul&quot; Bennett 2018</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="/js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>