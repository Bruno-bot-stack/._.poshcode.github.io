
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="PoshCode - Community resources for PowerShell coders">
    <meta name="author" content="AlanRenouf">
    <title>vProfiles - PoshCode</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://PoshCode.org/">PoshCode</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="navbarResponsive" class="collapse navbar-collapse navbar-responsive-collapse navbar-right">
                <ul class="nav navbar-nav nav-tabs ml-auto" data-tabs="tabs" id="tabs">
                    <li class="nav-item"><a class="nav-link active show" href="/scripts" data-toggle="tab">Scripts</a></li>
                    <li class="nav-item"><a class="nav-link" href="/video" data-toggle="tab">Video Feed</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    </header>

    

<div class="blog-post">
    <h2 class="blog-post-title">vProfiles</h2>
    <p class="blog-post-meta">
        <span class="blog-post-time">2009-06-30</span> by <a class="blog-post-author">AlanRenouf</a>
    </p>

    <h1>vProfiles</h1>
<h3><a href="//scripts/1184.ps1">download</a> - <a href="//scripts/1183.md">parent</a></h3>
<p>vProfiles V1.1 By Alan Renouf http://virtu-al.net, copies vSwitches and PortGroups from one host to another.</p>
<pre><code class="language-posh">#
# vProfiles V1
# By Alan Renouf
# http://virtu-al.net
#

#Generated Form Function
function GenerateForm {
########################################################################
# Code Generated By: SAPIEN Technologies PrimalForms (Community Edition) v1.0.3.0
# Generated On: 27/06/2009 9:17 PM
# Generated By: Alan
########################################################################

#region Import the Assemblies
[reflection.assembly]::loadwithpartialname(&quot;System.Drawing&quot;) | Out-Null
[reflection.assembly]::loadwithpartialname(&quot;System.Windows.Forms&quot;) | Out-Null
#endregion

#region Generated Form Objects
$vProfiles = New-Object System.Windows.Forms.Form
$label3 = New-Object System.Windows.Forms.Label
$label2 = New-Object System.Windows.Forms.Label
$Disconnect = New-Object System.Windows.Forms.Button
$Connect = New-Object System.Windows.Forms.Button
$OutputWin = New-Object System.Windows.Forms.TextBox
$CopyNetwork = New-Object System.Windows.Forms.Button
$NewHost = New-Object System.Windows.Forms.ListBox
$BaseHost = New-Object System.Windows.Forms.ListBox
$label1 = New-Object System.Windows.Forms.Label
$VCSRV = New-Object System.Windows.Forms.TextBox
$InitialFormWindowState = New-Object System.Windows.Forms.FormWindowState
#endregion Generated Form Objects

#----------------------------------------------
#Generated Event Script Blocks
#----------------------------------------------
#Provide Custom Code for events specified in PrimalForms.
$Disconnect_OnClick= 
{
	Disconnect-VIServer $ConVISRV -Confirm:$false
	$Disconnect.Enabled = $false
	$CopyNetwork.Enabled = $false
	$OutputWin.Text += &quot;`r`nDisconnect Successful&quot;
	$vProfiles.Refresh()
	
}

$handler_NewHost_SelectedIndexChanged= 
{
#TODO: Place custom script here

}

$handler_button3_Click= 
{
	$OutputWin.Text += &quot;`r`nConnecting to $($Basehost.SelectedItem)&quot;
	$vProfiles.Refresh()
	$CBASEHost = Get-VMHost -Name ($Basehost.SelectedItem)
	$OutputWin.Text += &quot;`r`nConnecting to $($Newhost.SelectedItem)&quot;
	$vProfiles.Refresh()
	$CNEWHost = Get-VMHost -Name ($NewHost.SelectedItem)
	$OutputWin.Text += &quot;`r`nRetrieving Virtual Switches&quot;
	$vProfiles.Refresh()
	$CBASEHost | Get-VirtualSwitch | Foreach {
		If (($CNEWHost | Get-VirtualSwitch -Name $_.Name -ErrorAction SilentlyContinue) -eq $null){
			$vSwitch = $_
			$OutputWin.Text += &quot;`r`nCreating Virtual Switch $($_.Name)&quot;
			$vProfiles.Refresh()
			$NewSwitch = $CNEWHost | New-VirtualSwitch -Name $_.Name -NumPorts $_.NumPorts -Mtu $_.Mtu
		}
		$_ | Get-VirtualPortGroup | Foreach {
			If (($CNEWHost | Get-VirtualPortGroup -Name $_.Name -ErrorAction SilentlyContinue) -eq $null){
				$OutputWin.Text += &quot;`r`n..Creating Portgroup $($_.Name) on $($vSwitch.Name)&quot;
				$vProfiles.Refresh()
				$NewPortGroup = $CNEWHost | Get-VirtualSwitch -Name $vSwitch | New-VirtualPortGroup -Name $_.Name -VLanId $_.VLanID
			}
		}
	}
	$OutputWin.Text += &quot;`r`n-- Configuration Completed --&quot;
	$vProfiles.Refresh()

}

$handler_label1_Click= 
{
#TODO: Place custom script here

}

$handler_listBox1_SelectedIndexChanged= 
{
#TODO: Place custom script here

}

$handler_button1_Click= 
{
	If ($VCSRV.Text -eq &quot;&quot;) {$OutputWin.Text = &quot;Please Specify a VC Server above&quot;}
	Else
	{
		$OutputWin.Text = &quot;Connecting to $($VCSRV.Text)&quot;
		$vProfiles.Refresh()
		$ConVISRV = Connect-VIServer $VCSRV.Text
		If ($ConVISRV.IsConnected -eq $true) {
			$OutputWin.Text += &quot;`r`nConnection Successful&quot;
			$vProfiles.Refresh()
			$Disconnect.Enabled = $true
			$CopyNetwork.Enabled = $true
			Foreach ($EsxHost in (Get-VMHost))
			{	
				$BaseHost.Items.Add(&quot;$($EsxHost.Name)&quot;)|Out-Null
				$NewHost.Items.Add(&quot;$($EsxHost.Name)&quot;)|Out-Null
			}		
		}
		Else {
			$OutputWin.Text += &quot;`r`nConnection Un-Successful - Please try again.&quot;
			$vProfiles.Refresh()
		}
	}

}

$OnLoadForm_StateCorrection=
{#Correct the initial state of the form to prevent the .Net maximized form issue
	$vProfiles.WindowState = $InitialFormWindowState
}

#----------------------------------------------
#region Generated Form Code
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 563
$System_Drawing_Size.Height = 503
$vProfiles.MaximumSize = $System_Drawing_Size
$vProfiles.AutoSize = $True
$vProfiles.Text = 'vProfiles'
$vProfiles.ShowInTaskbar = $False
$vProfiles.MaximizeBox = $False
$vProfiles.Name = 'vProfiles'
$vProfiles.SizeGripStyle = 2
$vProfiles.ShowIcon = $False
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 563
$System_Drawing_Size.Height = 503
$vProfiles.MinimumSize = $System_Drawing_Size
$vProfiles.StartPosition = 1
$vProfiles.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 547
$System_Drawing_Size.Height = 465
$vProfiles.ClientSize = $System_Drawing_Size

$label3.TabIndex = 11
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 100
$System_Drawing_Size.Height = 13
$label3.Size = $System_Drawing_Size
$label3.Text = 'Destination:'

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 271
$System_Drawing_Point.Y = 43
$label3.Location = $System_Drawing_Point
$label3.DataBindings.DefaultDataSourceUpdateMode = 0
$label3.Name = 'label3'
$label3.add_Click($handler_label3_Click)

$vProfiles.Controls.Add($label3)

$label2.TabIndex = 10
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 100
$System_Drawing_Size.Height = 13
$label2.Size = $System_Drawing_Size
$label2.Text = 'Source:'

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 24
$System_Drawing_Point.Y = 43
$label2.Location = $System_Drawing_Point
$label2.DataBindings.DefaultDataSourceUpdateMode = 0
$label2.Name = 'label2'

$vProfiles.Controls.Add($label2)

$Disconnect.TabIndex = 9
$Disconnect.Name = 'Disconnect'
$Disconnect.Enabled = $False
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 75
$System_Drawing_Size.Height = 23
$Disconnect.Size = $System_Drawing_Size
$Disconnect.UseVisualStyleBackColor = $True

$Disconnect.Text = 'Disconnect'

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 442
$System_Drawing_Point.Y = 10
$Disconnect.Location = $System_Drawing_Point
$Disconnect.DataBindings.DefaultDataSourceUpdateMode = 0
$Disconnect.add_Click($Disconnect_OnClick)

$vProfiles.Controls.Add($Disconnect)

$Connect.TabIndex = 8
$Connect.Name = 'Connect'
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 75
$System_Drawing_Size.Height = 23
$Connect.Size = $System_Drawing_Size
$Connect.UseVisualStyleBackColor = $True

$Connect.Text = 'Connect'

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 360
$System_Drawing_Point.Y = 10
$Connect.Location = $System_Drawing_Point
$Connect.DataBindings.DefaultDataSourceUpdateMode = 0
$Connect.add_Click($handler_button1_Click)

$vProfiles.Controls.Add($Connect)

$OutputWin.Multiline = $True
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 491
$System_Drawing_Size.Height = 264
$OutputWin.Size = $System_Drawing_Size
$OutputWin.DataBindings.DefaultDataSourceUpdateMode = 0
$OutputWin.AcceptsReturn = $True
$OutputWin.ScrollBars = 2
$OutputWin.Name = 'OutputWin'
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 24
$System_Drawing_Point.Y = 189
$OutputWin.Location = $System_Drawing_Point
$OutputWin.Enabled = $False
$OutputWin.TabIndex = 7

$vProfiles.Controls.Add($OutputWin)

$CopyNetwork.TabIndex = 6
$CopyNetwork.Name = 'CopyNetwork'
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 179
$System_Drawing_Size.Height = 23
$CopyNetwork.Size = $System_Drawing_Size
$CopyNetwork.UseVisualStyleBackColor = $True
$CopyNetwork.Enabled = $false

$CopyNetwork.Text = 'Copy vSwitches and PortGroups'

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 175
$System_Drawing_Point.Y = 160
$CopyNetwork.Location = $System_Drawing_Point
$CopyNetwork.DataBindings.DefaultDataSourceUpdateMode = 0
$CopyNetwork.add_Click($handler_button3_Click)

$vProfiles.Controls.Add($CopyNetwork)

$NewHost.FormattingEnabled = $True
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 244
$System_Drawing_Size.Height = 95
$NewHost.Size = $System_Drawing_Size
$NewHost.DataBindings.DefaultDataSourceUpdateMode = 0
$NewHost.ScrollAlwaysVisible = $True
$NewHost.Name = 'NewHost'
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 271
$System_Drawing_Point.Y = 59
$NewHost.Location = $System_Drawing_Point
$NewHost.TabIndex = 5
$NewHost.add_SelectedIndexChanged($handler_NewHost_SelectedIndexChanged)

$vProfiles.Controls.Add($NewHost)

$BaseHost.FormattingEnabled = $True
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 241
$System_Drawing_Size.Height = 95
$BaseHost.Size = $System_Drawing_Size
$BaseHost.DataBindings.DefaultDataSourceUpdateMode = 0
$BaseHost.ScrollAlwaysVisible = $True
$BaseHost.Name = 'BaseHost'
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 24
$System_Drawing_Point.Y = 59
$BaseHost.Location = $System_Drawing_Point
$BaseHost.TabIndex = 4
$BaseHost.add_SelectedIndexChanged($handler_listBox1_SelectedIndexChanged)

$vProfiles.Controls.Add($BaseHost)

$label1.TabIndex = 1
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 86
$System_Drawing_Size.Height = 23
$label1.Size = $System_Drawing_Size
$label1.Text = 'Virtual Center:'

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 34
$System_Drawing_Point.Y = 15
$label1.Location = $System_Drawing_Point
$label1.DataBindings.DefaultDataSourceUpdateMode = 0
$label1.Name = 'label1'
$label1.add_Click($handler_label1_Click)

$vProfiles.Controls.Add($label1)

$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Width = 228
$System_Drawing_Size.Height = 20
$VCSRV.Size = $System_Drawing_Size
$VCSRV.DataBindings.DefaultDataSourceUpdateMode = 0
$VCSRV.Name = 'VCSRV'
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 126
$System_Drawing_Point.Y = 12
$VCSRV.Location = $System_Drawing_Point
$VCSRV.TabIndex = 0

$vProfiles.Controls.Add($VCSRV)

#endregion Generated Form Code

#Save the initial state of the form
$InitialFormWindowState = $vProfiles.WindowState
#Init the OnLoad event to correct the initial state of the form
$vProfiles.add_Load($OnLoadForm_StateCorrection)
#Show the Form
$vProfiles.ShowDialog()| Out-Null

} #End Function

#Call the Function
GenerateForm
</code></pre>

</div>

    <footer class="blog-footer">
        <p>&copy; Joel &quot;Jaykul&quot; Bennett 2018</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="/js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59988721-1', 'auto');
      ga('send', 'pageview');

      $(function () {
          $('#contentTabs a:first').tab('show')
      })

    </script>
</body>
</html>